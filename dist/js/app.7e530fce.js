(function(e){function t(t){for(var a,s,o=t[0],c=t[1],l=t[2],O=0,h=[];O<o.length;O++)s=o[O],Object.prototype.hasOwnProperty.call(n,s)&&n[s]&&h.push(n[s][0]),n[s]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(e[a]=c[a]);u&&u(t);while(h.length)h.shift()();return r.push.apply(r,l||[]),i()}function i(){for(var e,t=0;t<r.length;t++){for(var i=r[t],a=!0,o=1;o<i.length;o++){var c=i[o];0!==n[c]&&(a=!1)}a&&(r.splice(t--,1),e=s(s.s=i[0]))}return e}var a={},n={app:0},r=[];function s(t){if(a[t])return a[t].exports;var i=a[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,s),i.l=!0,i.exports}s.m=e,s.c=a,s.d=function(e,t,i){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)s.d(i,a,function(t){return e[t]}.bind(null,a));return i},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],c=o.push.bind(o);o.push=t,o=o.slice();for(var l=0;l<o.length;l++)t(o[l]);var u=c;r.push([0,"chunk-vendors"]),i()})({0:function(e,t,i){e.exports=i("56d7")},"56d7":function(e,t,i){"use strict";i.r(t);i("e260"),i("e6cf"),i("cca6"),i("a79d");var a=i("d4ec"),n=i("bee2"),r=i("ade3"),s=i("63ae"),o=(i("7db0"),i("cb29"),i("d3b7"),i("25f0"),i("4de4"),i("c740"),i("a434"),i("e439"),i("5a89")),c=i("32d9"),l=i("93e9"),u=i("9ab2"),O=i("f7dd"),h=i("257e"),E=i("45eb"),b=i("7e84"),_=i("262e"),S=i("2caf");i("159b");function T(e,t,i){return i.writable=!1,i}i("5377");var A,d,f,p,v,j,g,L,y,I,N,R,P,C,D,G,w,m,M,x,F,H,k,U,z,B,Y,W,K,V,X,J,Z,q,Q,$,ee,te,ie,ae,ne,re,se,oe,ce,le,ue,Oe,he,Ee,be,_e,Se,Te,Ae,de,fe,pe,ve,je,ge,Le,ye,Ie,Ne,Re,Pe,Ce,De,Ge,we,me,Me,xe,Fe,He,ke,Ue,ze,Be,Ye,We,Ke,Ve,Xe,Je,Ze,qe,Qe,$e,et,tt,it,at,nt,rt,st,ot,ct,lt,ut,Ot,ht,Et,bt,_t,St,Tt,At,dt,ft,pt,vt,jt,gt,Lt,yt,It,Nt,Rt,Pt,Ct,Dt,Gt,wt,mt,Mt,xt,Ft,Ht,kt,Ut,zt,Bt,Yt,Wt,Kt,Vt,Xt,Jt,Zt,qt,Qt,$t,ei,ti,ii,ai,ni,ri,si,oi,ci,li,ui,Oi,hi,Ei,bi,_i,Si,Ti,Ai,di,fi,pi,vi,ji,gi,Li,yi,Ii,Ni,Ri,Pi,Ci=function(){function e(){Object(a["a"])(this,e),Object(r["a"])(this,"lastId",0)}return Object(n["a"])(e,[{key:"getNewId",value:function(){return this.lastId++}}]),e}(),Di=new Ci,Gi=Di,wi=(i("b0c0"),function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";Object(a["a"])(this,e),Object(r["a"])(this,"id",void 0),Object(r["a"])(this,"duration",void 0),Object(r["a"])(this,"probability",void 0),Object(r["a"])(this,"name",void 0),this.id=Gi.getNewId(),this.duration=t,this.probability=i,this.name=n}return Object(n["a"])(e,[{key:"equals",value:function(e){return this.id===e.id}}],[{key:"drawNextState",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];for(var a=t.reduce((function(e,t){return e+t.probability}),0),n=Math.random()*a,r=0;r<t.length;r++){if(t[r].probability>=n)return t[r];n-=t[r].probability}throw new Error("Something weird happened.")}}]),e}()),mi=(P=R=function(){function e(t,i,n){Object(a["a"])(this,e),Object(r["a"])(this,"surface",void 0),Object(r["a"])(this,"objectId",void 0),Object(r["a"])(this,"laneId",0),Object(r["a"])(this,"prevLaneId",-1),Object(r["a"])(this,"laneChangeMapsNeedUpdate",!0),Object(r["a"])(this,"type",void 0),Object(r["a"])(this,"alive",!0),Object(r["a"])(this,"hittable",!0),Object(r["a"])(this,"canExplode",!0),Object(r["a"])(this,"zPosition",0),Object(r["a"])(this,"zSpeed",0),Object(r["a"])(this,"state",new wi(0)),Object(r["a"])(this,"prevState",new wi(0)),Object(r["a"])(this,"lastStateChange",void 0),Object(r["a"])(this,"flags",0),this.surface=t,this.laneId=this.surface.getActualLaneIdFromProjectedMovement(i),this.type=n,this.objectId=Gi.getNewId()}return Object(n["a"])(e,[{key:"update",value:function(){throw new Error("Method 'update()' must be implemented.")}},{key:"die",value:function(){throw new Error("Method 'die()' must be implemented.")}},{key:"hitByProjectile",value:function(){this.die()}},{key:"disappear",value:function(){throw new Error("Method 'disappear()' must be implemented.")}},{key:"setLane",value:function(e){this.prevLaneId=this.laneId,this.laneId=this.surface.getActualLaneIdFromProjectedMovement(e),this.laneChangeMapsNeedUpdate=!0}},{key:"shouldUpdateFIFOMaps",value:function(){return!!this.laneChangeMapsNeedUpdate&&(this.laneChangeMapsNeedUpdate=!1,this.laneId!==this.prevLaneId)}},{key:"setState",value:function(e){this.prevState=this.state,this.state=e,this.lastStateChange=Date.now()}},{key:"timeSinceLastStateChange",value:function(){return Date.now()-this.lastStateChange}},{key:"stateProgressInTime",value:function(){var e=this.timeSinceLastStateChange();return e>=this.state.duration?1:e/this.state.duration}},{key:"canChangeState",value:function(){return this.timeSinceLastStateChange()>this.state.duration}},{key:"inState",value:function(e){return this.state.equals(e)}},{key:"prevInState",value:function(e){return this.prevState.equals(e)}},{key:"setFlag",value:function(e){this.flags|=e}},{key:"unsetFlag",value:function(e){this.flags&=~e}},{key:"clearFlags",value:function(){this.flags=0}},{key:"isFlagSet",value:function(e){return(this.flags&e)>0}},{key:"isFlagNotSet",value:function(e){return!this.isFlagSet(e)}}]),e}(),Object(r["a"])(R,"TYPE_SHOOTER","shooter"),Object(r["a"])(R,"TYPE_PULSAR","pulsar"),Object(r["a"])(R,"TYPE_SPIKER","spiker"),Object(r["a"])(R,"TYPE_SPIKE","spike"),Object(r["a"])(R,"TYPE_FLIPPER_TANKER","flipperTanker"),Object(r["a"])(R,"TYPE_FUSEBALL_TANKER","fuseballTanker"),Object(r["a"])(R,"TYPE_PULSAR_TANKER","pulsarTanker"),Object(r["a"])(R,"TYPE_FLIPPER","flipper"),Object(r["a"])(R,"TYPE_FUSEBALL","fuseball"),Object(r["a"])(R,"TYPE_PROJECTILE","projectile"),A=P,Object(s["a"])(A,"TYPE_SHOOTER",[T],(d=Object.getOwnPropertyDescriptor(A,"TYPE_SHOOTER"),d=d?d.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return d}}),A),Object(s["a"])(A,"TYPE_PULSAR",[T],(f=Object.getOwnPropertyDescriptor(A,"TYPE_PULSAR"),f=f?f.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return f}}),A),Object(s["a"])(A,"TYPE_SPIKER",[T],(p=Object.getOwnPropertyDescriptor(A,"TYPE_SPIKER"),p=p?p.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return p}}),A),Object(s["a"])(A,"TYPE_SPIKE",[T],(v=Object.getOwnPropertyDescriptor(A,"TYPE_SPIKE"),v=v?v.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return v}}),A),Object(s["a"])(A,"TYPE_FLIPPER_TANKER",[T],(j=Object.getOwnPropertyDescriptor(A,"TYPE_FLIPPER_TANKER"),j=j?j.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return j}}),A),Object(s["a"])(A,"TYPE_FUSEBALL_TANKER",[T],(g=Object.getOwnPropertyDescriptor(A,"TYPE_FUSEBALL_TANKER"),g=g?g.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return g}}),A),Object(s["a"])(A,"TYPE_PULSAR_TANKER",[T],(L=Object.getOwnPropertyDescriptor(A,"TYPE_PULSAR_TANKER"),L=L?L.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return L}}),A),Object(s["a"])(A,"TYPE_FLIPPER",[T],(y=Object.getOwnPropertyDescriptor(A,"TYPE_FLIPPER"),y=y?y.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return y}}),A),Object(s["a"])(A,"TYPE_FUSEBALL",[T],(I=Object.getOwnPropertyDescriptor(A,"TYPE_FUSEBALL"),I=I?I.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return I}}),A),Object(s["a"])(A,"TYPE_PROJECTILE",[T],(N=Object.getOwnPropertyDescriptor(A,"TYPE_PROJECTILE"),N=N?N.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return N}}),A),A),Mi=(F=x=function(e){Object(_["a"])(i,e);var t=Object(S["a"])(i);function i(e,n,s){var o,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return Object(a["a"])(this,i),o=t.call(this,e,n,mi.TYPE_PROJECTILE),Object(r["a"])(Object(h["a"])(o),"canExplode",!1),Object(r["a"])(Object(h["a"])(o),"source",void 0),o.source=s,o.source===i.SOURCE_SHOOTER?(o.zPosition=null!==c&&void 0!==c?c:0,o.zSpeed=i.PROJECTILE_SPEED):(o.zPosition=null!==c&&void 0!==c?c:1,o.zSpeed=-i.PROJECTILE_SPEED),o}return Object(n["a"])(i,[{key:"update",value:function(){this.alive&&(this.zPosition+=this.zSpeed,this.alive=!1===(this.source===i.SOURCE_SHOOTER&&this.zPosition>=1||this.source===i.SOURCE_ENEMY&&this.zPosition<=0))}},{key:"detectCollision",value:function(e){var t=this;if(!this.alive)return-1;var a=e.findIndex((function(e){return e.hittable&&e.alive&&e.zPosition>=t.zPosition-i.PROJECTILE_KILL_RADIUS_BACKWARD&&e.zPosition<=t.zPosition+i.PROJECTILE_KILL_RADIUS_FORWARD}));return a>=0&&(e[a].hitByProjectile(),this.alive=!1),a}},{key:"hitByProjectile",value:function(){this.alive=!1}},{key:"disappear",value:function(){this.alive=!1}}]),i}(mi),Object(r["a"])(x,"PROJECTILE_SPEED",.028),Object(r["a"])(x,"PROJECTILE_KILL_RADIUS_FORWARD",.02),Object(r["a"])(x,"PROJECTILE_KILL_RADIUS_BACKWARD",.08),Object(r["a"])(x,"SOURCE_SHOOTER",1),Object(r["a"])(x,"SOURCE_ENEMY",-1),C=F,Object(s["a"])(C,"PROJECTILE_SPEED",[T],(D=Object.getOwnPropertyDescriptor(C,"PROJECTILE_SPEED"),D=D?D.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return D}}),C),Object(s["a"])(C,"PROJECTILE_KILL_RADIUS_FORWARD",[T],(G=Object.getOwnPropertyDescriptor(C,"PROJECTILE_KILL_RADIUS_FORWARD"),G=G?G.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return G}}),C),Object(s["a"])(C,"PROJECTILE_KILL_RADIUS_BACKWARD",[T],(w=Object.getOwnPropertyDescriptor(C,"PROJECTILE_KILL_RADIUS_BACKWARD"),w=w?w.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return w}}),C),Object(s["a"])(C,"SOURCE_SHOOTER",[T],(m=Object.getOwnPropertyDescriptor(C,"SOURCE_SHOOTER"),m=m?m.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return m}}),C),Object(s["a"])(C,"SOURCE_ENEMY",[T],(M=Object.getOwnPropertyDescriptor(C,"SOURCE_ENEMY"),M=M?M.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return M}}),C),C),xi=function(e){Object(_["a"])(i,e);var t=Object(S["a"])(i);function i(e,n,s,o){var c;return Object(a["a"])(this,i),c=t.call(this,e,s,o),Object(r["a"])(Object(h["a"])(c),"projectileManager",void 0),Object(r["a"])(Object(h["a"])(c),"projectileSource",void 0),Object(r["a"])(Object(h["a"])(c),"lastShootTimestamp",void 0),Object(r["a"])(Object(h["a"])(c),"shootTimeoutMs",void 0),Object(r["a"])(Object(h["a"])(c),"canShoot",!0),c.projectileManager=n,c.projectileSource=o===mi.TYPE_SHOOTER?Mi.SOURCE_SHOOTER:Mi.SOURCE_ENEMY,c}return Object(n["a"])(i,[{key:"update",value:function(){this.alive&&(this.canChangeState()&&this.updateState(),this.updateEntity())}},{key:"updateState",value:function(){throw new Error("Method 'updateState()' must be implemented.")}},{key:"updateEntity",value:function(){throw new Error("Method 'updateEntity()' must be implemented.")}},{key:"fire",value:function(){if(this.canShoot){var e=Date.now();if(!(e-this.lastShootTimestamp<this.shootTimeoutMs))return this.lastShootTimestamp=e,this.projectileManager.fire(this.laneId,this.projectileSource,this.zPosition)}}}]),i}(mi),Fi=(i("99af"),Q=q=function(){function e(){Object(a["a"])(this,e),Object(r["a"])(this,"messages",[])}return Object(n["a"])(e,[{key:"publish",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];e in this.messages||(this.messages[e]=[]),this.messages[e].push(new Hi(e,t,i)),console.log("Published ".concat(t," under ").concat(e))}},{key:"consume",value:function(e){return e in this.messages?0===this.messages[e].length?null:(console.log("Consumed ".concat(this.messages[e][0].message," under ").concat(e)),this.messages[e].shift()):null}}]),e}(),Object(r["a"])(q,"TOPIC_AUDIO","topic_audio"),Object(r["a"])(q,"TOPIC_SCREEN","topic_screen"),Object(r["a"])(q,"MESSAGE_PLAYER_DEATH","message_player_death"),Object(r["a"])(q,"MESSAGE_PLAYER_CHANGED_LANE","message_player_changed_lane"),Object(r["a"])(q,"MESSAGE_NEXT_LEVEL","message_next_level"),Object(r["a"])(q,"MESSAGE_PLAYER_SHOOT","message_player_shoot"),Object(r["a"])(q,"MESSAGE_PLAYER_SUPERZAPPER_USED","message_player_superzapper_used"),Object(r["a"])(q,"MESSAGE_ENEMY_SHOOT","message_enemy_shoot"),Object(r["a"])(q,"MESSAGE_ENEMY_DEATH","message_enemy_death"),Object(r["a"])(q,"MESSAGE_MENU_CHANGE","message_menu_change"),Object(r["a"])(q,"MESSAGE_MENU_SELECT","message_menu_select"),H=Q,Object(s["a"])(H,"TOPIC_AUDIO",[T],(k=Object.getOwnPropertyDescriptor(H,"TOPIC_AUDIO"),k=k?k.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return k}}),H),Object(s["a"])(H,"TOPIC_SCREEN",[T],(U=Object.getOwnPropertyDescriptor(H,"TOPIC_SCREEN"),U=U?U.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return U}}),H),Object(s["a"])(H,"MESSAGE_PLAYER_DEATH",[T],(z=Object.getOwnPropertyDescriptor(H,"MESSAGE_PLAYER_DEATH"),z=z?z.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return z}}),H),Object(s["a"])(H,"MESSAGE_PLAYER_CHANGED_LANE",[T],(B=Object.getOwnPropertyDescriptor(H,"MESSAGE_PLAYER_CHANGED_LANE"),B=B?B.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return B}}),H),Object(s["a"])(H,"MESSAGE_NEXT_LEVEL",[T],(Y=Object.getOwnPropertyDescriptor(H,"MESSAGE_NEXT_LEVEL"),Y=Y?Y.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return Y}}),H),Object(s["a"])(H,"MESSAGE_PLAYER_SHOOT",[T],(W=Object.getOwnPropertyDescriptor(H,"MESSAGE_PLAYER_SHOOT"),W=W?W.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return W}}),H),Object(s["a"])(H,"MESSAGE_PLAYER_SUPERZAPPER_USED",[T],(K=Object.getOwnPropertyDescriptor(H,"MESSAGE_PLAYER_SUPERZAPPER_USED"),K=K?K.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return K}}),H),Object(s["a"])(H,"MESSAGE_ENEMY_SHOOT",[T],(V=Object.getOwnPropertyDescriptor(H,"MESSAGE_ENEMY_SHOOT"),V=V?V.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return V}}),H),Object(s["a"])(H,"MESSAGE_ENEMY_DEATH",[T],(X=Object.getOwnPropertyDescriptor(H,"MESSAGE_ENEMY_DEATH"),X=X?X.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return X}}),H),Object(s["a"])(H,"MESSAGE_MENU_CHANGE",[T],(J=Object.getOwnPropertyDescriptor(H,"MESSAGE_MENU_CHANGE"),J=J?J.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return J}}),H),Object(s["a"])(H,"MESSAGE_MENU_SELECT",[T],(Z=Object.getOwnPropertyDescriptor(H,"MESSAGE_MENU_SELECT"),Z=Z?Z.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return Z}}),H),H),Hi=function(){function e(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];Object(a["a"])(this,e),Object(r["a"])(this,"topic",void 0),Object(r["a"])(this,"message",void 0),Object(r["a"])(this,"context",void 0),this.topic=t,this.message=i,this.context=n}return Object(n["a"])(e,[{key:"isTopic",value:function(e){return this.topic===e}},{key:"isMessage",value:function(e){return this.message===e}}]),e}(),ki=new Fi,Ui=ki,zi=(ie=te=function(e){Object(_["a"])(i,e);var t=Object(S["a"])(i);function i(e,n,s,o,c,l){var u;if(Object(a["a"])(this,i),u=t.call(this,e,n,o,l),Object(r["a"])(Object(h["a"])(u),"firstLevel",void 0),Object(r["a"])(Object(h["a"])(u),"valueInPoints",void 0),Object(r["a"])(Object(h["a"])(u),"rewardCallback",void 0),Object(r["a"])(Object(h["a"])(u),"reward",!1),u.zPosition=c,u.rewardCallback=s,u.shootTimeoutMs=i.SHOOT_TIMEOUT_MS,u.constructor===i)throw new Error("Abstract classes can't be instantiated.");return u}return Object(n["a"])(i,[{key:"hitByProjectile",value:function(){this.reward=!0,this.die()}},{key:"fire",value:function(){Object(E["a"])(Object(b["a"])(i.prototype),"fire",this).call(this)&&Ui.publish(Fi.TOPIC_AUDIO,Fi.MESSAGE_ENEMY_SHOOT)}},{key:"die",value:function(){this.hittable=!1,this.canShoot=!1,this.clearFlags(),!0===this.reward&&(this.reward=!1,this.rewardCallback(this.valueInPoints),Ui.publish(Fi.TOPIC_AUDIO,Fi.MESSAGE_ENEMY_DEATH))}}]),i}(xi),Object(r["a"])(te,"SHOOT_TIMEOUT_MS",100),$=ie,Object(s["a"])($,"SHOOT_TIMEOUT_MS",[T],(ee=Object.getOwnPropertyDescriptor($,"SHOOT_TIMEOUT_MS"),ee=ee?ee.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return ee}}),$),$),Bi=function(e,t){return Math.floor(Math.random()*(t-e)+e)},Yi=Bi,Wi=(pe=fe=function(e){Object(_["a"])(i,e);var t=Object(S["a"])(i);function i(e,n,r){var s,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;return Object(a["a"])(this,i),s=t.call(this,e,n,r,o,c,mi.TYPE_FLIPPER),s.firstLevel=1,s.valueInPoints=150,s.zSpeed=.001*-Yi(6,9),s.setState(i.STATE_IDLE),s}return Object(n["a"])(i,[{key:"updateState",value:function(){this.inState(i.STATE_IDLE)?this.isFlagSet(i.FLAG_REACHED_TOP)?this.setState(i.STATE_ROTATING_BEGIN):this.setState(wi.drawNextState(i.STATE_IDLE,i.STATE_SHOOTING,this.isFlagNotSet(i.FLAG_CANNOT_FLIP)?i.STATE_ROTATING_BEGIN:i.STATE_IDLE)):this.inState(i.STATE_ROTATING_BEGIN)?(this.setState(i.STATE_ROTATING_END),this.isFlagSet(i.FLAG_IMMUNE_ROTATION)&&(this.unsetFlag(i.FLAG_IMMUNE_ROTATION),this.hittable=!0)):this.inState(i.STATE_ROTATING_END)?(this.isFlagSet(i.FLAG_REACHED_TOP)?this.setState(i.STATE_ROTATING_BEGIN):this.setState(i.STATE_IDLE),this.unsetFlag(i.FLAG_LANE_CHANGED),this.unsetFlag(i.FLAG_ROTATION_CW),this.unsetFlag(i.FLAG_ROTATION_CCW),this.unsetFlag(i.FLAG_ROTATION_DIR_CHOSEN)):this.inState(i.STATE_SHOOTING)?(this.setState(i.STATE_IDLE),this.unsetFlag(i.FLAG_SHOOTS_FIRED)):(this.inState(i.STATE_EXPLODING)||this.inState(i.STATE_DISAPPEARING))&&this.setState(i.STATE_DEAD)}},{key:"updateEntity",value:function(){if(this.inState(i.STATE_DEAD)&&(this.alive=!1),this.zPosition<=0&&this.isFlagNotSet(i.FLAG_REACHED_TOP)&&(this.setFlag(i.FLAG_REACHED_TOP),this.zPosition=0),this.inState(i.STATE_ROTATING_BEGIN)&&this.isFlagNotSet(i.FLAG_ROTATION_DIR_CHOSEN))if(this.setFlag(i.FLAG_ROTATION_DIR_CHOSEN),this.isFlagSet(i.FLAG_REACHED_TOP)){var e=this.surface.getShortestPathDirection(this.laneId,this.surface.activeLaneId);1===e?(this.setFlag(i.FLAG_ROTATION_CCW),this.unsetFlag(i.FLAG_ROTATION_CW),this.unsetFlag(i.FLAG_REACHED_SHOOTER)):-1===e?(this.setFlag(i.FLAG_ROTATION_CW),this.unsetFlag(i.FLAG_ROTATION_CCW),this.unsetFlag(i.FLAG_REACHED_SHOOTER)):this.setFlag(i.FLAG_REACHED_SHOOTER)}else if(this.isFlagNotSet(i.FLAG_ROTATION_CW)&&this.isFlagNotSet(i.FLAG_ROTATION_CCW)){var t=this.surface.getActualLaneIdFromProjectedMovement(this.laneId+1)!==this.laneId,a=this.surface.getActualLaneIdFromProjectedMovement(this.laneId-1)!==this.laneId;t&&a?this.setFlag(Math.random()>.5?i.FLAG_ROTATION_CW:i.FLAG_ROTATION_CCW):a?this.setFlag(i.FLAG_ROTATION_CW):this.setFlag(i.FLAG_ROTATION_CCW)}if(this.inState(i.STATE_ROTATING_END)&&this.isFlagNotSet(i.FLAG_LANE_CHANGED)&&(this.setFlag(i.FLAG_LANE_CHANGED),this.isFlagSet(i.FLAG_ROTATION_CW)||this.isFlagSet(i.FLAG_ROTATION_CCW))){var n=this.isFlagSet(i.FLAG_ROTATION_CCW)?1:-1;this.setLane(this.laneId+n)}this.inState(i.STATE_SHOOTING)&&this.isFlagNotSet(i.FLAG_SHOOTS_FIRED)&&(this.setFlag(i.FLAG_SHOOTS_FIRED),this.fire()),this.isFlagNotSet(i.FLAG_REACHED_TOP)&&!this.inState(i.STATE_EXPLODING)&&(this.zPosition+=this.zSpeed)}},{key:"cannotFlip",value:function(){this.setFlag(i.FLAG_CANNOT_FLIP)}},{key:"immuneDuringNextRotation",value:function(){this.setFlag(i.FLAG_IMMUNE_ROTATION),this.hittable=!1}},{key:"disappear",value:function(){this.inState(i.STATE_EXPLODING)||this.inState(i.STATE_DEAD)||(this.setState(i.STATE_DISAPPEARING),Object(E["a"])(Object(b["a"])(i.prototype),"die",this).call(this))}},{key:"die",value:function(){this.inState(i.STATE_DEAD)||(this.setState(i.STATE_EXPLODING),Object(E["a"])(Object(b["a"])(i.prototype),"die",this).call(this))}}]),i}(zi),Object(r["a"])(fe,"STATE_IDLE",new wi(100,1,"idle")),Object(r["a"])(fe,"STATE_ROTATING_BEGIN",new wi(175,.2,"rotate_begin")),Object(r["a"])(fe,"STATE_ROTATING_END",new wi(175,1,"rotate_end")),Object(r["a"])(fe,"STATE_SHOOTING",new wi(100,.1,"shooting")),Object(r["a"])(fe,"STATE_DISAPPEARING",new wi(1e3,1,"disappearing")),Object(r["a"])(fe,"STATE_EXPLODING",new wi(1e3,1,"exploding")),Object(r["a"])(fe,"STATE_DEAD",new wi(0,1,"dead")),Object(r["a"])(fe,"FLAG_REACHED_TOP",1),Object(r["a"])(fe,"FLAG_SHOOTS_FIRED",2),Object(r["a"])(fe,"FLAG_LANE_CHANGED",4),Object(r["a"])(fe,"FLAG_ROTATION_CW",8),Object(r["a"])(fe,"FLAG_ROTATION_CCW",16),Object(r["a"])(fe,"FLAG_ROTATION_DIR_CHOSEN",32),Object(r["a"])(fe,"FLAG_IMMUNE_ROTATION",64),Object(r["a"])(fe,"FLAG_REACHED_SHOOTER",128),Object(r["a"])(fe,"FLAG_CANNOT_FLIP",256),ae=pe,Object(s["a"])(ae,"STATE_IDLE",[T],(ne=Object.getOwnPropertyDescriptor(ae,"STATE_IDLE"),ne=ne?ne.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return ne}}),ae),Object(s["a"])(ae,"STATE_ROTATING_BEGIN",[T],(re=Object.getOwnPropertyDescriptor(ae,"STATE_ROTATING_BEGIN"),re=re?re.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return re}}),ae),Object(s["a"])(ae,"STATE_ROTATING_END",[T],(se=Object.getOwnPropertyDescriptor(ae,"STATE_ROTATING_END"),se=se?se.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return se}}),ae),Object(s["a"])(ae,"STATE_SHOOTING",[T],(oe=Object.getOwnPropertyDescriptor(ae,"STATE_SHOOTING"),oe=oe?oe.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return oe}}),ae),Object(s["a"])(ae,"STATE_DISAPPEARING",[T],(ce=Object.getOwnPropertyDescriptor(ae,"STATE_DISAPPEARING"),ce=ce?ce.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return ce}}),ae),Object(s["a"])(ae,"STATE_EXPLODING",[T],(le=Object.getOwnPropertyDescriptor(ae,"STATE_EXPLODING"),le=le?le.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return le}}),ae),Object(s["a"])(ae,"STATE_DEAD",[T],(ue=Object.getOwnPropertyDescriptor(ae,"STATE_DEAD"),ue=ue?ue.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return ue}}),ae),Object(s["a"])(ae,"FLAG_REACHED_TOP",[T],(Oe=Object.getOwnPropertyDescriptor(ae,"FLAG_REACHED_TOP"),Oe=Oe?Oe.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return Oe}}),ae),Object(s["a"])(ae,"FLAG_SHOOTS_FIRED",[T],(he=Object.getOwnPropertyDescriptor(ae,"FLAG_SHOOTS_FIRED"),he=he?he.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return he}}),ae),Object(s["a"])(ae,"FLAG_LANE_CHANGED",[T],(Ee=Object.getOwnPropertyDescriptor(ae,"FLAG_LANE_CHANGED"),Ee=Ee?Ee.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return Ee}}),ae),Object(s["a"])(ae,"FLAG_ROTATION_CW",[T],(be=Object.getOwnPropertyDescriptor(ae,"FLAG_ROTATION_CW"),be=be?be.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return be}}),ae),Object(s["a"])(ae,"FLAG_ROTATION_CCW",[T],(_e=Object.getOwnPropertyDescriptor(ae,"FLAG_ROTATION_CCW"),_e=_e?_e.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return _e}}),ae),Object(s["a"])(ae,"FLAG_ROTATION_DIR_CHOSEN",[T],(Se=Object.getOwnPropertyDescriptor(ae,"FLAG_ROTATION_DIR_CHOSEN"),Se=Se?Se.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return Se}}),ae),Object(s["a"])(ae,"FLAG_IMMUNE_ROTATION",[T],(Te=Object.getOwnPropertyDescriptor(ae,"FLAG_IMMUNE_ROTATION"),Te=Te?Te.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return Te}}),ae),Object(s["a"])(ae,"FLAG_REACHED_SHOOTER",[T],(Ae=Object.getOwnPropertyDescriptor(ae,"FLAG_REACHED_SHOOTER"),Ae=Ae?Ae.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return Ae}}),ae),Object(s["a"])(ae,"FLAG_CANNOT_FLIP",[T],(de=Object.getOwnPropertyDescriptor(ae,"FLAG_CANNOT_FLIP"),de=de?de.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return de}}),ae),ae),Ki=(Be=ze=function(e){Object(_["a"])(i,e);var t=Object(S["a"])(i);function i(e,n,s){var o,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;return Object(a["a"])(this,i),o=t.call(this,e,n,s,c,l,mi.TYPE_FUSEBALL),Object(r["a"])(Object(h["a"])(o),"zBase",0),Object(r["a"])(Object(h["a"])(o),"zTarget",0),Object(r["a"])(Object(h["a"])(o),"laneChanges",0),Object(r["a"])(Object(h["a"])(o),"lastLaneSwitchingProgress",0),o.firstLevel=11,o.valueInPoints=250,o.setState(i.STATE_MOVING_ALONG_LINE),o.setFlag(i.FLAG_IMMUNE),o}return Object(n["a"])(i,[{key:"updateState",value:function(){this.inState(i.STATE_MOVING_ALONG_LINE)?(this.setState(i.STATE_SWITCHING_LANE),this.unsetFlag(i.FLAG_IMMUNE),this.unsetFlag(i.FLAG_MOVING_TARGET_CHOSEN)):this.inState(i.STATE_SWITCHING_LANE)?(this.isFlagSet(i.FLAG_REACHED_TOP)?this.setState(i.STATE_SWITCHING_LANE):this.setState(i.STATE_MOVING_ALONG_LINE),this.isFlagSet(i.FLAG_SWITCHING_LANE_CW)&&this.setFlag(i.FLAG_SET_LANE_CW),this.setFlag(i.FLAG_IMMUNE),this.unsetFlag(i.FLAG_SWITCHING_DIR_CHOSEN),this.unsetFlag(i.FLAG_SWITCHING_LANE_CCW),this.unsetFlag(i.FLAG_SWITCHING_LANE_CW),this.unsetFlag(i.FLAG_LANE_CHANGED)):(this.inState(i.STATE_EXPLODING)||this.inState(i.STATE_DISAPPEARING))&&this.setState(i.STATE_DEAD)}},{key:"updateEntity",value:function(){if(this.inState(i.STATE_DEAD)&&(this.alive=!1),this.inState(i.STATE_EXPLODING)||(this.hittable=!this.isFlagSet(i.FLAG_IMMUNE)),this.inState(i.STATE_SWITCHING_LANE)&&this.isFlagNotSet(i.FLAG_SWITCHING_DIR_CHOSEN))if(this.setFlag(i.FLAG_SWITCHING_DIR_CHOSEN),this.isFlagSet(i.FLAG_REACHED_TOP)){var e=this.surface.getShortestPathDirection(this.laneId,this.surface.activeLaneId);-1===e?(this.setFlag(i.FLAG_SWITCHING_LANE_CCW),this.setFlag(i.FLAG_SET_LANE_CCW),this.unsetFlag(i.FLAG_SWITCHING_LANE_CW),this.unsetFlag(i.FLAG_REACHED_SHOOTER)):1===e?(this.setFlag(i.FLAG_SWITCHING_LANE_CW),this.setFlag(i.FLAG_SET_LANE_CW),this.unsetFlag(i.FLAG_SWITCHING_LANE_CCW),this.unsetFlag(i.FLAG_REACHED_SHOOTER)):this.setFlag(i.FLAG_REACHED_SHOOTER)}else if(this.isFlagNotSet(i.FLAG_SWITCHING_LANE_CW)&&this.isFlagNotSet(i.FLAG_SWITCHING_LANE_CCW)){var t=this.surface.getActualLaneIdFromProjectedMovement(this.laneId+1)!==this.laneId,a=this.surface.getActualLaneIdFromProjectedMovement(this.laneId-1)!==this.laneId;t&&a?Math.random()>.5?this.setFlag(i.FLAG_SWITCHING_LANE_CW):(this.setFlag(i.FLAG_SWITCHING_LANE_CCW),this.setFlag(i.FLAG_SET_LANE_CCW)):a?this.setFlag(i.FLAG_SWITCHING_LANE_CW):(this.setFlag(i.FLAG_SWITCHING_LANE_CCW),this.setFlag(i.FLAG_SET_LANE_CCW))}if(this.inState(i.STATE_SWITCHING_LANE)&&this.isFlagNotSet(i.FLAG_LANE_CHANGED)&&(this.setFlag(i.FLAG_LANE_CHANGED),this.laneChanges++),this.isFlagSet(i.FLAG_SET_LANE_CW)||this.isFlagSet(i.FLAG_SET_LANE_CCW)){var n=this.isFlagSet(i.FLAG_SET_LANE_CW)?1:-1;this.setLane(this.laneId+n),this.unsetFlag(i.FLAG_SET_LANE_CW),this.unsetFlag(i.FLAG_SET_LANE_CCW)}if(this.inState(i.STATE_MOVING_ALONG_LINE)&&this.isFlagNotSet(i.FLAG_MOVING_TARGET_CHOSEN)&&this.isFlagNotSet(i.FLAG_REACHED_TOP)&&(this.setFlag(i.FLAG_MOVING_TARGET_CHOSEN),this.zBase=this.zPosition,this.zTarget=Yi(10*i.MIN_Z_POSITION,10*i.MAX_Z_POSITION)/10,this.laneChanges>=i.MIN_AMOUNT_OF_LANE_CHANGES_UNTIL_TOP)){var r=(this.laneChanges-i.MIN_AMOUNT_OF_LANE_CHANGES_UNTIL_TOP)/i.MAX_AMOUNT_OF_LANE_CHANGES_UNTIL_TOP;Math.random()<r*r&&(this.zTarget=0)}this.inState(i.STATE_SWITCHING_LANE)&&(this.zPosition=this.zTarget,this.lastLaneSwitchingProgress=this.stateProgressInTime(),0===this.zPosition&&this.setFlag(i.FLAG_REACHED_TOP)),this.inState(i.STATE_MOVING_ALONG_LINE)&&(this.zPosition=this.zBase+(this.zTarget-this.zBase)*this.stateProgressInTime())}},{key:"immuneDuringNextLaneSwitch",value:function(){this.setFlag(i.FLAG_IMMUNE),this.hittable=!1}},{key:"disappear",value:function(){this.inState(i.STATE_EXPLODING)||this.inState(i.STATE_DEAD)||(this.setState(i.STATE_DISAPPEARING),Object(E["a"])(Object(b["a"])(i.prototype),"die",this).call(this))}},{key:"die",value:function(){this.inState(i.STATE_DEAD)||(this.setState(i.STATE_EXPLODING),Object(E["a"])(Object(b["a"])(i.prototype),"die",this).call(this))}}]),i}(zi),Object(r["a"])(ze,"MIN_Z_POSITION",.1),Object(r["a"])(ze,"MAX_Z_POSITION",.9),Object(r["a"])(ze,"MIN_AMOUNT_OF_LANE_CHANGES_UNTIL_TOP",2),Object(r["a"])(ze,"MAX_AMOUNT_OF_LANE_CHANGES_UNTIL_TOP",10),Object(r["a"])(ze,"STATE_MOVING_ALONG_LINE",new wi(1500,1,"moving_along_line")),Object(r["a"])(ze,"STATE_SWITCHING_LANE",new wi(2e3,1,"switching_lane")),Object(r["a"])(ze,"STATE_DISAPPEARING",new wi(1e3,1,"disappearing")),Object(r["a"])(ze,"STATE_EXPLODING",new wi(1e3,1,"exploding")),Object(r["a"])(ze,"STATE_DEAD",new wi(0,1,"dead")),Object(r["a"])(ze,"FLAG_REACHED_TOP",1),Object(r["a"])(ze,"FLAG_LANE_CHANGED",2),Object(r["a"])(ze,"FLAG_SWITCHING_LANE_CW",4),Object(r["a"])(ze,"FLAG_SWITCHING_LANE_CCW",8),Object(r["a"])(ze,"FLAG_SET_LANE_CW",16),Object(r["a"])(ze,"FLAG_SET_LANE_CCW",32),Object(r["a"])(ze,"FLAG_SWITCHING_DIR_CHOSEN",64),Object(r["a"])(ze,"FLAG_MOVING_TARGET_CHOSEN",128),Object(r["a"])(ze,"FLAG_IMMUNE",256),Object(r["a"])(ze,"FLAG_REACHED_SHOOTER",512),ve=Be,Object(s["a"])(ve,"MIN_Z_POSITION",[T],(je=Object.getOwnPropertyDescriptor(ve,"MIN_Z_POSITION"),je=je?je.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return je}}),ve),Object(s["a"])(ve,"MAX_Z_POSITION",[T],(ge=Object.getOwnPropertyDescriptor(ve,"MAX_Z_POSITION"),ge=ge?ge.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return ge}}),ve),Object(s["a"])(ve,"MIN_AMOUNT_OF_LANE_CHANGES_UNTIL_TOP",[T],(Le=Object.getOwnPropertyDescriptor(ve,"MIN_AMOUNT_OF_LANE_CHANGES_UNTIL_TOP"),Le=Le?Le.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return Le}}),ve),Object(s["a"])(ve,"MAX_AMOUNT_OF_LANE_CHANGES_UNTIL_TOP",[T],(ye=Object.getOwnPropertyDescriptor(ve,"MAX_AMOUNT_OF_LANE_CHANGES_UNTIL_TOP"),ye=ye?ye.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return ye}}),ve),Object(s["a"])(ve,"STATE_MOVING_ALONG_LINE",[T],(Ie=Object.getOwnPropertyDescriptor(ve,"STATE_MOVING_ALONG_LINE"),Ie=Ie?Ie.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return Ie}}),ve),Object(s["a"])(ve,"STATE_SWITCHING_LANE",[T],(Ne=Object.getOwnPropertyDescriptor(ve,"STATE_SWITCHING_LANE"),Ne=Ne?Ne.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return Ne}}),ve),Object(s["a"])(ve,"STATE_DISAPPEARING",[T],(Re=Object.getOwnPropertyDescriptor(ve,"STATE_DISAPPEARING"),Re=Re?Re.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return Re}}),ve),Object(s["a"])(ve,"STATE_EXPLODING",[T],(Pe=Object.getOwnPropertyDescriptor(ve,"STATE_EXPLODING"),Pe=Pe?Pe.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return Pe}}),ve),Object(s["a"])(ve,"STATE_DEAD",[T],(Ce=Object.getOwnPropertyDescriptor(ve,"STATE_DEAD"),Ce=Ce?Ce.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return Ce}}),ve),Object(s["a"])(ve,"FLAG_REACHED_TOP",[T],(De=Object.getOwnPropertyDescriptor(ve,"FLAG_REACHED_TOP"),De=De?De.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return De}}),ve),Object(s["a"])(ve,"FLAG_LANE_CHANGED",[T],(Ge=Object.getOwnPropertyDescriptor(ve,"FLAG_LANE_CHANGED"),Ge=Ge?Ge.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return Ge}}),ve),Object(s["a"])(ve,"FLAG_SWITCHING_LANE_CW",[T],(we=Object.getOwnPropertyDescriptor(ve,"FLAG_SWITCHING_LANE_CW"),we=we?we.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return we}}),ve),Object(s["a"])(ve,"FLAG_SWITCHING_LANE_CCW",[T],(me=Object.getOwnPropertyDescriptor(ve,"FLAG_SWITCHING_LANE_CCW"),me=me?me.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return me}}),ve),Object(s["a"])(ve,"FLAG_SET_LANE_CW",[T],(Me=Object.getOwnPropertyDescriptor(ve,"FLAG_SET_LANE_CW"),Me=Me?Me.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return Me}}),ve),Object(s["a"])(ve,"FLAG_SET_LANE_CCW",[T],(xe=Object.getOwnPropertyDescriptor(ve,"FLAG_SET_LANE_CCW"),xe=xe?xe.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return xe}}),ve),Object(s["a"])(ve,"FLAG_SWITCHING_DIR_CHOSEN",[T],(Fe=Object.getOwnPropertyDescriptor(ve,"FLAG_SWITCHING_DIR_CHOSEN"),Fe=Fe?Fe.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return Fe}}),ve),Object(s["a"])(ve,"FLAG_MOVING_TARGET_CHOSEN",[T],(He=Object.getOwnPropertyDescriptor(ve,"FLAG_MOVING_TARGET_CHOSEN"),He=He?He.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return He}}),ve),Object(s["a"])(ve,"FLAG_IMMUNE",[T],(ke=Object.getOwnPropertyDescriptor(ve,"FLAG_IMMUNE"),ke=ke?ke.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return ke}}),ve),Object(s["a"])(ve,"FLAG_REACHED_SHOOTER",[T],(Ue=Object.getOwnPropertyDescriptor(ve,"FLAG_REACHED_SHOOTER"),Ue=Ue?Ue.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return Ue}}),ve),ve),Vi=(lt=ct=function(e){Object(_["a"])(i,e);var t=Object(S["a"])(i);function i(e,n,s,o){var c,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return Object(a["a"])(this,i),c=t.call(this,e,n,l,mi.TYPE_SHOOTER),Object(r["a"])(Object(h["a"])(c),"penaltyTimestamp",0),Object(r["a"])(Object(h["a"])(c),"lastLaneChangeTimestamp",void 0),Object(r["a"])(Object(h["a"])(c),"laneChangeTimeoutMs",void 0),Object(r["a"])(Object(h["a"])(c),"surfaceObjectsManager",void 0),Object(r["a"])(Object(h["a"])(c),"killedCallback",void 0),c.surfaceObjectsManager=s,c.killedCallback=o,c.zPosition=0,c.shootTimeoutMs=i.SHOOT_TIMEOUT_MS,c.laneChangeTimeoutMs=i.LANE_CHANGE_TIMEOUT_MS,c.hittable=!1,c.canShoot=!1,c.surface.setActiveLane(l),c.setState(i.STATE_APPROACHING_TUBE),c}return Object(n["a"])(i,[{key:"updateState",value:function(){this.inState(i.STATE_RENOVATING)?(this.hittable=!0,this.canShoot=!0,this.setState(i.STATE_ALIVE)):this.inState(i.STATE_EXPLODING)?(this.setState(i.STATE_DEAD),this.killedCallback()):this.inState(i.STATE_DISAPPEARING)?this.setState(i.STATE_DEAD):this.inState(i.STATE_DEAD)?this.alive=!1:this.inState(i.STATE_GOING_DOWN_THE_TUBE)?(this.setState(i.STATE_REACHED_TUBE_BOTTOM),this.die()):this.inState(i.STATE_APPROACHING_TUBE)&&(this.hittable=!0,this.canShoot=!0,this.setState(i.STATE_ALIVE))}},{key:"updateEntity",value:function(){this.isFlagNotSet(i.FLAG_ITS_ALREADY_TOO_LATE)&&(this.handleShortedLanes(),this.inState(i.STATE_GOING_DOWN_THE_TUBE)?this.zPosition<=1&&(this.handleCollisionWithEnemy(),this.handleCollisionWithSpike()):this.handleCaptureByEnemy()),this.inState(i.STATE_GOING_DOWN_THE_TUBE)?this.zPosition=this.stateProgressInTime()*i.TUBE_DESCENDING_LENGTH_MULTIPLIER:this.inState(i.STATE_APPROACHING_TUBE)?this.zPosition=-1*(1-this.stateProgressInTime())*i.TUBE_APPROACHING_LENGTH_MULTIPLIER:(this.inState(i.STATE_ALIVE)||this.inState(i.STATE_RENOVATING))&&(this.zPosition=0)}},{key:"handleShortedLanes",value:function(){this.surface.isLaneShorted(this.laneId)&&this.shockedByPulsar()}},{key:"handleCaptureByEnemy",value:function(){var e=this,t=this.surfaceObjectsManager.enemiesMap[this.laneId];t.length>0&&t.forEach((function(t){t.type===zi.TYPE_FLIPPER&&t.isFlagSet(Wi.FLAG_REACHED_SHOOTER)&&e.capturedByFlipper(),t.type===zi.TYPE_FUSEBALL&&t.isFlagSet(Ki.FLAG_REACHED_SHOOTER)&&e.capturedByFuseball()}))}},{key:"handleCollisionWithEnemy",value:function(){var e=this,t=this.surfaceObjectsManager.enemiesMap[this.laneId],a=t.findIndex((function(t){return t.hittable&&t.alive&&t.zPosition>=e.zPosition-i.COLLISION_RADIUS_BACKWARD&&t.zPosition<=e.zPosition+i.COLLISION_RADIUS_FORWARD}));a>=0&&(t[a].hitByProjectile(),this.hitByProjectile())}},{key:"handleCollisionWithSpike",value:function(){var e=this,t=this.surfaceObjectsManager.spikesMap[this.laneId],a=t.findIndex((function(t){return t.hittable&&t.alive&&t.zPosition<=e.zPosition+i.COLLISION_RADIUS_FORWARD}));a>=0&&this.impaledOnSpike()}},{key:"moveToLane",value:function(e){if(this.inState(i.STATE_ALIVE)||this.inState(i.STATE_GOING_DOWN_THE_TUBE)||this.inState(i.STATE_APPROACHING_TUBE)){var t=Date.now();t-this.lastLaneChangeTimestamp<i.LANE_CHANGE_TIMEOUT_MS||(this.setLane(e),this.surface.setActiveLane(this.laneId),this.lastLaneChangeTimestamp=t,Ui.publish(Fi.TOPIC_AUDIO,Fi.MESSAGE_PLAYER_CHANGED_LANE))}}},{key:"moveLeft",value:function(){this.moveToLane(this.laneId+1)}},{key:"moveRight",value:function(){this.moveToLane(this.laneId-1)}},{key:"fire",value:function(){if(this.canShoot&&!(this.zPosition>1)&&(this.inState(i.STATE_ALIVE)||this.inState(i.STATE_GOING_DOWN_THE_TUBE))){var e=Date.now();e-this.penaltyTimestamp<i.BURST_PENALTY_MS||(!1===Object(E["a"])(Object(b["a"])(i.prototype),"fire",this).call(this)?this.penaltyTimestamp=e:Ui.publish(Fi.TOPIC_AUDIO,Fi.MESSAGE_PLAYER_SHOOT))}}},{key:"hitByProjectile",value:function(){console.log("BOOM! (projectile)"),this.setState(i.STATE_EXPLODING),this.die(),Ui.publish(Fi.TOPIC_AUDIO,Fi.MESSAGE_PLAYER_DEATH)}},{key:"capturedByFlipper",value:function(){console.log("BAM! (flipper)"),this.setState(i.STATE_EXPLODING),this.die(),Ui.publish(Fi.TOPIC_AUDIO,Fi.MESSAGE_PLAYER_DEATH)}},{key:"capturedByFuseball",value:function(){console.log("POW! (fuseball)"),this.setState(i.STATE_EXPLODING),this.die(),Ui.publish(Fi.TOPIC_AUDIO,Fi.MESSAGE_PLAYER_DEATH)}},{key:"impaledOnSpike",value:function(){console.log("SPUT! (spike)"),this.setState(i.STATE_EXPLODING),this.die(),Ui.publish(Fi.TOPIC_AUDIO,Fi.MESSAGE_PLAYER_DEATH)}},{key:"shockedByPulsar",value:function(){console.log("BZZZT! (pulsar)"),this.setState(i.STATE_EXPLODING),this.die(),Ui.publish(Fi.TOPIC_AUDIO,Fi.MESSAGE_PLAYER_DEATH)}},{key:"die",value:function(){this.setFlag(i.FLAG_ITS_ALREADY_TOO_LATE),this.hittable=!1,this.canShoot=!1}},{key:"disappear",value:function(){this.inState(i.STATE_EXPLODING)||this.inState(i.STATE_DEAD)||(this.setState(i.STATE_DISAPPEARING),this.die())}},{key:"fireSuperzapper",value:function(){this.canShoot&&(this.inState(i.STATE_ALIVE)||this.inState(i.STATE_GOING_DOWN_THE_TUBE))&&this.isFlagNotSet(i.FLAG_SUPERZAPPER_USED)&&(this.setFlag(i.FLAG_SUPERZAPPER_USED),Ui.publish(Fi.TOPIC_SCREEN,Fi.MESSAGE_PLAYER_SUPERZAPPER_USED),Ui.publish(Fi.TOPIC_AUDIO,Fi.MESSAGE_PLAYER_SUPERZAPPER_USED),this.surfaceObjectsManager.handleSuperzapper())}},{key:"renovate",value:function(){this.setState(i.STATE_RENOVATING),this.alive=!0;var e=this.isFlagSet(i.FLAG_SUPERZAPPER_USED);this.clearFlags(),e&&this.setFlag(i.FLAG_SUPERZAPPER_USED)}}]),i}(xi),Object(r["a"])(ct,"LANE_CHANGE_TIMEOUT_MS",50),Object(r["a"])(ct,"SHOOT_TIMEOUT_MS",80),Object(r["a"])(ct,"BURST_PENALTY_MS",500),Object(r["a"])(ct,"TUBE_DESCENDING_LENGTH_MULTIPLIER",2),Object(r["a"])(ct,"TUBE_APPROACHING_LENGTH_MULTIPLIER",4),Object(r["a"])(ct,"COLLISION_RADIUS_FORWARD",0),Object(r["a"])(ct,"COLLISION_RADIUS_BACKWARD",.08),Object(r["a"])(ct,"STATE_ALIVE",new wi(1e3,1,"alive")),Object(r["a"])(ct,"STATE_EXPLODING",new wi(1e3,1,"exploding")),Object(r["a"])(ct,"STATE_DISAPPEARING",new wi(1e3,1,"disappearing")),Object(r["a"])(ct,"STATE_RENOVATING",new wi(1e3,1,"renovating")),Object(r["a"])(ct,"STATE_APPROACHING_TUBE",new wi(2e3,1,"approaching_tube")),Object(r["a"])(ct,"STATE_GOING_DOWN_THE_TUBE",new wi(4e3,1,"going_down_the_tube")),Object(r["a"])(ct,"STATE_REACHED_TUBE_BOTTOM",new wi(0,1,"reached_tube_bottom")),Object(r["a"])(ct,"STATE_DEAD",new wi(0,1,"dead")),Object(r["a"])(ct,"FLAG_ITS_ALREADY_TOO_LATE",1),Object(r["a"])(ct,"FLAG_SUPERZAPPER_USED",2),Ye=lt,Object(s["a"])(Ye,"LANE_CHANGE_TIMEOUT_MS",[T],(We=Object.getOwnPropertyDescriptor(Ye,"LANE_CHANGE_TIMEOUT_MS"),We=We?We.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return We}}),Ye),Object(s["a"])(Ye,"SHOOT_TIMEOUT_MS",[T],(Ke=Object.getOwnPropertyDescriptor(Ye,"SHOOT_TIMEOUT_MS"),Ke=Ke?Ke.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return Ke}}),Ye),Object(s["a"])(Ye,"BURST_PENALTY_MS",[T],(Ve=Object.getOwnPropertyDescriptor(Ye,"BURST_PENALTY_MS"),Ve=Ve?Ve.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return Ve}}),Ye),Object(s["a"])(Ye,"TUBE_DESCENDING_LENGTH_MULTIPLIER",[T],(Xe=Object.getOwnPropertyDescriptor(Ye,"TUBE_DESCENDING_LENGTH_MULTIPLIER"),Xe=Xe?Xe.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return Xe}}),Ye),Object(s["a"])(Ye,"TUBE_APPROACHING_LENGTH_MULTIPLIER",[T],(Je=Object.getOwnPropertyDescriptor(Ye,"TUBE_APPROACHING_LENGTH_MULTIPLIER"),Je=Je?Je.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return Je}}),Ye),Object(s["a"])(Ye,"COLLISION_RADIUS_FORWARD",[T],(Ze=Object.getOwnPropertyDescriptor(Ye,"COLLISION_RADIUS_FORWARD"),Ze=Ze?Ze.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return Ze}}),Ye),Object(s["a"])(Ye,"COLLISION_RADIUS_BACKWARD",[T],(qe=Object.getOwnPropertyDescriptor(Ye,"COLLISION_RADIUS_BACKWARD"),qe=qe?qe.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return qe}}),Ye),Object(s["a"])(Ye,"STATE_ALIVE",[T],(Qe=Object.getOwnPropertyDescriptor(Ye,"STATE_ALIVE"),Qe=Qe?Qe.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return Qe}}),Ye),Object(s["a"])(Ye,"STATE_EXPLODING",[T],($e=Object.getOwnPropertyDescriptor(Ye,"STATE_EXPLODING"),$e=$e?$e.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return $e}}),Ye),Object(s["a"])(Ye,"STATE_DISAPPEARING",[T],(et=Object.getOwnPropertyDescriptor(Ye,"STATE_DISAPPEARING"),et=et?et.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return et}}),Ye),Object(s["a"])(Ye,"STATE_RENOVATING",[T],(tt=Object.getOwnPropertyDescriptor(Ye,"STATE_RENOVATING"),tt=tt?tt.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return tt}}),Ye),Object(s["a"])(Ye,"STATE_APPROACHING_TUBE",[T],(it=Object.getOwnPropertyDescriptor(Ye,"STATE_APPROACHING_TUBE"),it=it?it.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return it}}),Ye),Object(s["a"])(Ye,"STATE_GOING_DOWN_THE_TUBE",[T],(at=Object.getOwnPropertyDescriptor(Ye,"STATE_GOING_DOWN_THE_TUBE"),at=at?at.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return at}}),Ye),Object(s["a"])(Ye,"STATE_REACHED_TUBE_BOTTOM",[T],(nt=Object.getOwnPropertyDescriptor(Ye,"STATE_REACHED_TUBE_BOTTOM"),nt=nt?nt.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return nt}}),Ye),Object(s["a"])(Ye,"STATE_DEAD",[T],(rt=Object.getOwnPropertyDescriptor(Ye,"STATE_DEAD"),rt=rt?rt.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return rt}}),Ye),Object(s["a"])(Ye,"FLAG_ITS_ALREADY_TOO_LATE",[T],(st=Object.getOwnPropertyDescriptor(Ye,"FLAG_ITS_ALREADY_TOO_LATE"),st=st?st.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return st}}),Ye),Object(s["a"])(Ye,"FLAG_SUPERZAPPER_USED",[T],(ot=Object.getOwnPropertyDescriptor(Ye,"FLAG_SUPERZAPPER_USED"),ot=ot?ot.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return ot}}),Ye),Ye),Xi=(i("d81d"),Et=ht=function(){function e(){Object(a["a"])(this,e),Object(r["a"])(this,"lastGarbageCollectorExecutionTimestamp",0),Object(r["a"])(this,"forceMapsUpdate",!1)}return Object(n["a"])(e,[{key:"shouldTriggerGarbageCollector",value:function(){var t=Date.now();return!(t-this.lastGarbageCollectorExecutionTimestamp<e.GARBAGE_COLLECTION_TIMEOUT_MS)&&(this.lastGarbageCollectorExecutionTimestamp=t,!0)}}],[{key:"garbageCollector",value:function(e){if(0===e.length)return 0;var t=e.findIndex((function(e){return e.alive}));if(0===t)return 0;if(-1===t){var i=e.length;return e.length=0,i}return e.splice(0,t),t}},{key:"updateMap",value:function(e,t,i){var a=e.filter((function(e){return e.shouldUpdateFIFOMaps()})).length;return!(!i&&!a)&&(t.forEach((function(e){return e.length=0})),e.forEach((function(e){t[e.laneId].push(e)})),!0)}}]),e}(),Object(r["a"])(ht,"GARBAGE_COLLECTION_TIMEOUT_MS",200),ut=Et,Object(s["a"])(ut,"GARBAGE_COLLECTION_TIMEOUT_MS",[T],(Ot=Object.getOwnPropertyDescriptor(ut,"GARBAGE_COLLECTION_TIMEOUT_MS"),Ot=Ot?Ot.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return Ot}}),ut),ut),Ji=(gt=jt=function(e){Object(_["a"])(i,e);var t=Object(S["a"])(i);function i(e,n,r){var s,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;return Object(a["a"])(this,i),s=t.call(this,e,n,r,o,c,mi.TYPE_SPIKER),s.firstLevel=4,s.valueInPoints=150,s.zSpeed=.001*-Yi(3,6),s.setState(i.STATE_IDLE),s}return Object(n["a"])(i,[{key:"updateState",value:function(){this.inState(i.STATE_IDLE)?this.setState(wi.drawNextState(i.STATE_IDLE,i.STATE_SHOOTING)):this.inState(i.STATE_SHOOTING)?(this.setState(i.STATE_IDLE),this.unsetFlag(i.FLAG_SHOOTS_FIRED)):(this.inState(i.STATE_EXPLODING)||this.inState(i.STATE_DISAPPEARING))&&this.setState(i.STATE_DEAD)}},{key:"updateEntity",value:function(){this.inState(i.STATE_DEAD)&&(this.alive=!1),this.zPosition<=i.TURNAROUND_HEIGHT&&this.isFlagNotSet(i.FLAG_REACHED_TOP)&&(this.setFlag(i.FLAG_REACHED_TOP),this.zPosition=i.TURNAROUND_HEIGHT),this.zPosition>=1&&this.isFlagSet(i.FLAG_REACHED_TOP)&&(this.alive=!1),this.inState(i.STATE_SHOOTING)&&this.isFlagNotSet(i.FLAG_SHOOTS_FIRED)&&(this.setFlag(i.FLAG_SHOOTS_FIRED),this.fire()),this.inState(i.STATE_EXPLODING)||(this.isFlagNotSet(i.FLAG_REACHED_TOP)?this.zPosition+=this.zSpeed:this.zPosition-=this.zSpeed)}},{key:"disappear",value:function(){this.inState(i.STATE_EXPLODING)||this.inState(i.STATE_DEAD)||(this.setState(i.STATE_DISAPPEARING),Object(E["a"])(Object(b["a"])(i.prototype),"die",this).call(this))}},{key:"die",value:function(){this.inState(i.STATE_DEAD)||(this.setState(i.STATE_EXPLODING),Object(E["a"])(Object(b["a"])(i.prototype),"die",this).call(this))}}]),i}(zi),Object(r["a"])(jt,"TURNAROUND_HEIGHT",.1),Object(r["a"])(jt,"STATE_IDLE",new wi(100,1,"idle")),Object(r["a"])(jt,"STATE_SHOOTING",new wi(200,.05,"shooting")),Object(r["a"])(jt,"STATE_DISAPPEARING",new wi(1e3,1,"disappearing")),Object(r["a"])(jt,"STATE_EXPLODING",new wi(1e3,1,"exploding")),Object(r["a"])(jt,"STATE_DEAD",new wi(0,1,"dead")),Object(r["a"])(jt,"FLAG_REACHED_TOP",1),Object(r["a"])(jt,"FLAG_SHOOTS_FIRED",2),bt=gt,Object(s["a"])(bt,"TURNAROUND_HEIGHT",[T],(_t=Object.getOwnPropertyDescriptor(bt,"TURNAROUND_HEIGHT"),_t=_t?_t.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return _t}}),bt),Object(s["a"])(bt,"STATE_IDLE",[T],(St=Object.getOwnPropertyDescriptor(bt,"STATE_IDLE"),St=St?St.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return St}}),bt),Object(s["a"])(bt,"STATE_SHOOTING",[T],(Tt=Object.getOwnPropertyDescriptor(bt,"STATE_SHOOTING"),Tt=Tt?Tt.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return Tt}}),bt),Object(s["a"])(bt,"STATE_DISAPPEARING",[T],(At=Object.getOwnPropertyDescriptor(bt,"STATE_DISAPPEARING"),At=At?At.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return At}}),bt),Object(s["a"])(bt,"STATE_EXPLODING",[T],(dt=Object.getOwnPropertyDescriptor(bt,"STATE_EXPLODING"),dt=dt?dt.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return dt}}),bt),Object(s["a"])(bt,"STATE_DEAD",[T],(ft=Object.getOwnPropertyDescriptor(bt,"STATE_DEAD"),ft=ft?ft.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return ft}}),bt),Object(s["a"])(bt,"FLAG_REACHED_TOP",[T],(pt=Object.getOwnPropertyDescriptor(bt,"FLAG_REACHED_TOP"),pt=pt?pt.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return pt}}),bt),Object(s["a"])(bt,"FLAG_SHOOTS_FIRED",[T],(vt=Object.getOwnPropertyDescriptor(bt,"FLAG_SHOOTS_FIRED"),vt=vt?vt.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return vt}}),bt),bt),Zi=(Dt=Ct=function(e){Object(_["a"])(i,e);var t=Object(S["a"])(i);function i(e,n,s){var o,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return Object(a["a"])(this,i),o=t.call(this,e,n,s,c,1,mi.TYPE_SPIKE),Object(r["a"])(Object(h["a"])(o),"rendererHelperZPositionChanged",!1),o.firstLevel=1,o.valueInPoints=1,o.canShoot=!1,o.canExplode=!1,o.setState(i.STATE_ALIVE),o}return Object(n["a"])(i,[{key:"updateState",value:function(){this.inState(i.STATE_DEAD)&&(this.alive=!1)}},{key:"updateEntity",value:function(){}},{key:"extendToLowestSpiker",value:function(e){if(0!==e.length){e=e.filter((function(e){return e.alive&&!e.inState(Ji.STATE_EXPLODING)&&!e.inState(Ji.STATE_DISAPPEARING)}));var t=e.map((function(e){return e.zPosition})).reduce((function(e,t){return e<t?e:t}),1);this.extendTo(t)}}},{key:"extendTo",value:function(e){var t=Math.ceil(e/i.HUNK_LENGTH)*i.HUNK_LENGTH;this.zPosition>t&&(this.zPosition=t,this.rendererHelperZPositionChanged=!0)}},{key:"hitByProjectile",value:function(){this.zPosition+=i.HIT_DESTROYED_LENGTH,this.rendererHelperZPositionChanged=!0,this.zPosition+i.HIT_DESTROYED_LENGTH>=1?(this.reward=!0,this.die()):this.rewardCallback(this.valueInPoints)}},{key:"disappear",value:function(){this.inState(i.STATE_DEAD)||this.die()}},{key:"die",value:function(){this.inState(i.STATE_DEAD)||(this.setState(i.STATE_DEAD),Object(E["a"])(Object(b["a"])(i.prototype),"die",this).call(this))}},{key:"shouldRerenderSpikeDueToSpikeLengthChange",value:function(){return!!this.rendererHelperZPositionChanged&&(this.rendererHelperZPositionChanged=!1,!0)}}]),i}(zi),Object(r["a"])(Ct,"HEIGHT_LIMIT",.9),Object(r["a"])(Ct,"HUNK_LENGTH",.02),Object(r["a"])(Ct,"HIT_DESTROYED_LENGTH",.1),Object(r["a"])(Ct,"STATE_ALIVE",new wi(500,1,"alive")),Object(r["a"])(Ct,"STATE_DEAD",new wi(0,1,"dead")),Lt=Dt,Object(s["a"])(Lt,"HEIGHT_LIMIT",[T],(yt=Object.getOwnPropertyDescriptor(Lt,"HEIGHT_LIMIT"),yt=yt?yt.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return yt}}),Lt),Object(s["a"])(Lt,"HUNK_LENGTH",[T],(It=Object.getOwnPropertyDescriptor(Lt,"HUNK_LENGTH"),It=It?It.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return It}}),Lt),Object(s["a"])(Lt,"HIT_DESTROYED_LENGTH",[T],(Nt=Object.getOwnPropertyDescriptor(Lt,"HIT_DESTROYED_LENGTH"),Nt=Nt?Nt.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return Nt}}),Lt),Object(s["a"])(Lt,"STATE_ALIVE",[T],(Rt=Object.getOwnPropertyDescriptor(Lt,"STATE_ALIVE"),Rt=Rt?Rt.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return Rt}}),Lt),Object(s["a"])(Lt,"STATE_DEAD",[T],(Pt=Object.getOwnPropertyDescriptor(Lt,"STATE_DEAD"),Pt=Pt?Pt.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return Pt}}),Lt),Lt),qi=function(e){Object(_["a"])(i,e);var t=Object(S["a"])(i);function i(e){var n;return Object(a["a"])(this,i),n=t.call(this),Object(r["a"])(Object(h["a"])(n),"surface",void 0),Object(r["a"])(Object(h["a"])(n),"shooters",[]),Object(r["a"])(Object(h["a"])(n),"enemies",[]),Object(r["a"])(Object(h["a"])(n),"spikes",[]),Object(r["a"])(Object(h["a"])(n),"shootersMap",void 0),Object(r["a"])(Object(h["a"])(n),"enemiesMap",void 0),Object(r["a"])(Object(h["a"])(n),"spikesMap",void 0),Object(r["a"])(Object(h["a"])(n),"rendererHelperNewObjectsIds",[]),n.surface=e,n.shootersMap=new Array(n.surface.lanesAmount).fill(0).map((function(){return[]})),n.enemiesMap=new Array(n.surface.lanesAmount).fill(0).map((function(){return[]})),n.spikesMap=new Array(n.surface.lanesAmount).fill(0).map((function(){return[]})),n}return Object(n["a"])(i,[{key:"addShooter",value:function(e){this.shooters.push(e),this.rendererHelperNewObjectsIds.push(this.shooters[this.shooters.length-1].objectId)}},{key:"addEnemy",value:function(e){return this.enemies.push(e),this.rendererHelperNewObjectsIds.push(this.enemies[this.enemies.length-1].objectId),this.createSpikes(e),e}},{key:"addSpike",value:function(e){this.spikes.push(e),this.rendererHelperNewObjectsIds.push(this.spikes[this.spikes.length-1].objectId)}},{key:"createSpikes",value:function(e){e.type===zi.TYPE_SPIKER&&(0!==this.spikesMap[e.laneId].length&&this.spikesMap[e.laneId].length!==this.spikesMap[e.laneId].filter((function(e){return!e.alive})).length||this.addSpike(new Zi(e.surface,e.projectileManager,e.rewardCallback,e.laneId)))}},{key:"update",value:function(){var e=this;this.shooters.forEach((function(e){return e.update()})),this.enemies.forEach((function(e){return e.update()})),this.spikes.forEach((function(t){t.extendToLowestSpiker(e.enemiesMap[t.laneId].filter((function(e){return e.type===zi.TYPE_SPIKER}))),t.update()})),this.runGarbageCollector(),this.updateObjectsMap()}},{key:"runGarbageCollector",value:function(){if(this.shouldTriggerGarbageCollector()){var e=Xi.garbageCollector(this.enemies);e&&(this.forceMapsUpdate=!0),e&&console.log("Collected ".concat(e," enemies"));var t=Xi.garbageCollector(this.spikes);t&&(this.forceMapsUpdate=!0),t&&console.log("Collected ".concat(t," spikes"))}}},{key:"updateObjectsMap",value:function(){Xi.updateMap(this.shooters,this.shootersMap,this.forceMapsUpdate),Xi.updateMap(this.enemies,this.enemiesMap,this.forceMapsUpdate),Xi.updateMap(this.spikes,this.spikesMap,this.forceMapsUpdate),this.forceMapsUpdate=!1}},{key:"handleSuperzapper",value:function(){this.enemies.forEach((function(e){e.reward=!0,e.die()}))}},{key:"removeEnemies",value:function(){this.enemies.forEach((function(e){e.disappear()})),this.runGarbageCollector(),this.updateObjectsMap()}},{key:"removeSpikes",value:function(){this.spikes.forEach((function(e){e.disappear()})),this.runGarbageCollector(),this.updateObjectsMap()}},{key:"removeShooters",value:function(){this.shooters.forEach((function(e){e.disappear()})),this.runGarbageCollector(),this.updateObjectsMap()}},{key:"purgePlayField",value:function(){this.removeEnemies(),this.removeSpikes(),this.removeShooters()}},{key:"getAmountOfAliveEnemies",value:function(){return this.enemies.filter((function(e){return e.alive})).length}}]),i}(Xi),Qi=(xt=Mt=function(e){Object(_["a"])(i,e);var t=Object(S["a"])(i);function i(e){var n;return Object(a["a"])(this,i),n=t.call(this),Object(r["a"])(Object(h["a"])(n),"surfaceObjectsManager",void 0),Object(r["a"])(Object(h["a"])(n),"shooterProjectiles",[]),Object(r["a"])(Object(h["a"])(n),"enemyProjectiles",[]),Object(r["a"])(Object(h["a"])(n),"enemyProjectilesMap",void 0),Object(r["a"])(Object(h["a"])(n),"rendererHelperNewProjectilesIds",[]),n.surfaceObjectsManager=e,n.enemyProjectilesMap=new Array(n.surfaceObjectsManager.surface.lanesAmount).fill(0).map((function(){return[]})),n}return Object(n["a"])(i,[{key:"fire",value:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(t===Mi.SOURCE_SHOOTER){if(this.shooterProjectiles.length>=i.MAX_AMOUNT_OF_SHOOTER_PROJECTILES)return console.log("Too much shooter projectiles!"),!1;this.shooterProjectiles.push(new Mi(this.surfaceObjectsManager.surface,e,t,a)),this.rendererHelperNewProjectilesIds.push(this.shooterProjectiles[this.shooterProjectiles.length-1].objectId)}else{if(this.enemyProjectiles.length>=i.MAX_AMOUNT_OF_ENEMY_PROJECTILES)return console.log("Too much enemy projectiles!"),!1;this.enemyProjectiles.push(new Mi(this.surfaceObjectsManager.surface,e,t,a)),this.rendererHelperNewProjectilesIds.push(this.enemyProjectiles[this.enemyProjectiles.length-1].objectId)}return this.forceMapsUpdate=!0,!0}},{key:"update",value:function(){var e=this;this.shooterProjectiles.forEach((function(t){t.update(),t.detectCollision(e.surfaceObjectsManager.enemiesMap[t.laneId]),t.detectCollision(e.surfaceObjectsManager.spikesMap[t.laneId]),t.detectCollision(e.enemyProjectilesMap[t.laneId])})),this.enemyProjectiles.forEach((function(t){t.update(),t.detectCollision(e.surfaceObjectsManager.shootersMap[t.laneId])})),this.runGarbageCollector(),this.updateObjectsMap()}},{key:"runGarbageCollector",value:function(){if(this.shouldTriggerGarbageCollector()){Xi.garbageCollector(this.shooterProjectiles);var e=Xi.garbageCollector(this.enemyProjectiles);e&&(this.forceMapsUpdate=!0)}}},{key:"updateObjectsMap",value:function(){Xi.updateMap(this.enemyProjectiles,this.enemyProjectilesMap,this.forceMapsUpdate),this.forceMapsUpdate=!1}},{key:"removeProjectiles",value:function(){this.shooterProjectiles.forEach((function(e){e.disappear()})),this.enemyProjectiles.forEach((function(e){e.disappear()})),this.runGarbageCollector(),this.updateObjectsMap()}}]),i}(Xi),Object(r["a"])(Mt,"MAX_AMOUNT_OF_SHOOTER_PROJECTILES",6),Object(r["a"])(Mt,"MAX_AMOUNT_OF_ENEMY_PROJECTILES",32),Gt=xt,Object(s["a"])(Gt,"MAX_AMOUNT_OF_SHOOTER_PROJECTILES",[T],(wt=Object.getOwnPropertyDescriptor(Gt,"MAX_AMOUNT_OF_SHOOTER_PROJECTILES"),wt=wt?wt.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return wt}}),Gt),Object(s["a"])(Gt,"MAX_AMOUNT_OF_ENEMY_PROJECTILES",[T],(mt=Object.getOwnPropertyDescriptor(Gt,"MAX_AMOUNT_OF_ENEMY_PROJECTILES"),mt=mt?mt.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return mt}}),Gt),Gt),$i=function(){function e(){var t=this;Object(a["a"])(this,e),Object(r["a"])(this,"keyToFunctionMap",[]),document.onkeydown=function(e){var i=t.keyToFunctionMap.find((function(t){return t.key===e.code}));void 0!==i&&(i.keyDown=!0)},document.onkeyup=function(e){var i=t.keyToFunctionMap.find((function(t){return t.key===e.code}));void 0!==i&&(i.keyDown=!1)}}return Object(n["a"])(e,[{key:"dispatchActions",value:function(){this.keyToFunctionMap.filter((function(e){return e.keyDown})).forEach((function(e){return e.action()}))}},{key:"register",value:function(e,t){this.unregister(e),this.keyToFunctionMap.push({key:e,keyDown:!1,action:t})}},{key:"unregister",value:function(e){var t=this.keyToFunctionMap.findIndex((function(t){return t.key===e}));t>=0&&this.keyToFunctionMap.splice(t,1)}},{key:"purge",value:function(){this.keyToFunctionMap=[]}}]),e}(),ea=new $i,ta=ea,ia=(ai=ii=function(e){Object(_["a"])(i,e);var t=Object(S["a"])(i);function i(e,n,s){var o,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;return Object(a["a"])(this,i),o=t.call(this,e,n,s,c,l,mi.TYPE_PULSAR),Object(r["a"])(Object(h["a"])(o),"zBase",0),Object(r["a"])(Object(h["a"])(o),"zTarget",0),Object(r["a"])(Object(h["a"])(o),"rendererHelperLaneChangesAmount",0),o.firstLevel=17,o.valueInPoints=200,o.zTarget=l,o.setState(i.STATE_MOVING_ALONG_LINE),o}return Object(n["a"])(i,[{key:"updateState",value:function(){this.inState(i.STATE_MOVING_ALONG_LINE)?(this.setState(wi.drawNextState(i.STATE_MOVING_ALONG_LINE,i.STATE_ROTATING_BEGIN,this.isFlagSet(i.FLAG_NO_WARNING)?i.STATE_PULSATING:i.STATE_WARNING)),this.inState(i.STATE_PULSATING)&&this.surface.shortLane(this.laneId),this.unsetFlag(i.FLAG_MOVING_TARGET_CHOSEN)):this.inState(i.STATE_WARNING)?(this.setState(i.STATE_PULSATING),this.surface.shortLane(this.laneId)):this.inState(i.STATE_PULSATING)?(this.setState(wi.drawNextState(i.STATE_MOVING_ALONG_LINE,i.STATE_ROTATING_BEGIN,this.isFlagSet(i.FLAG_NO_WARNING)?i.STATE_PULSATING:i.STATE_WARNING)),this.inState(i.STATE_PULSATING)||this.surface.unshortLane(this.laneId)):this.inState(i.STATE_ROTATING_BEGIN)?(this.setState(i.STATE_ROTATING_END),this.isFlagSet(i.FLAG_IMMUNE_ROTATION)&&(this.unsetFlag(i.FLAG_IMMUNE_ROTATION),this.hittable=!0)):this.inState(i.STATE_ROTATING_END)?(this.setState(i.STATE_MOVING_ALONG_LINE),this.unsetFlag(i.FLAG_LANE_CHANGED),this.unsetFlag(i.FLAG_ROTATION_CW),this.unsetFlag(i.FLAG_ROTATION_CCW),this.unsetFlag(i.FLAG_ROTATION_DIR_CHOSEN),this.rendererHelperLaneChangesAmount++):(this.inState(i.STATE_EXPLODING)||this.inState(i.STATE_DISAPPEARING))&&this.setState(i.STATE_DEAD)}},{key:"updateEntity",value:function(){if(this.inState(i.STATE_DEAD)&&(this.alive=!1),this.inState(i.STATE_ROTATING_BEGIN)&&this.isFlagNotSet(i.FLAG_ROTATION_DIR_CHOSEN))if(this.setFlag(i.FLAG_ROTATION_DIR_CHOSEN),this.isFlagSet(i.FLAG_REACHED_TOP)){var e=this.surface.getShortestPathDirection(this.laneId,this.surface.activeLaneId);1===e?(this.setFlag(i.FLAG_ROTATION_CCW),this.unsetFlag(i.FLAG_ROTATION_CW)):-1===e&&(this.setFlag(i.FLAG_ROTATION_CW),this.unsetFlag(i.FLAG_ROTATION_CCW))}else if(this.isFlagNotSet(i.FLAG_ROTATION_CW)&&this.isFlagNotSet(i.FLAG_ROTATION_CCW)){var t=this.surface.getActualLaneIdFromProjectedMovement(this.laneId+1)!==this.laneId,a=this.surface.getActualLaneIdFromProjectedMovement(this.laneId-1)!==this.laneId;t&&a?this.setFlag(Math.random()>.5?i.FLAG_ROTATION_CW:i.FLAG_ROTATION_CCW):a?this.setFlag(i.FLAG_ROTATION_CW):this.setFlag(i.FLAG_ROTATION_CCW)}if(this.inState(i.STATE_ROTATING_END)&&this.isFlagNotSet(i.FLAG_LANE_CHANGED)&&(this.setFlag(i.FLAG_LANE_CHANGED),this.isFlagSet(i.FLAG_ROTATION_CW)||this.isFlagSet(i.FLAG_ROTATION_CCW))){var n=this.isFlagSet(i.FLAG_ROTATION_CCW)?1:-1;this.setLane(this.laneId+n)}this.inState(i.STATE_MOVING_ALONG_LINE)&&this.isFlagNotSet(i.FLAG_MOVING_TARGET_CHOSEN)&&(this.setFlag(i.FLAG_MOVING_TARGET_CHOSEN),this.zBase=this.zPosition,this.zTarget=Yi(10*i.MIN_Z_POSITION,10*i.MAX_Z_POSITION)/10),this.inState(i.STATE_MOVING_ALONG_LINE)?this.zPosition=this.zBase+(this.zTarget-this.zBase)*this.stateProgressInTime():this.inState(i.STATE_EXPLODING)||(this.zPosition=this.zTarget)}},{key:"immuneDuringNextRotation",value:function(){this.setFlag(i.FLAG_IMMUNE_ROTATION),this.hittable=!1}},{key:"disappear",value:function(){this.inState(i.STATE_EXPLODING)||this.inState(i.STATE_DEAD)||(this.inState(i.STATE_PULSATING)&&this.surface.unshortLane(this.laneId),this.setState(i.STATE_DISAPPEARING),Object(E["a"])(Object(b["a"])(i.prototype),"die",this).call(this))}},{key:"die",value:function(){this.inState(i.STATE_DEAD)||(this.inState(i.STATE_PULSATING)&&this.surface.unshortLane(this.laneId),this.setState(i.STATE_EXPLODING),Object(E["a"])(Object(b["a"])(i.prototype),"die",this).call(this))}}]),i}(zi),Object(r["a"])(ii,"MIN_Z_POSITION",.1),Object(r["a"])(ii,"MAX_Z_POSITION",.9),Object(r["a"])(ii,"STATE_MOVING_ALONG_LINE",new wi(1500,.8,"moving_along_line")),Object(r["a"])(ii,"STATE_ROTATING_BEGIN",new wi(200,1,"rotate_begin")),Object(r["a"])(ii,"STATE_ROTATING_END",new wi(200,1,"rotate_end")),Object(r["a"])(ii,"STATE_WARNING",new wi(1e3,1,"warning")),Object(r["a"])(ii,"STATE_PULSATING",new wi(2e3,1,"pulsating")),Object(r["a"])(ii,"STATE_DISAPPEARING",new wi(1e3,1,"disappearing")),Object(r["a"])(ii,"STATE_EXPLODING",new wi(1e3,1,"exploding")),Object(r["a"])(ii,"STATE_DEAD",new wi(0,1,"dead")),Object(r["a"])(ii,"FLAG_LANE_CHANGED",1),Object(r["a"])(ii,"FLAG_ROTATION_CW",2),Object(r["a"])(ii,"FLAG_ROTATION_CCW",4),Object(r["a"])(ii,"FLAG_ROTATION_DIR_CHOSEN",8),Object(r["a"])(ii,"FLAG_IMMUNE_ROTATION",16),Object(r["a"])(ii,"FLAG_MOVING_TARGET_CHOSEN",32),Object(r["a"])(ii,"FLAG_NO_WARNING",64),Ft=ai,Object(s["a"])(Ft,"MIN_Z_POSITION",[T],(Ht=Object.getOwnPropertyDescriptor(Ft,"MIN_Z_POSITION"),Ht=Ht?Ht.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return Ht}}),Ft),Object(s["a"])(Ft,"MAX_Z_POSITION",[T],(kt=Object.getOwnPropertyDescriptor(Ft,"MAX_Z_POSITION"),kt=kt?kt.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return kt}}),Ft),Object(s["a"])(Ft,"STATE_MOVING_ALONG_LINE",[T],(Ut=Object.getOwnPropertyDescriptor(Ft,"STATE_MOVING_ALONG_LINE"),Ut=Ut?Ut.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return Ut}}),Ft),Object(s["a"])(Ft,"STATE_ROTATING_BEGIN",[T],(zt=Object.getOwnPropertyDescriptor(Ft,"STATE_ROTATING_BEGIN"),zt=zt?zt.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return zt}}),Ft),Object(s["a"])(Ft,"STATE_ROTATING_END",[T],(Bt=Object.getOwnPropertyDescriptor(Ft,"STATE_ROTATING_END"),Bt=Bt?Bt.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return Bt}}),Ft),Object(s["a"])(Ft,"STATE_WARNING",[T],(Yt=Object.getOwnPropertyDescriptor(Ft,"STATE_WARNING"),Yt=Yt?Yt.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return Yt}}),Ft),Object(s["a"])(Ft,"STATE_PULSATING",[T],(Wt=Object.getOwnPropertyDescriptor(Ft,"STATE_PULSATING"),Wt=Wt?Wt.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return Wt}}),Ft),Object(s["a"])(Ft,"STATE_DISAPPEARING",[T],(Kt=Object.getOwnPropertyDescriptor(Ft,"STATE_DISAPPEARING"),Kt=Kt?Kt.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return Kt}}),Ft),Object(s["a"])(Ft,"STATE_EXPLODING",[T],(Vt=Object.getOwnPropertyDescriptor(Ft,"STATE_EXPLODING"),Vt=Vt?Vt.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return Vt}}),Ft),Object(s["a"])(Ft,"STATE_DEAD",[T],(Xt=Object.getOwnPropertyDescriptor(Ft,"STATE_DEAD"),Xt=Xt?Xt.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return Xt}}),Ft),Object(s["a"])(Ft,"FLAG_LANE_CHANGED",[T],(Jt=Object.getOwnPropertyDescriptor(Ft,"FLAG_LANE_CHANGED"),Jt=Jt?Jt.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return Jt}}),Ft),Object(s["a"])(Ft,"FLAG_ROTATION_CW",[T],(Zt=Object.getOwnPropertyDescriptor(Ft,"FLAG_ROTATION_CW"),Zt=Zt?Zt.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return Zt}}),Ft),Object(s["a"])(Ft,"FLAG_ROTATION_CCW",[T],(qt=Object.getOwnPropertyDescriptor(Ft,"FLAG_ROTATION_CCW"),qt=qt?qt.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return qt}}),Ft),Object(s["a"])(Ft,"FLAG_ROTATION_DIR_CHOSEN",[T],(Qt=Object.getOwnPropertyDescriptor(Ft,"FLAG_ROTATION_DIR_CHOSEN"),Qt=Qt?Qt.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return Qt}}),Ft),Object(s["a"])(Ft,"FLAG_IMMUNE_ROTATION",[T],($t=Object.getOwnPropertyDescriptor(Ft,"FLAG_IMMUNE_ROTATION"),$t=$t?$t.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return $t}}),Ft),Object(s["a"])(Ft,"FLAG_MOVING_TARGET_CHOSEN",[T],(ei=Object.getOwnPropertyDescriptor(Ft,"FLAG_MOVING_TARGET_CHOSEN"),ei=ei?ei.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return ei}}),Ft),Object(s["a"])(Ft,"FLAG_NO_WARNING",[T],(ti=Object.getOwnPropertyDescriptor(Ft,"FLAG_NO_WARNING"),ti=ti?ti.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return ti}}),Ft),Ft),aa=(hi=Oi=function(e){Object(_["a"])(i,e);var t=Object(S["a"])(i);function i(e,n,s,o,c){var l,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,O=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;return Object(a["a"])(this,i),l=t.call(this,e,n,o,u,O,c),Object(r["a"])(Object(h["a"])(l),"enemySpawnFunction",void 0),l.enemySpawnFunction=s,l.firstLevel=3,l.valueInPoints=100,l.zSpeed=.001*-Yi(3,6),l.setState(i.STATE_IDLE),l}return Object(n["a"])(i,[{key:"updateState",value:function(){this.inState(i.STATE_IDLE)?this.setState(wi.drawNextState(i.STATE_IDLE,i.STATE_SHOOTING)):this.inState(i.STATE_SHOOTING)?(this.setState(i.STATE_IDLE),this.unsetFlag(i.FLAG_SHOOTS_FIRED)):(this.inState(i.STATE_EXPLODING)||this.inState(i.STATE_DISAPPEARING))&&this.setState(i.STATE_DEAD)}},{key:"updateEntity",value:function(){this.inState(i.STATE_DEAD)&&(this.alive=!1),this.zPosition<=0&&(this.alive=!1,this.createEnemies()),this.inState(i.STATE_SHOOTING)&&this.isFlagNotSet(i.FLAG_SHOOTS_FIRED)&&(this.setFlag(i.FLAG_SHOOTS_FIRED),this.fire()),this.inState(i.STATE_EXPLODING)||this.inState(i.STATE_DISAPPEARING)||(this.zPosition+=this.zSpeed)}},{key:"hitByProjectile",value:function(){this.reward=!0,this.die(),this.createEnemies()}},{key:"disappear",value:function(){this.inState(i.STATE_EXPLODING)||this.inState(i.STATE_DEAD)||(this.setState(i.STATE_DISAPPEARING),Object(E["a"])(Object(b["a"])(i.prototype),"die",this).call(this))}},{key:"die",value:function(){this.inState(i.STATE_DEAD)||(this.setState(i.STATE_EXPLODING),Object(E["a"])(Object(b["a"])(i.prototype),"die",this).call(this))}},{key:"createEnemies",value:function(){throw new Error("Method 'createEnemies()' must be implemented.")}}]),i}(zi),Object(r["a"])(Oi,"STATE_IDLE",new wi(100,1,"idle")),Object(r["a"])(Oi,"STATE_SHOOTING",new wi(100,.1,"shooting")),Object(r["a"])(Oi,"STATE_DISAPPEARING",new wi(1e3,1,"disappearing")),Object(r["a"])(Oi,"STATE_EXPLODING",new wi(1e3,1,"exploding")),Object(r["a"])(Oi,"STATE_DEAD",new wi(0,1,"dead")),Object(r["a"])(Oi,"FLAG_SHOOTS_FIRED",1),ni=hi,Object(s["a"])(ni,"STATE_IDLE",[T],(ri=Object.getOwnPropertyDescriptor(ni,"STATE_IDLE"),ri=ri?ri.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return ri}}),ni),Object(s["a"])(ni,"STATE_SHOOTING",[T],(si=Object.getOwnPropertyDescriptor(ni,"STATE_SHOOTING"),si=si?si.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return si}}),ni),Object(s["a"])(ni,"STATE_DISAPPEARING",[T],(oi=Object.getOwnPropertyDescriptor(ni,"STATE_DISAPPEARING"),oi=oi?oi.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return oi}}),ni),Object(s["a"])(ni,"STATE_EXPLODING",[T],(ci=Object.getOwnPropertyDescriptor(ni,"STATE_EXPLODING"),ci=ci?ci.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return ci}}),ni),Object(s["a"])(ni,"STATE_DEAD",[T],(li=Object.getOwnPropertyDescriptor(ni,"STATE_DEAD"),li=li?li.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return li}}),ni),Object(s["a"])(ni,"FLAG_SHOOTS_FIRED",[T],(ui=Object.getOwnPropertyDescriptor(ni,"FLAG_SHOOTS_FIRED"),ui=ui?ui.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return ui}}),ni),ni),na=function(e){Object(_["a"])(i,e);var t=Object(S["a"])(i);function i(e,n,r,s){var o,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;return Object(a["a"])(this,i),o=t.call(this,e,n,r,s,zi.TYPE_FLIPPER_TANKER,c,l),o.firstLevel=3,o}return Object(n["a"])(i,[{key:"createEnemies",value:function(){var e=this.surface.getActualLaneIdFromProjectedMovement(this.laneId+1),t=e!==this.laneId,i=this.surface.getActualLaneIdFromProjectedMovement(this.laneId-1),a=i!==this.laneId,n=this.enemySpawnFunction(this.laneId,this.zPosition),r=this.enemySpawnFunction(this.laneId,this.zPosition);t&&(n.setState(Wi.STATE_ROTATING_BEGIN),n.setFlag(Wi.FLAG_ROTATION_DIR_CHOSEN),n.setFlag(Wi.FLAG_ROTATION_CCW),n.immuneDuringNextRotation()),a&&(r.setState(Wi.STATE_ROTATING_BEGIN),r.setFlag(Wi.FLAG_ROTATION_DIR_CHOSEN),r.setFlag(Wi.FLAG_ROTATION_CW),r.immuneDuringNextRotation())}}]),i}(aa),ra=function(e){Object(_["a"])(i,e);var t=Object(S["a"])(i);function i(e,n,r,s){var o,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;return Object(a["a"])(this,i),o=t.call(this,e,n,r,s,zi.TYPE_FUSEBALL_TANKER,c,l),o.firstLevel=33,o}return Object(n["a"])(i,[{key:"createEnemies",value:function(){var e=this.surface.getActualLaneIdFromProjectedMovement(this.laneId+1),t=this.enemySpawnFunction(e,this.zPosition),i=this.enemySpawnFunction(this.laneId,this.zPosition);t.setState(Ki.STATE_MOVING_ALONG_LINE),t.immuneDuringNextLaneSwitch(),i.setState(Ki.STATE_MOVING_ALONG_LINE),i.immuneDuringNextLaneSwitch()}}]),i}(aa),sa=function(e){Object(_["a"])(i,e);var t=Object(S["a"])(i);function i(e,n,r,s){var o,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;return Object(a["a"])(this,i),o=t.call(this,e,n,r,s,zi.TYPE_PULSAR_TANKER,c,l),o.firstLevel=41,o}return Object(n["a"])(i,[{key:"createEnemies",value:function(){var e=this.surface.getActualLaneIdFromProjectedMovement(this.laneId+1),t=e!==this.laneId,i=this.surface.getActualLaneIdFromProjectedMovement(this.laneId-1),a=i!==this.laneId,n=this.enemySpawnFunction(this.laneId,this.zPosition),r=this.enemySpawnFunction(this.laneId,this.zPosition);t&&(n.setState(ia.STATE_ROTATING_BEGIN),n.setFlag(ia.FLAG_ROTATION_DIR_CHOSEN),n.setFlag(ia.FLAG_ROTATION_CCW),n.immuneDuringNextRotation()),a&&(r.setState(ia.STATE_ROTATING_BEGIN),r.setFlag(ia.FLAG_ROTATION_DIR_CHOSEN),r.setFlag(ia.FLAG_ROTATION_CW),r.immuneDuringNextRotation())}}]),i}(aa),oa=(di=Ai=function(){function e(t,i,n,s,o,c){Object(a["a"])(this,e),Object(r["a"])(this,"surfaceObjectsManager",void 0),Object(r["a"])(this,"projectileManager",void 0),Object(r["a"])(this,"rewardCallback",void 0),Object(r["a"])(this,"currentLevel",void 0),Object(r["a"])(this,"currentScore",void 0),Object(r["a"])(this,"targetScore",void 0),this.surfaceObjectsManager=t,this.projectileManager=i,this.rewardCallback=n,this.currentLevel=s,this.currentScore=o,this.targetScore=c}return Object(n["a"])(e,[{key:"reachedScoreTarget",value:function(){return this.currentScore>=this.targetScore}},{key:"updateScore",value:function(e){this.currentScore=e}},{key:"spawn",value:function(){var t=this;if(!(this.currentScore>=this.targetScore)){var i=this.surfaceObjectsManager.getAmountOfAliveEnemies(),a=Math.ceil(this.currentLevel/e.MAX_LEVEL*(e.MAX_ENEMIES-e.MIN_ENEMIES)+e.MIN_ENEMIES-1),n=1-i/a;if(!(0===n||Math.random()>n)){var r,s=e.SPAWN_MAP.filter((function(e){return e.level<=t.currentLevel})),o=this.drawEnemy(s),c=Yi(0,15);switch(o.type){case zi.TYPE_FLIPPER:r=this.spawnFlipper(c);break;case zi.TYPE_FLIPPER_TANKER:r=this.spawnFlipperTanker(c);break;case zi.TYPE_SPIKER:r=this.spawnSpiker(c);break;case zi.TYPE_FUSEBALL:r=this.spawnFuseball(c);break;case zi.TYPE_PULSAR:r=this.spawnPulsar(c);break;case zi.TYPE_FUSEBALL_TANKER:r=this.spawnFuseballTanker(c);break;case zi.TYPE_PULSAR_TANKER:r=this.spawnPulsarTanker(c);break;default:throw new Error("Trying to spawn unknown enemy: ".concat(o.type))}this.currentScore+=r.valueInPoints}}}},{key:"drawEnemy",value:function(e){for(var t=e.reduce((function(e,t){return e+t.chanceOfSpawning}),0),i=Math.random()*t,a=0;a<e.length;a++){if(e[a].chanceOfSpawning>=i)return e[a];i-=e[a].chanceOfSpawning}throw new Error("Something weird happened.")}},{key:"spawnFlipper",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=this.surfaceObjectsManager.addEnemy(new Wi(this.surfaceObjectsManager.surface,this.projectileManager,this.rewardCallback,e,t));return 1===this.currentLevel&&i.cannotFlip(),i}},{key:"spawnSpiker",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return this.surfaceObjectsManager.addEnemy(new Ji(this.surfaceObjectsManager.surface,this.projectileManager,this.rewardCallback,e,t))}},{key:"spawnFuseball",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return this.surfaceObjectsManager.addEnemy(new Ki(this.surfaceObjectsManager.surface,this.projectileManager,this.rewardCallback,e,t))}},{key:"spawnPulsar",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return this.surfaceObjectsManager.addEnemy(new ia(this.surfaceObjectsManager.surface,this.projectileManager,this.rewardCallback,e,t))}},{key:"spawnFlipperTanker",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return this.surfaceObjectsManager.addEnemy(new na(this.surfaceObjectsManager.surface,this.projectileManager,this.spawnFlipper.bind(this),this.rewardCallback,e,t))}},{key:"spawnFuseballTanker",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return this.surfaceObjectsManager.addEnemy(new ra(this.surfaceObjectsManager.surface,this.projectileManager,this.spawnFuseball.bind(this),this.rewardCallback,e,t))}},{key:"spawnPulsarTanker",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return this.surfaceObjectsManager.addEnemy(new sa(this.surfaceObjectsManager.surface,this.projectileManager,this.spawnPulsar.bind(this),this.rewardCallback,e,t))}}]),e}(),Object(r["a"])(Ai,"SPAWN_MAP",[{type:zi.TYPE_FLIPPER,level:1,chanceOfSpawning:1},{type:zi.TYPE_FLIPPER_TANKER,level:3,chanceOfSpawning:.5},{type:zi.TYPE_SPIKER,level:4,chanceOfSpawning:1},{type:zi.TYPE_FUSEBALL,level:11,chanceOfSpawning:.8},{type:zi.TYPE_PULSAR,level:17,chanceOfSpawning:.8},{type:zi.TYPE_FUSEBALL_TANKER,level:33,chanceOfSpawning:.5},{type:zi.TYPE_PULSAR_TANKER,level:41,chanceOfSpawning:.5}]),Object(r["a"])(Ai,"MIN_ENEMIES",4),Object(r["a"])(Ai,"MAX_ENEMIES",16),Object(r["a"])(Ai,"MAX_LEVEL",99),Ei=di,Object(s["a"])(Ei,"SPAWN_MAP",[T],(bi=Object.getOwnPropertyDescriptor(Ei,"SPAWN_MAP"),bi=bi?bi.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return bi}}),Ei),Object(s["a"])(Ei,"MIN_ENEMIES",[T],(_i=Object.getOwnPropertyDescriptor(Ei,"MIN_ENEMIES"),_i=_i?_i.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return _i}}),Ei),Object(s["a"])(Ei,"MAX_ENEMIES",[T],(Si=Object.getOwnPropertyDescriptor(Ei,"MAX_ENEMIES"),Si=Si?Si.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return Si}}),Ei),Object(s["a"])(Ei,"MAX_LEVEL",[T],(Ti=Object.getOwnPropertyDescriptor(Ei,"MAX_LEVEL"),Ti=Ti?Ti.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return Ti}}),Ei),Ei),ca=function(){function e(t,i,n,s,o,c,l,u){Object(a["a"])(this,e),Object(r["a"])(this,"surface",void 0),Object(r["a"])(this,"shooter",void 0),Object(r["a"])(this,"surfaceObjectsManager",void 0),Object(r["a"])(this,"projectileManager",void 0),Object(r["a"])(this,"enemySpawner",void 0),Object(r["a"])(this,"currentLevel",void 0),Object(r["a"])(this,"levelInitScore",void 0),Object(r["a"])(this,"targetScore",void 0),Object(r["a"])(this,"rewardCallback",void 0),Object(r["a"])(this,"levelWonCallback",void 0),Object(r["a"])(this,"shooterKilledCallback",void 0),Object(r["a"])(this,"getCurrentScore",void 0),this.surface=t,this.currentLevel=i,this.levelInitScore=n,this.targetScore=s,this.rewardCallback=o,this.levelWonCallback=c,this.shooterKilledCallback=l,this.getCurrentScore=u,this.surfaceObjectsManager=new qi(t),this.projectileManager=new Qi(this.surfaceObjectsManager),this.enemySpawner=new oa(this.surfaceObjectsManager,this.projectileManager,this.rewardCallback,this.currentLevel,this.levelInitScore,this.targetScore),this.shooter=new Vi(t,this.projectileManager,this.surfaceObjectsManager,this.shooterKilled.bind(this),7),this.surfaceObjectsManager.addShooter(this.shooter)}return Object(n["a"])(e,[{key:"release",value:function(){this.surfaceObjectsManager.removeEnemies(),this.surfaceObjectsManager.removeShooters(),this.surfaceObjectsManager.removeSpikes(),this.surfaceObjectsManager=void 0,this.projectileManager.removeProjectiles(),this.projectileManager=void 0,this.surface=void 0,this.shooter=void 0,this.unregisterKeys()}},{key:"registerKeys",value:function(){var e=this;ta.register("KeyA",(function(){e.shooter.moveLeft()})),ta.register("KeyD",(function(){e.shooter.moveRight()})),ta.register("Space",(function(){e.shooter.fire()})),ta.register("KeyE",(function(){e.shooter.fireSuperzapper()})),ta.register("End",(function(){e.shooter.setState(Vi.STATE_GOING_DOWN_THE_TUBE)}))}},{key:"unregisterKeys",value:function(){ta.unregister("KeyA"),ta.unregister("KeyD"),ta.unregister("Space"),ta.unregister("KeyE"),ta.unregister("End")}},{key:"update",value:function(){this.projectileManager.update(),this.surfaceObjectsManager.update(),this.enemySpawner.updateScore(this.getCurrentScore()),this.shooter.inState(Vi.STATE_ALIVE)&&this.enemySpawner.spawn(),this.enemySpawner.reachedScoreTarget()&&this.surfaceObjectsManager.getAmountOfAliveEnemies()<=3&&!this.shooter.inState(Vi.STATE_GOING_DOWN_THE_TUBE)&&!this.shooter.inState(Vi.STATE_REACHED_TUBE_BOTTOM)&&(this.shooter.setState(Vi.STATE_GOING_DOWN_THE_TUBE),Ui.publish(Fi.TOPIC_AUDIO,Fi.MESSAGE_NEXT_LEVEL)),this.shooter.inState(Vi.STATE_REACHED_TUBE_BOTTOM)&&this.levelWonCallback()}},{key:"shooterKilled",value:function(){this.surfaceObjectsManager.removeEnemies(),this.shooterKilledCallback()&&this.shooter.renovate()}}]),e}(),la=(i("4c53"),i("2909")),ua=function(){function e(t,i,n,s){Object(a["a"])(this,e),Object(r["a"])(this,"top",void 0),Object(r["a"])(this,"right",void 0),Object(r["a"])(this,"bottom",void 0),Object(r["a"])(this,"left",void 0),Object(r["a"])(this,"center",void 0),this.top=t,this.right=i,this.bottom=n,this.left=s,this.findCenter()}return Object(n["a"])(e,[{key:"findCenter",value:function(){this.center=new o["I"]((this.left+this.right)/2,(this.top+this.bottom)/2)}},{key:"getCenter",value:function(){return this.center}}],[{key:"create",value:function(t){var i,a,n,r,s=Object(la["a"])(t),o=s.shift();return i=n=o.y,r=a=o.x,s.forEach((function(e){e.x<r&&(r=e.x),e.x>a&&(a=e.x),e.y>i&&(i=e.y),e.y<n&&(n=e.y)})),new e(i,a,n,r)}}]),e}(),Oa=(ji=vi=function(){function e(t,i,n,s){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;Object(a["a"])(this,e),Object(r["a"])(this,"id",void 0),Object(r["a"])(this,"name",void 0),Object(r["a"])(this,"isOpen",void 0),Object(r["a"])(this,"lanesAmount",void 0),Object(r["a"])(this,"activeLaneId",void 0),Object(r["a"])(this,"depth",void 0),Object(r["a"])(this,"rawLanesCoords",void 0),Object(r["a"])(this,"lanesCoords",void 0),Object(r["a"])(this,"lanesMiddleCoords",void 0),Object(r["a"])(this,"lanesCenterDirectionRadians",void 0),Object(r["a"])(this,"shortedLanes",void 0),this.id=t,this.name=i,this.isOpen=n,this.rawLanesCoords=s,this.zOffset=o,this.lanesAmount=s.length-(n?1:0),this.activeLaneId=0,this.depth=20,this.shortedLanes=new Array(this.lanesAmount).fill(0),this.calculateCenteredLanesCoords(),this.calculateLanesCenterCoords(),this.calculateLanesCenterDirection()}return Object(n["a"])(e,[{key:"calculateCenteredLanesCoords",value:function(){var e=ua.create(this.rawLanesCoords);this.lanesCoords=this.rawLanesCoords.map((function(t){return t.sub(e.getCenter())}))}},{key:"calculateLanesCenterCoords",value:function(){this.lanesMiddleCoords=[];for(var t=0;t<this.lanesAmount;t++){var i=ua.create([this.lanesCoords[t],this.lanesCoords[(t+1)%e.LINES_AMOUNT]]);this.lanesMiddleCoords.push(i.center)}}},{key:"calculateLanesCenterDirection",value:function(){var e=this;this.lanesCenterDirectionRadians=[],this.lanesMiddleCoords.forEach((function(t,i){var a=e.lanesCoords[i].clone(),n=t.clone();a.sub(n).normalize(),e.lanesCenterDirectionRadians.push(a.angle())}))}},{key:"getActualLaneIdFromProjectedMovement",value:function(e){return this.isOpen?e<0?0:e>=this.lanesAmount?this.lanesAmount-1:e:(e%=this.lanesAmount,e<0&&(e+=this.lanesAmount),e)}},{key:"getShortestPathDirection",value:function(e,t){if(e===t)return 0;if(this.isOpen)return t-e>0?1:-1;var i,a,n=t-e>0;n?(i=Math.abs(t-e),a=Math.abs(t-e-this.lanesAmount)):(i=Math.abs(t-e+this.lanesAmount),a=Math.abs(t-e));var r=i<=a;return r?1:-1}},{key:"setActiveLane",value:function(e){this.activeLaneId=this.getActualLaneIdFromProjectedMovement(e)}},{key:"shortLane",value:function(e){this.shortedLanes[e]++}},{key:"unshortLane",value:function(e){this.shortedLanes[e]--}},{key:"isLaneShorted",value:function(e){return this.shortedLanes[e]>0}}],[{key:"fromDataset",value:function(t){return t.map((function(t){return new e(t.id,t.name,t.isOpen,t.coords.map((function(e){return new o["I"](e.x,e.y)})),t.zOffset)}))}}]),e}(),Object(r["a"])(vi,"LINES_AMOUNT",16),fi=ji,Object(s["a"])(fi,"LINES_AMOUNT",[T],(pi=Object.getOwnPropertyDescriptor(fi,"LINES_AMOUNT"),pi=pi?pi.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return pi}}),fi),fi),ha=function(){function e(){Object(a["a"])(this,e)}return Object(n["a"])(e,null,[{key:"toDegrees",value:function(e){return e/Math.PI*180}},{key:"toRadians",value:function(e){return e*Math.PI/180}}]),e}(),Ea=(Pi=Ri=function(e){Object(_["a"])(i,e);var t=Object(S["a"])(i);function i(e,n){var s;return Object(a["a"])(this,i),s=t.call(this),Object(r["a"])(Object(h["a"])(s),"type","Group"),Object(r["a"])(Object(h["a"])(s),"surface",void 0),Object(r["a"])(Object(h["a"])(s),"level",void 0),Object(r["a"])(Object(h["a"])(s),"connectorFrontDepth",0),Object(r["a"])(Object(h["a"])(s),"connectorBackDepth",0),Object(r["a"])(Object(h["a"])(s),"lanesLines",[]),Object(r["a"])(Object(h["a"])(s),"lanesConnectors",[]),Object(r["a"])(Object(h["a"])(s),"laneActiveMaterial",void 0),Object(r["a"])(Object(h["a"])(s),"laneDefaultMaterial",void 0),Object(r["a"])(Object(h["a"])(s),"laneShortedMaterial",void 0),s.castShadow=!1,s.level=n,s.setSurface(e),s}return Object(n["a"])(i,[{key:"setSurface",value:function(e){this.surface=e,this.createLanes(),this.update()}},{key:"update",value:function(){for(var e=this.surface.activeLaneId,t=0;t<this.surface.lanesAmount;t++)this.setLinesAppearance(t,this.laneDefaultMaterial),this.setConnectorsAppearance(t,this.laneDefaultMaterial);this.setConnectorsAppearance(e,this.laneActiveMaterial),this.setLinesAppearance(e,this.laneActiveMaterial),this.setLinesAppearance(e+1,this.laneActiveMaterial);for(var i=this.surface.shortedLanes.map((function(e,t){return e>0?t:-1})).filter((function(e){return-1!==e})),a=0;a<i.length;a++){var n=i[a],r=a-1>=0?i[a-1]:i[i.length-1];this.setConnectorsAppearance(n,this.laneShortedMaterial,!1);var s=r+1===n;this.setLinesAppearance(i[a],this.laneShortedMaterial,!s),this.setLinesAppearance(i[a]+1,this.laneShortedMaterial,!0)}}},{key:"createLanes",value:function(){var e=this;this.clear(),this.connectorBackDepth=this.surface.depth,this.lanes=[],this.lanesLines=[],this.lanesConnectors=[];var t=Math.floor(this.level/16)%3;this.laneDefaultMaterial=new o["o"]({color:i.DEFAULT_LANE_COLOR[t]}),this.laneActiveMaterial=new o["o"]({color:i.ACTIVE_LANE_COLOR}),this.laneShortedMaterial=new o["o"]({color:i.SHORTED_LANE_COLOR});for(var a=0;a<this.getAmountOfLanes();a++){var n=this.surface.lanesCoords[a],r=[new o["J"](n.x,n.y,0),new o["J"](n.x,n.y,this.surface.depth)];this.lanesLines.push(new o["n"]((new o["f"]).setFromPoints(r),this.laneDefaultMaterial))}for(var s=0;s<this.getAmountOfLanes(!1);s++){var c=this.surface.lanesCoords[s],l=this.surface.lanesCoords[(s+1)%Oa.LINES_AMOUNT],u=[new o["J"](c.x,c.y,this.connectorFrontDepth),new o["J"](l.x,l.y,this.connectorFrontDepth)],O=[new o["J"](c.x,c.y,this.connectorBackDepth),new o["J"](l.x,l.y,this.connectorBackDepth)];this.lanesConnectors.push(new o["n"]((new o["f"]).setFromPoints(u),this.laneDefaultMaterial),new o["n"]((new o["f"]).setFromPoints(O),this.laneDefaultMaterial))}this.lanesLines.forEach((function(t){return e.add(t)})),this.lanesConnectors.forEach((function(t){return e.add(t)}))}},{key:"createCenterIndicators",value:function(){var e=this,t=new o["u"]({color:65280});this.surface.lanesMiddleCoords.forEach((function(i,a){var n=e.surface.lanesCoords[a].clone(),r=i.clone();n.rotateAround(r,ha.toRadians(-90));var s=(new o["f"]).setFromPoints([new o["J"](r.x,r.y,0),new o["J"](n.x,n.y,0)]);e.add(new o["n"](s,t))}))}},{key:"setConnectorsAppearance",value:function(e,t){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];e%=this.surface.lanesAmount,this.lanesConnectors[2*e].material=t,this.lanesConnectors[2*e+1].material=t,this.lanesConnectors[2*e].visible=i,this.lanesConnectors[2*e+1].visible=i}},{key:"setLinesAppearance",value:function(e,t){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];e%=this.surface.lanesAmount,this.lanesLines[e].material=t,this.lanesLines[e].visible=i}},{key:"getAmountOfLanes",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.surface.lanesAmount+(e&&this.surface.isOpen?1:0)}}]),i}(o["m"]),Object(r["a"])(Ri,"WIREFRAME_LINE_WIDTH",2),Object(r["a"])(Ri,"ACTIVE_LANE_COLOR",16776960),Object(r["a"])(Ri,"DEFAULT_LANE_COLOR",[255,16711680,65280]),Object(r["a"])(Ri,"SHORTED_LANE_COLOR",16777215),gi=Pi,Object(s["a"])(gi,"WIREFRAME_LINE_WIDTH",[T],(Li=Object.getOwnPropertyDescriptor(gi,"WIREFRAME_LINE_WIDTH"),Li=Li?Li.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return Li}}),gi),Object(s["a"])(gi,"ACTIVE_LANE_COLOR",[T],(yi=Object.getOwnPropertyDescriptor(gi,"ACTIVE_LANE_COLOR"),yi=yi?yi.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return yi}}),gi),Object(s["a"])(gi,"DEFAULT_LANE_COLOR",[T],(Ii=Object.getOwnPropertyDescriptor(gi,"DEFAULT_LANE_COLOR"),Ii=Ii?Ii.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return Ii}}),gi),Object(s["a"])(gi,"SHORTED_LANE_COLOR",[T],(Ni=Object.getOwnPropertyDescriptor(gi,"SHORTED_LANE_COLOR"),Ni=Ni?Ni.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return Ni}}),gi),gi),ba=i("e642"),_a=new ba["a"],Sa=_a;i("35b3"),i("a9e3");function Ta(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.EPSILON;return Math.abs(e.x-t.x)<i&&Math.abs(e.y-t.y)<i&&(void 0===e.z||Math.abs(e.z-t.z)<i)}var Aa,da,fa,pa,va,ja,ga,La,ya,Ia,Na,Ra,Pa,Ca,Da,Ga,wa,ma,Ma,xa,Fa,Ha,ka,Ua,za,Ba,Ya,Wa,Ka,Va,Xa,Ja,Za,qa,Qa,$a,en,tn,an,nn,rn,sn,on,cn,ln,un,On,hn,En,bn,_n,Sn,Tn,An,dn,fn,pn,vn,jn,gn,Ln,yn,In,Nn,Rn,Pn,Cn,Dn,Gn,wn,mn,Mn,xn,Fn,Hn,kn,Un,zn,Bn,Yn,Wn,Kn,Vn,Xn,Jn,Zn,qn,Qn,$n,er,tr,ir,ar,nr,rr,sr=[{name:"flipper",color:13369395,coords:[[{x:.0735,y:.7184},{x:.2424,y:.5},{x:.0735,y:.2584},{x:.4735,y:.5},{x:.8735,y:.2584},{x:.7046,y:.5},{x:.8735,y:.7184},{x:.4735,y:.5},{x:.0735,y:.7184}]]},{name:"fuseball",color:[1313015,14020616,15861768,16777215,14555342],coords:[[{x:.5,y:.5},{x:.2008,y:.555},{x:.1262,y:.4646}],[{x:.5,y:.5},{x:.3854,y:.3428},{x:.2538,y:.2839},{x:.3,y:.2},{x:.2479,y:.1484}],[{x:.5,y:.5},{x:.6349,y:.6061},{x:.7214,y:.5727},{x:.8451,y:.6159},{x:.8372,y:.7278},{x:.9296,y:.7416}],[{x:.5,y:.5},{x:.5033,y:.6611},{x:.4326,y:.7239},{x:.5308,y:.7828},{x:.4679,y:.8575},{x:.5446,y:.9596}],[{x:.5,y:.5},{x:.6,y:.4},{x:.6978,y:.4253},{x:.6978,y:.3428},{x:.8117,y:.3546},{x:.8097,y:.2643},{x:.9276,y:.276}]]},{name:"flipperTanker",color:16711884,coords:[[{x:.5,y:.1},{x:.5,y:.4},{x:.1,y:.5},{x:.5,y:.1}],[{x:.5,y:.1},{x:.6,y:.5},{x:.9,y:.5},{x:.5,y:.1}],[{x:.9,y:.5},{x:.5,y:.9},{x:.5,y:.6},{x:.9,y:.5}],[{x:.5,y:.9},{x:.1,y:.5},{x:.4,y:.5},{x:.5,y:.9}],[{x:.5,y:.6},{x:.6,y:.5},{x:.5,y:.4},{x:.4,y:.5},{x:.5,y:.6}]]},{name:"fuseballTanker",color:[16711884,16711884,16711884,16711884,16711884,65280,153,15662913,16777215],coords:[[{x:.5,y:.1},{x:.5,y:.4},{x:.1,y:.5},{x:.5,y:.1}],[{x:.5,y:.1},{x:.6,y:.5},{x:.9,y:.5},{x:.5,y:.1}],[{x:.9,y:.5},{x:.5,y:.9},{x:.5,y:.6},{x:.9,y:.5}],[{x:.5,y:.9},{x:.1,y:.5},{x:.4,y:.5},{x:.5,y:.9}],[{x:.5,y:.6},{x:.6,y:.5},{x:.5,y:.4},{x:.4,y:.5},{x:.5,y:.6}],[{x:.5,y:.5},{x:.6,y:.5}],[{x:.5,y:.5},{x:.5,y:.6}],[{x:.5,y:.5},{x:.4,y:.5}],[{x:.5,y:.5},{x:.5,y:.4}]]},{name:"pulsarTanker",color:[16711884,16711884,16711884,16711884,16711884,65535],coords:[[{x:.5,y:.1},{x:.5,y:.4},{x:.1,y:.5},{x:.5,y:.1}],[{x:.5,y:.1},{x:.6,y:.5},{x:.9,y:.5},{x:.5,y:.1}],[{x:.9,y:.5},{x:.5,y:.9},{x:.5,y:.6},{x:.9,y:.5}],[{x:.5,y:.9},{x:.1,y:.5},{x:.4,y:.5},{x:.5,y:.9}],[{x:.5,y:.6},{x:.6,y:.5},{x:.5,y:.4},{x:.4,y:.5},{x:.5,y:.6}],[{x:.4281,y:.4718},{x:.4607,y:.5607},{x:.5,y:.4},{x:.5392,y:.5607},{x:.5779,y:.4718}]]},{name:"pulsar",color:65535,coords:[[{x:0,y:.5},{x:.2,y:.2},{x:.3615,y:.7383},{x:.5,y:.2},{x:.6335,y:.7501},{x:.8,y:.2},{x:1,y:.5}]]},{name:"spiker",color:65331,coords:[[{x:.4452,y:.5008},{x:.4923,y:.4597},{x:.4499,y:.4231},{x:.3965,y:.4293},{x:.3403,y:.4947},{x:.3737,y:.5737},{x:.4391,y:.6041},{x:.5424,y:.5676},{x:.6002,y:.4947},{x:.5759,y:.4232},{x:.5212,y:.3777},{x:.4345,y:.3701},{x:.3388,y:.3913},{x:.2704,y:.5023},{x:.3099,y:.6071},{x:.4011,y:.6664},{x:.512,y:.674},{x:.6048,y:.6254},{x:.6625,y:.557},{x:.6853,y:.4719},{x:.6838,y:.3928},{x:.6154,y:.3199},{x:.5151,y:.2682},{x:.3585,y:.2713}]]}],or=sr,cr=[{name:"player",color:[16777215,16776960,16711680,16777215,16776960],coords:[[{x:.5,y:.8},{x:.5966,y:.8819},{x:.6112,y:.7561},{x:.7898,y:.8527},{x:.7862,y:.7707}],[{x:.7862,y:.7707},{x:.8555,y:.7287},{x:.7,y:.5},{x:.9156,y:.448},{x:.5984,y:.3313},{x:.7461,y:.0943}],[{x:.7461,y:.0943},{x:.4963,y:.1727},{x:.4726,y:.0524},{x:.3869,y:.211},{x:.2575,y:.048}],[{x:.2575,y:.048},{x:.2192,y:.211},{x:.0606,y:.1964},{x:.1828,y:.4097},{x:.0879,y:.448}],[{x:.0879,y:.448},{x:.1791,y:.5391},{x:.0879,y:.685},{x:.3651,y:.6412},{x:.3505,y:.90379},{x:.5,y:.8}]]},{name:"enemy",color:[16777215,16777215,16777215,16777215,16777215,16777215,16777215,16777215],coords:[[{x:.1,y:.5},{x:.9,y:.5}],[{x:.128,y:.3528},{x:.8696,y:.6527}],[{x:.2174,y:.2168},{x:.7814,y:.7842}],[{x:.335,y:.1356},{x:.667,y:.8634}],[{x:.5,y:.1},{x:.5,y:.9}],[{x:.6728,y:.1392},{x:.3311,y:.8626}],[{x:.7851,y:.2194},{x:.2168,y:.7825}],[{x:.8653,y:.3371},{x:.1361,y:.6661}]]}],lr=cr,ur=function(e){Object(_["a"])(i,e);var t=Object(S["a"])(i);function i(e,n,s){var o;return Object(a["a"])(this,i),o=t.call(this),Object(r["a"])(Object(h["a"])(o),"object",void 0),Object(r["a"])(Object(h["a"])(o),"surface",void 0),Object(r["a"])(Object(h["a"])(o),"modelGroup",void 0),Object(r["a"])(Object(h["a"])(o),"explosionGroup",void 0),Object(r["a"])(Object(h["a"])(o),"objectType",null),o.surface=n,o.objectType=s,o.setObjectRef(e),o.clear(),o.loadModel(),o.object.canExplode&&(o.loadExplosion(),o.setVisualsToNormal()),o.position.set(o.surface.lanesMiddleCoords[o.object.laneId].x,o.surface.lanesMiddleCoords[o.object.laneId].y,o.object.zPosition*o.surface.depth),o.rotation.z=o.surface.lanesCenterDirectionRadians[o.object.laneId],o}return Object(n["a"])(i,[{key:"update",value:function(){null!==this.object&&(this.manageVisibility(),this.updateState(),this.move(),this.rotate())}},{key:"manageVisibility",value:function(){this.visible=this.object.alive}},{key:"setObjectRef",value:function(e){if(this.objectType!==e.type)throw new Error("Can't render ".concat(e.type," with ").concat(this.objectType,"Renderer."));this.object=e,this.position.set(this.surface.lanesMiddleCoords[this.object.laneId].x,this.surface.lanesMiddleCoords[this.object.laneId].y,this.object.zPosition*this.surface.depth),this.rotation.z=this.surface.lanesCenterDirectionRadians[this.object.laneId],this.visible=!0,void 0!==this.modelGroup&&this.setVisualsToNormal()}},{key:"breakObjectRef",value:function(){this.object=null,this.visible=!1}},{key:"setVisualsToNormal",value:function(){throw new Error("Method 'setVisualsToNormal()' must be implemented.")}},{key:"setVisualsToExplode",value:function(){throw new Error("Method 'setVisualsToExplode()' must be implemented.")}},{key:"updateState",value:function(){throw new Error("Method 'updateState()' must be implemented.")}},{key:"move",value:function(){throw new Error("Method 'move()' must be implemented.")}},{key:"rotate",value:function(){throw new Error("Method 'rotate()' must be implemented.")}},{key:"loadModel",value:function(){throw new Error("Method 'loadModel()' must be implemented.")}},{key:"loadExplosion",value:function(){var e,t=this;this.explosionGroup=new o["m"],this.explosionGroup.visible=!1;var i=void 0!==or.find((function(e){return e.name===t.object.type})),a=lr.find((function(e){return e.name===(i?"enemy":"player")}));if(void 0===a)throw new Error("Unknown explosion: "+this.object.type);var n=ua.create((e=[]).concat.apply(e,Object(la["a"])(a.coords)));a.coords.forEach((function(e,i){var r=new o["u"]({color:Array.isArray(a.color)?a.color[i]:a.color}),s=(new o["f"]).setFromPoints(e.map((function(e){return new o["I"](e.x,e.y)})).map((function(e){return e.sub(n.getCenter())})).map((function(e){return new o["J"](e.x,e.y,0)})));t.explosionGroup.add(new o["n"](s,r))})),this.add(this.explosionGroup)}}]),i}(o["m"]),Or=(ya=La=function(e){Object(_["a"])(i,e);var t=Object(S["a"])(i);function i(e,n){var s;return Object(a["a"])(this,i),s=t.call(this,e,n,Vi.TYPE_SHOOTER),Object(r["a"])(Object(h["a"])(s),"positionChangeSpeed",.3),Object(r["a"])(Object(h["a"])(s),"rotationChangeSpeed",.2),s}return Object(n["a"])(i,[{key:"setVisualsToNormal",value:function(){this.explosionGroup.visible=!1}},{key:"setVisualsToExplode",value:function(){this.explosionGroup.visible=!0}},{key:"updateState",value:function(){this.object.inState(Vi.STATE_EXPLODING)?this.explodeAnimation():this.object.inState(Vi.STATE_DISAPPEARING)?this.disappearingAnimation():this.object.inState(Vi.STATE_RENOVATING)?this.renovatingAnimation():this.setVisualsToNormal()}},{key:"disappearingAnimation",value:function(){var e=Math.pow(2*this.object.stateProgressInTime()-1,4);if(this.object.stateProgressInTime()<=.5){var t=e;this.modelGroup.scale.set(t,t,t)}else this.modelGroup.visible=!1}},{key:"renovatingAnimation",value:function(){var e=Math.pow(this.object.stateProgressInTime(),2);this.modelGroup.scale.set(e,e,e),this.modelGroup.visible=!0}},{key:"explodeAnimation",value:function(){this.setVisualsToExplode(),this.zRotationOffset+=i.EXPLOSION_ROTATION_SPEED;var e=Math.pow(2*this.object.stateProgressInTime()-1,4),t=1-e;if(this.explosionGroup.scale.set(t,t,t),this.object.stateProgressInTime()<=.5){var a=e;this.modelGroup.scale.set(a,a,a)}else this.modelGroup.visible=!1}},{key:"move",value:function(){this.position.z=this.object.zPosition*this.surface.depth;var e=this.surface.lanesMiddleCoords[this.object.laneId];if(!Ta(e,this.position)){var t=e.clone();t.sub(this.position),t.setLength(this.positionChangeSpeed),Math.abs(t.x)>Math.abs(e.x-this.position.x)&&(t.x=e.x-this.position.x),Math.abs(t.y)>Math.abs(e.y-this.position.y)&&(t.y=e.y-this.position.y),this.position.x+=t.x,this.position.y+=t.y}}},{key:"rotate",value:function(){var e=this.surface.lanesCenterDirectionRadians[this.object.laneId];if(e!==this.rotation.z)if(Math.abs(e-this.rotation.z)>this.rotationChangeSpeed){var t,i;e<this.rotation.z?(t=this.rotation.z-e,i=2*Math.PI-this.rotation.z+e):(t=2*Math.PI-e+this.rotation.z,i=e-this.rotation.z);var a=t>i?1:-1;this.rotation.z+=a*this.rotationChangeSpeed,this.rotation.z>=2*Math.PI?this.rotation.z-=2*Math.PI:this.rotation.z<0&&(this.rotation.z+=2*Math.PI)}else this.rotation.z=this.surface.lanesCenterDirectionRadians[this.object.laneId]}},{key:"loadModel",value:function(){var e=this;this.modelGroup=new o["m"],Sa.load(i.MODEL_PATH,(function(t){t.traverse((function(t){if(t.isMesh){var a=new o["p"](new o["M"](t.geometry),new o["o"]({color:i.SHOOTER_WIREFRAME_COLOR}));t.add(a),t.material=new o["u"]({color:0,polygonOffset:!0,polygonOffsetFactor:2,polygonOffsetUnits:1}),t.scale.set(i.MODEL_SCALE,i.MODEL_SCALE,i.MODEL_SCALE),t.rotation.y=i.MODEL_ROTATION,t.position.z=i.MODEL_Z_OFFSET,e.modelGroup.add(t)}}))}),null,(function(e){return console.warn(e)})),this.add(this.modelGroup)}}]),i}(ur),Object(r["a"])(La,"MODEL_PATH","../models/player.obj"),Object(r["a"])(La,"MODEL_SCALE",.15),Object(r["a"])(La,"MODEL_ROTATION",-Math.PI/2),Object(r["a"])(La,"MODEL_Z_OFFSET",-.3),Object(r["a"])(La,"SHOOTER_WIREFRAME_COLOR",16776960),Object(r["a"])(La,"EXPLOSION_ROTATION_SPEED",.03),Aa=ya,Object(s["a"])(Aa,"MODEL_PATH",[T],(da=Object.getOwnPropertyDescriptor(Aa,"MODEL_PATH"),da=da?da.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return da}}),Aa),Object(s["a"])(Aa,"MODEL_SCALE",[T],(fa=Object.getOwnPropertyDescriptor(Aa,"MODEL_SCALE"),fa=fa?fa.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return fa}}),Aa),Object(s["a"])(Aa,"MODEL_ROTATION",[T],(pa=Object.getOwnPropertyDescriptor(Aa,"MODEL_ROTATION"),pa=pa?pa.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return pa}}),Aa),Object(s["a"])(Aa,"MODEL_Z_OFFSET",[T],(va=Object.getOwnPropertyDescriptor(Aa,"MODEL_Z_OFFSET"),va=va?va.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return va}}),Aa),Object(s["a"])(Aa,"SHOOTER_WIREFRAME_COLOR",[T],(ja=Object.getOwnPropertyDescriptor(Aa,"SHOOTER_WIREFRAME_COLOR"),ja=ja?ja.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return ja}}),Aa),Object(s["a"])(Aa,"EXPLOSION_ROTATION_SPEED",[T],(ga=Object.getOwnPropertyDescriptor(Aa,"EXPLOSION_ROTATION_SPEED"),ga=ga?ga.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return ga}}),Aa),Aa),hr=(i("caad"),i("2532"),Ga=Da=function(e){Object(_["a"])(i,e);var t=Object(S["a"])(i);function i(e,n){return Object(a["a"])(this,i),t.call(this,e,n,Mi.TYPE_PROJECTILE)}return Object(n["a"])(i,[{key:"setObjectRef",value:function(e){Object(E["a"])(Object(b["a"])(i.prototype),"setObjectRef",this).call(this,e),this.children.length&&(this.children[1].material=new o["o"]({color:this.getMaterialColor()}))}},{key:"updateState",value:function(){}},{key:"move",value:function(){this.position.z=this.object.zPosition*this.surface.depth}},{key:"rotate",value:function(){this.rotation.x+=i.ROTATION_SPEED,this.rotation.y+=i.ROTATION_SPEED}},{key:"loadModel",value:function(){this.clear();var e=new o["e"](i.PROJECTILE_SIZE,i.PROJECTILE_SIZE,i.PROJECTILE_SIZE),t=new o["u"]({color:0,polygonOffset:!0,polygonOffsetFactor:2,polygonOffsetUnits:1});this.add(new o["t"](e,t));var a=new o["p"](new o["M"](e),new o["o"]({color:this.getMaterialColor()}));this.add(a)}},{key:"getMaterialColor",value:function(){return this.object.source===Mi.SOURCE_SHOOTER?i.PROJECTILE_SHOOTER_COLOR:i.PROJECTILE_ENEMY_COLOR}}]),i}(ur),Object(r["a"])(Da,"PROJECTILE_SIZE",.1),Object(r["a"])(Da,"PROJECTILE_SHOOTER_COLOR",16776960),Object(r["a"])(Da,"PROJECTILE_ENEMY_COLOR",16711935),Object(r["a"])(Da,"ROTATION_SPEED",.1),Ia=Ga,Object(s["a"])(Ia,"PROJECTILE_SIZE",[T],(Na=Object.getOwnPropertyDescriptor(Ia,"PROJECTILE_SIZE"),Na=Na?Na.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return Na}}),Ia),Object(s["a"])(Ia,"PROJECTILE_SHOOTER_COLOR",[T],(Ra=Object.getOwnPropertyDescriptor(Ia,"PROJECTILE_SHOOTER_COLOR"),Ra=Ra?Ra.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return Ra}}),Ia),Object(s["a"])(Ia,"PROJECTILE_ENEMY_COLOR",[T],(Pa=Object.getOwnPropertyDescriptor(Ia,"PROJECTILE_ENEMY_COLOR"),Pa=Pa?Pa.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return Pa}}),Ia),Object(s["a"])(Ia,"ROTATION_SPEED",[T],(Ca=Object.getOwnPropertyDescriptor(Ia,"ROTATION_SPEED"),Ca=Ca?Ca.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return Ca}}),Ia),Ia),Er=function(e){Object(_["a"])(i,e);var t=Object(S["a"])(i);function i(e,n){var s;return Object(a["a"])(this,i),s=t.call(this),Object(r["a"])(Object(h["a"])(s),"projectileManager",void 0),Object(r["a"])(Object(h["a"])(s),"surface",void 0),Object(r["a"])(Object(h["a"])(s),"projectileRenderers",[]),Object(r["a"])(Object(h["a"])(s),"projectileRenderersAvailabilityMap",[]),s.projectileManager=e,s.surface=n,s}return Object(n["a"])(i,[{key:"update",value:function(){var e=this;0!==this.projectileManager.rendererHelperNewProjectilesIds.length&&(this.projectileManager.shooterProjectiles.filter((function(t){return e.projectileManager.rendererHelperNewProjectilesIds.includes(t.objectId)})).forEach((function(t){e.pushProjectile(t)})),this.projectileManager.enemyProjectiles.filter((function(t){return e.projectileManager.rendererHelperNewProjectilesIds.includes(t.objectId)})).forEach((function(t){e.pushProjectile(t)})),this.projectileManager.rendererHelperNewProjectilesIds.length=0),this.projectileRenderers.forEach((function(t,i){null!==t.object&&(t.object.alive?t.update():(t.breakObjectRef(),e.projectileRenderersAvailabilityMap.push(i)))}))}},{key:"pushProjectile",value:function(e){this.projectileRenderersAvailabilityMap.length?this.projectileRenderers[this.projectileRenderersAvailabilityMap.shift()].setObjectRef(e):(this.projectileRenderers.push(new hr(e,this.surface)),this.add(this.projectileRenderers[this.projectileRenderers.length-1]))}}]),i}(o["m"]),br=(xa=Ma=function(e){Object(_["a"])(i,e);var t=Object(S["a"])(i);function i(e,n,s){var c;return Object(a["a"])(this,i),c=t.call(this,e,n,s),Object(r["a"])(Object(h["a"])(c),"geometry",void 0),Object(r["a"])(Object(h["a"])(c),"materials",void 0),Object(r["a"])(Object(h["a"])(c),"positionBase",new o["I"]),Object(r["a"])(Object(h["a"])(c),"positionOffset",new o["I"]),Object(r["a"])(Object(h["a"])(c),"zRotationBase",0),Object(r["a"])(Object(h["a"])(c),"zRotationOffset",0),Object(r["a"])(Object(h["a"])(c),"rotatingStateCache",{valid:!1,continuousRotationUpdate:!1,relativeHalfStep:0,sourceLaneId:0,targetLaneId:0,rotationDirection:0}),c.setLaneOffset(),c}return Object(n["a"])(i,[{key:"setObjectRef",value:function(e){if(e.type!==this.objectType)throw new Error("Can't associate ".concat(e.type," with ").concat(this.objectType," renderer"));Object(E["a"])(Object(b["a"])(i.prototype),"setObjectRef",this).call(this,e)}},{key:"setVisualsToNormal",value:function(){this.modelGroup.visible=!0,this.modelGroup.scale.set(1,1,1),this.explosionGroup.visible=!1}},{key:"setVisualsToExplode",value:function(){this.explosionGroup.visible=!0}},{key:"explodeAnimation",value:function(){this.setVisualsToExplode(),this.zRotationOffset+=i.EXPLOSION_ROTATION_SPEED;var e=Math.pow(2*this.object.stateProgressInTime()-1,4),t=1-e;if(this.explosionGroup.scale.set(t,t,t),this.object.stateProgressInTime()<=.5){var a=e;this.modelGroup.scale.set(a,a,a)}else this.modelGroup.visible=!1}},{key:"disappearingAnimation",value:function(){var e=Math.pow(2*this.object.stateProgressInTime()-1,4);if(this.object.stateProgressInTime()<=.5){var t=e;this.modelGroup.scale.set(t,t,t)}else this.modelGroup.visible=!1}},{key:"move",value:function(){this.position.set(this.positionBase.x+this.positionOffset.x,this.positionBase.y+this.positionOffset.y,this.object.zPosition*this.surface.depth)}},{key:"rotate",value:function(){this.rotation.z=this.zRotationBase+this.zRotationOffset}},{key:"setLaneOffset",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,t=this.surface.lanesCoords[this.object.laneId].clone(),i=this.surface.lanesMiddleCoords[this.object.laneId].clone(),a=2*(e-.5);i.sub(t).multiplyScalar(a),this.positionOffset=i}},{key:"calculateRotationStateCacheVariables",value:function(e){this.rotatingStateCache.rotationDirection=e,this.rotatingStateCache.sourceLaneId=this.object.laneId,this.rotatingStateCache.targetLaneId=this.surface.getActualLaneIdFromProjectedMovement(this.object.laneId+this.rotatingStateCache.rotationDirection);var t,i=this.surface.lanesCenterDirectionRadians[this.rotatingStateCache.sourceLaneId],a=this.surface.lanesCenterDirectionRadians[this.rotatingStateCache.targetLaneId],n=(a+Math.PI)%(2*Math.PI);t=1===this.rotatingStateCache.rotationDirection?i>n?i-n:i+(2*Math.PI-n):i>n?2*Math.PI-i+n:n-i,this.rotatingStateCache.relativeHalfStep=t/2,this.rotatingStateCache.valid=!0}},{key:"invalidateRotationStateCache",value:function(){this.rotatingStateCache.valid=!1}},{key:"isRotationStateCacheValid",value:function(){return this.rotatingStateCache.valid}},{key:"loadModel",value:function(){var e,t=this;this.modelGroup=new o["m"];var i=or.find((function(e){return e.name===t.object.type}));if(void 0===i)throw new Error("Unknown object: "+this.object.type);var a=ua.create((e=[]).concat.apply(e,Object(la["a"])(i.coords)));i.coords.forEach((function(e,n){var r=new o["u"]({color:Array.isArray(i.color)?i.color[n]:i.color}),s=(new o["f"]).setFromPoints(e.map((function(e){return new o["I"](e.x,e.y)})).map((function(e){return e.sub(a.getCenter())})).map((function(e){return new o["J"](e.x,e.y,0)})));t.modelGroup.add(new o["n"](s,r))})),this.add(this.modelGroup)}}]),i}(ur),Object(r["a"])(Ma,"EXPLOSION_ROTATION_SPEED",.03),wa=xa,Object(s["a"])(wa,"EXPLOSION_ROTATION_SPEED",[T],(ma=Object.getOwnPropertyDescriptor(wa,"EXPLOSION_ROTATION_SPEED"),ma=ma?ma.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return ma}}),wa),wa),_r=function(e){Object(_["a"])(i,e);var t=Object(S["a"])(i);function i(e,n){return Object(a["a"])(this,i),t.call(this,e,n,zi.TYPE_FLIPPER)}return Object(n["a"])(i,[{key:"updateState",value:function(){if((this.object.inState(Wi.STATE_ROTATING_BEGIN)||this.object.inState(Wi.STATE_ROTATING_END))&&(this.object.isFlagSet(Wi.FLAG_ROTATION_CW)||this.object.isFlagSet(Wi.FLAG_ROTATION_CCW))){this.object.inState(Wi.STATE_ROTATING_BEGIN)&&this.object.prevState.equals(Wi.STATE_ROTATING_END)&&!this.rotatingStateCache.continuousRotationUpdate&&(this.rotatingStateCache.continuousRotationUpdate=!0,this.rotatingStateCache.valid=!1),this.object.inState(Wi.STATE_ROTATING_END)&&(this.rotatingStateCache.continuousRotationUpdate=!1),this.isRotationStateCacheValid()||this.calculateRotationStateCacheVariables(this.object.isFlagSet(Wi.FLAG_ROTATION_CCW)?1:-1);var e=this.object.isFlagSet(Wi.FLAG_ROTATION_CW)?this.rotatingStateCache.sourceLaneId:this.rotatingStateCache.targetLaneId;this.zRotationBase=this.surface.lanesCenterDirectionRadians[e],this.positionBase=this.surface.lanesMiddleCoords[e].clone(),this.object.inState(Wi.STATE_ROTATING_BEGIN)?this.object.isFlagSet(Wi.FLAG_ROTATION_CW)?this.zRotationOffset=this.rotatingStateCache.relativeHalfStep*this.object.stateProgressInTime():this.zRotationOffset=this.rotatingStateCache.relativeHalfStep*(2-this.object.stateProgressInTime()):this.object.isFlagSet(Wi.FLAG_ROTATION_CW)?this.zRotationOffset=this.rotatingStateCache.relativeHalfStep*(this.object.stateProgressInTime()+1):this.zRotationOffset=this.rotatingStateCache.relativeHalfStep*(1-this.object.stateProgressInTime());var t=(new o["I"]).subVectors(this.surface.lanesCoords[e],this.surface.lanesMiddleCoords[e]).rotateAround(new o["I"](0,0),this.zRotationOffset);this.positionBase=this.surface.lanesCoords[e].clone().sub(t)}else this.object.inState(Wi.STATE_EXPLODING)?this.explodeAnimation():this.object.inState(Wi.STATE_DISAPPEARING)?this.disappearingAnimation():(this.zRotationBase=this.surface.lanesCenterDirectionRadians[this.object.laneId],this.positionBase=this.surface.lanesMiddleCoords[this.object.laneId].clone(),this.zRotationOffset=0,this.invalidateRotationStateCache())}}]),i}(br),Sr=(Ua=ka=function(e){Object(_["a"])(i,e);var t=Object(S["a"])(i);function i(e,n){return Object(a["a"])(this,i),t.call(this,e,n,zi.TYPE_SPIKER)}return Object(n["a"])(i,[{key:"updateState",value:function(){this.positionBase=this.surface.lanesMiddleCoords[this.object.laneId].clone(),this.zRotationBase=this.surface.lanesCenterDirectionRadians[this.object.laneId],this.object.inState(Ji.STATE_EXPLODING)?this.explodeAnimation():this.object.inState(Ji.STATE_DISAPPEARING)?this.disappearingAnimation():this.zRotationOffset+=i.ROTATION_SPEED}}]),i}(br),Object(r["a"])(ka,"ROTATION_SPEED",.1),Fa=Ua,Object(s["a"])(Fa,"ROTATION_SPEED",[T],(Ha=Object.getOwnPropertyDescriptor(Fa,"ROTATION_SPEED"),Ha=Ha?Ha.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return Ha}}),Fa),Fa),Tr=(Wa=Ya=function(e){Object(_["a"])(i,e);var t=Object(S["a"])(i);function i(e,n){return Object(a["a"])(this,i),t.call(this,e,n,zi.TYPE_SPIKE)}return Object(n["a"])(i,[{key:"updateState",value:function(){this.object.shouldRerenderSpikeDueToSpikeLengthChange()&&this.updateModel(),this.positionBase=this.surface.lanesMiddleCoords[this.object.laneId].clone(),this.zRotationBase=this.surface.lanesCenterDirectionRadians[this.object.laneId]}},{key:"updateModel",value:function(){this.children[0].geometry=(new o["f"]).setFromPoints([new o["J"](0,0,0),new o["J"](0,0,(1-this.object.zPosition)*this.surface.depth)])}},{key:"loadModel",value:function(){this.clear(),this.geometry=[],this.materials=[],this.materials.push(new o["u"]({color:i.SPIKE_COLOR})),this.geometry.push((new o["f"]).setFromPoints([new o["J"](0,0,0),new o["J"](0,0,(1-this.object.zPosition)*this.surface.depth)])),this.add(new o["n"](this.geometry[0],this.materials[0]))}}]),i}(br),Object(r["a"])(Ya,"SPIKE_COLOR",65280),za=Wa,Object(s["a"])(za,"SPIKE_COLOR",[T],(Ba=Object.getOwnPropertyDescriptor(za,"SPIKE_COLOR"),Ba=Ba?Ba.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return Ba}}),za),za),Ar=function(e){Object(_["a"])(i,e);var t=Object(S["a"])(i);function i(e,n){return Object(a["a"])(this,i),t.call(this,e,n,zi.TYPE_FLIPPER_TANKER)}return Object(n["a"])(i,[{key:"updateState",value:function(){this.positionBase=this.surface.lanesMiddleCoords[this.object.laneId].clone(),this.zRotationBase=this.surface.lanesCenterDirectionRadians[this.object.laneId],this.object.inState(aa.STATE_EXPLODING)?this.explodeAnimation():this.object.inState(aa.STATE_DISAPPEARING)&&this.disappearingAnimation()}}]),i}(br),dr=(Ja=Xa=function(e){Object(_["a"])(i,e);var t=Object(S["a"])(i);function i(e,n){return Object(a["a"])(this,i),t.call(this,e,n,zi.TYPE_FUSEBALL)}return Object(n["a"])(i,[{key:"updateState",value:function(){var e=this.object;this.positionBase=this.surface.lanesMiddleCoords[e.laneId].clone(),this.zRotationBase=0,e.inState(Ki.STATE_SWITCHING_LANE)||e.inState(Ki.STATE_EXPLODING)?e.isFlagSet(Ki.FLAG_SWITCHING_LANE_CCW)?this.setLaneOffset(1-e.lastLaneSwitchingProgress):this.setLaneOffset(e.lastLaneSwitchingProgress):this.setLaneOffset(0),e.inState(Ki.STATE_EXPLODING)?this.explodeAnimation():this.object.inState(Ki.STATE_DISAPPEARING)?this.disappearingAnimation():this.zRotationOffset+=i.ROTATION_SPEED}}]),i}(br),Object(r["a"])(Xa,"ROTATION_SPEED",.02),Ka=Ja,Object(s["a"])(Ka,"ROTATION_SPEED",[T],(Va=Object.getOwnPropertyDescriptor(Ka,"ROTATION_SPEED"),Va=Va?Va.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return Va}}),Ka),Ka),fr=function(e){Object(_["a"])(i,e);var t=Object(S["a"])(i);function i(e,n){return Object(a["a"])(this,i),t.call(this,e,n,zi.TYPE_FUSEBALL_TANKER)}return Object(n["a"])(i,[{key:"updateState",value:function(){this.positionBase=this.surface.lanesMiddleCoords[this.object.laneId].clone(),this.zRotationBase=this.surface.lanesCenterDirectionRadians[this.object.laneId],this.object.inState(aa.STATE_EXPLODING)?this.explodeAnimation():this.object.inState(aa.STATE_DISAPPEARING)&&this.disappearingAnimation()}}]),i}(br),pr=(an=tn=function(e){Object(_["a"])(i,e);var t=Object(S["a"])(i);function i(e,n){var s;return Object(a["a"])(this,i),s=t.call(this,e,n,zi.TYPE_PULSAR),Object(r["a"])(Object(h["a"])(s),"colorHelperPrevState",-1),s}return Object(n["a"])(i,[{key:"updateState",value:function(){if((this.object.inState(ia.STATE_ROTATING_BEGIN)||this.object.inState(ia.STATE_ROTATING_END))&&(this.object.isFlagSet(ia.FLAG_ROTATION_CW)||this.object.isFlagSet(ia.FLAG_ROTATION_CCW))){this.object.inState(ia.STATE_ROTATING_BEGIN)&&this.object.prevState.equals(ia.STATE_ROTATING_END)&&!this.rotatingStateCache.continuousRotationUpdate&&(this.rotatingStateCache.continuousRotationUpdate=!0,this.rotatingStateCache.valid=!1),this.object.inState(ia.STATE_ROTATING_END)&&(this.rotatingStateCache.continuousRotationUpdate=!1),this.isRotationStateCacheValid()||this.calculateRotationStateCacheVariables(this.object.isFlagSet(ia.FLAG_ROTATION_CCW)?1:-1);var e=this.object.isFlagSet(ia.FLAG_ROTATION_CW)?this.rotatingStateCache.sourceLaneId:this.rotatingStateCache.targetLaneId;this.zRotationBase=this.surface.lanesCenterDirectionRadians[e],this.positionBase=this.surface.lanesMiddleCoords[e].clone(),this.object.inState(ia.STATE_ROTATING_BEGIN)?this.object.isFlagSet(ia.FLAG_ROTATION_CW)?this.zRotationOffset=this.rotatingStateCache.relativeHalfStep*this.object.stateProgressInTime():this.zRotationOffset=this.rotatingStateCache.relativeHalfStep*(2-this.object.stateProgressInTime()):this.object.isFlagSet(ia.FLAG_ROTATION_CW)?this.zRotationOffset=this.rotatingStateCache.relativeHalfStep*(this.object.stateProgressInTime()+1):this.zRotationOffset=this.rotatingStateCache.relativeHalfStep*(1-this.object.stateProgressInTime());var t=(new o["I"]).subVectors(this.surface.lanesCoords[e],this.surface.lanesMiddleCoords[e]).rotateAround(new o["I"](0,0),this.zRotationOffset);this.positionBase=this.surface.lanesCoords[e].clone().sub(t)}else this.object.inState(ia.STATE_EXPLODING)?this.explodeAnimation():this.object.inState(ia.STATE_DISAPPEARING)?this.disappearingAnimation():(this.zRotationBase=this.surface.lanesCenterDirectionRadians[this.object.laneId],this.positionBase=this.surface.lanesMiddleCoords[this.object.laneId].clone(),this.zRotationOffset=0,this.invalidateRotationStateCache());this.setScale(),this.setMaterial()}},{key:"setScale",value:function(){var e=i.BASE_Y_SCALE;this.object.inState(ia.STATE_WARNING)&&(e+=this.object.stateProgressInTime()*i.PULSE_Y_SCALE),this.object.inState(ia.STATE_PULSATING)&&(e+=(1+Math.sin(this.object.stateProgressInTime()*Math.PI*11.6))*i.PULSE_Y_SCALE),this.object.isFlagSet(ia.FLAG_ROTATION_CCW)&&(e*=-1),this.object.rendererHelperLaneChangesAmount%2===1&&(e*=-1),this.modelGroup.scale.setY(e)}},{key:"setMaterial",value:function(){if(this.colorHelperPrevState!==this.object.state.id){var e=!this.object.inState(ia.STATE_WARNING)&&!this.object.inState(ia.STATE_PULSATING);this.modelGroup.children[0].material=new o["u"]({color:e?i.NEUTRAL_COLOR:i.PULSE_COLOR}),this.colorHelperPrevState=this.object.state.id}}}]),i}(br),Object(r["a"])(tn,"NEUTRAL_COLOR",65535),Object(r["a"])(tn,"PULSE_COLOR",16777215),Object(r["a"])(tn,"BASE_Y_SCALE",.2),Object(r["a"])(tn,"PULSE_Y_SCALE",.8),Za=an,Object(s["a"])(Za,"NEUTRAL_COLOR",[T],(qa=Object.getOwnPropertyDescriptor(Za,"NEUTRAL_COLOR"),qa=qa?qa.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return qa}}),Za),Object(s["a"])(Za,"PULSE_COLOR",[T],(Qa=Object.getOwnPropertyDescriptor(Za,"PULSE_COLOR"),Qa=Qa?Qa.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return Qa}}),Za),Object(s["a"])(Za,"BASE_Y_SCALE",[T],($a=Object.getOwnPropertyDescriptor(Za,"BASE_Y_SCALE"),$a=$a?$a.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return $a}}),Za),Object(s["a"])(Za,"PULSE_Y_SCALE",[T],(en=Object.getOwnPropertyDescriptor(Za,"PULSE_Y_SCALE"),en=en?en.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return en}}),Za),Za),vr=function(e){Object(_["a"])(i,e);var t=Object(S["a"])(i);function i(e,n){return Object(a["a"])(this,i),t.call(this,e,n,zi.TYPE_PULSAR_TANKER)}return Object(n["a"])(i,[{key:"updateState",value:function(){this.positionBase=this.surface.lanesMiddleCoords[this.object.laneId].clone(),this.zRotationBase=this.surface.lanesCenterDirectionRadians[this.object.laneId],this.object.inState(aa.STATE_EXPLODING)?this.explodeAnimation():this.object.inState(aa.STATE_DISAPPEARING)&&this.disappearingAnimation()}}]),i}(br),jr=function(e){Object(_["a"])(i,e);var t=Object(S["a"])(i);function i(e,n){var s;return Object(a["a"])(this,i),s=t.call(this),Object(r["a"])(Object(h["a"])(s),"surfaceObjectsManager",void 0),Object(r["a"])(Object(h["a"])(s),"surface",void 0),Object(r["a"])(Object(h["a"])(s),"enemyRenderers",[]),Object(r["a"])(Object(h["a"])(s),"enemyRenderersAvailabilityMap",[]),s.surfaceObjectsManager=e,s.surface=n,s}return Object(n["a"])(i,[{key:"update",value:function(){var e=this;0!==this.surfaceObjectsManager.rendererHelperNewObjectsIds.length&&(this.surfaceObjectsManager.enemies.filter((function(t){return e.surfaceObjectsManager.rendererHelperNewObjectsIds.includes(t.objectId)})).forEach((function(t){e.pushEnemy(t)})),this.surfaceObjectsManager.spikes.filter((function(t){return e.surfaceObjectsManager.rendererHelperNewObjectsIds.includes(t.objectId)})).forEach((function(t){e.pushEnemy(t)})),this.surfaceObjectsManager.rendererHelperNewObjectsIds.length=0),this.enemyRenderers.forEach((function(t,i){null!==t.object&&(t.object.alive?t.update():(t.objectType in e.enemyRenderersAvailabilityMap||(e.enemyRenderersAvailabilityMap[t.objectType]=[]),e.enemyRenderersAvailabilityMap[t.objectType].push(i),t.breakObjectRef()))}))}},{key:"pushEnemy",value:function(e){e.type in this.enemyRenderersAvailabilityMap&&this.enemyRenderersAvailabilityMap[e.type].length?this.enemyRenderers[this.enemyRenderersAvailabilityMap[e.type].shift()].setObjectRef(e):(this.enemyRenderers.push(this.enemyRendererFactory(e)),this.add(this.enemyRenderers[this.enemyRenderers.length-1]))}},{key:"enemyRendererFactory",value:function(e){switch(e.type){case zi.TYPE_FLIPPER:return new _r(e,this.surface);case zi.TYPE_SPIKER:return new Sr(e,this.surface);case zi.TYPE_SPIKE:return new Tr(e,this.surface);case zi.TYPE_FLIPPER_TANKER:return new Ar(e,this.surface);case zi.TYPE_FUSEBALL:return new dr(e,this.surface);case zi.TYPE_FUSEBALL_TANKER:return new fr(e,this.surface);case zi.TYPE_PULSAR:return new pr(e,this.surface);case zi.TYPE_PULSAR_TANKER:return new vr(e,this.surface);default:throw new Error("Can't find constructor for enemy of type ".concat(e.type))}}}]),i}(o["m"]),gr=(on=sn=function(e){Object(_["a"])(i,e);var t=Object(S["a"])(i);function i(e){var n;return Object(a["a"])(this,i),n=t.call(this),Object(r["a"])(Object(h["a"])(n),"level",null),Object(r["a"])(Object(h["a"])(n),"camera",void 0),Object(r["a"])(Object(h["a"])(n),"surfaceRenderer",void 0),Object(r["a"])(Object(h["a"])(n),"shooterRenderer",void 0),Object(r["a"])(Object(h["a"])(n),"projectileRendererManager",void 0),Object(r["a"])(Object(h["a"])(n),"enemyRendererManager",void 0),n.camera=e,n}return Object(n["a"])(i,[{key:"bindLevel",value:function(e){this.level=e,this.surfaceRenderer=new Ea(this.level.surface,this.level.currentLevel),this.shooterRenderer=new Or(this.level.shooter,this.level.surface),this.enemyRendererManager=new jr(this.level.surfaceObjectsManager,this.level.surface),this.projectileRendererManager=new Er(this.level.projectileManager,this.level.surface),this.add(this.surfaceRenderer),this.add(this.shooterRenderer),this.add(this.enemyRendererManager),this.add(this.projectileRendererManager),this.position.setY(e.surface.zOffset)}},{key:"releaseLevel",value:function(){this.remove(this.surfaceRenderer),this.remove(this.shooterRenderer),this.remove(this.enemyRendererManager),this.remove(this.projectileRendererManager),this.level=null,this.surfaceRenderer=void 0,this.shooterRenderer=void 0,this.enemyRendererManager=void 0,this.projectileRendererManager=void 0}},{key:"followShooter",value:function(){var e=this.surfaceRenderer.surface.depth,t=this.shooterRenderer.position.z;t>=e&&(t+=.05*Math.pow(t-e,2)),t<0&&(t*=.9),this.camera.position.z=t-i.CAMERA_TO_SHOOTER_DISTANCE,this.camera.lookAt(this.camera.position.x,this.camera.position.y,this.camera.position.z+10)}},{key:"update",value:function(){null!==this.level&&(this.surfaceRenderer.update(),this.shooterRenderer.update(),this.enemyRendererManager.update(),this.projectileRendererManager.update(),this.followShooter())}}]),i}(o["m"]),Object(r["a"])(sn,"CAMERA_TO_SHOOTER_DISTANCE",6),nn=on,Object(s["a"])(nn,"CAMERA_TO_SHOOTER_DISTANCE",[T],(rn=Object.getOwnPropertyDescriptor(nn,"CAMERA_TO_SHOOTER_DISTANCE"),rn=rn?rn.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return rn}}),nn),nn),Lr=(i("a15b"),i("ac1f"),i("1276"),i("4d90"),Tn=Sn=function(e){Object(_["a"])(i,e);var t=Object(S["a"])(i);function i(e){var n,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1024,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1024;Object(a["a"])(this,i);var O=document.createElement("canvas").getContext("2d");O.canvas.width=1024,O.canvas.height=1024;var E=new o["g"](O.canvas);return E.minFilter=o["q"],n=t.call(this,new o["z"](s,c),new o["u"]({map:E,side:o["j"],transparent:!0})),Object(r["a"])(Object(h["a"])(n),"context",void 0),Object(r["a"])(Object(h["a"])(n),"texture",void 0),Object(r["a"])(Object(h["a"])(n),"fontName","VectorBattle"),Object(r["a"])(Object(h["a"])(n),"vectorBattleFont",void 0),Object(r["a"])(Object(h["a"])(n),"fontReady",!1),Object(r["a"])(Object(h["a"])(n),"canvasResX",void 0),Object(r["a"])(Object(h["a"])(n),"canvasResY",void 0),Object(r["a"])(Object(h["a"])(n),"screenContentManager",void 0),Object(r["a"])(Object(h["a"])(n),"lastKeyInputTimestamp",0),Object(r["a"])(Object(h["a"])(n),"debug",!1),n.context=O,n.texture=E,n.canvasResX=l,n.canvasResY=u,n.setLineWidth(),n.setFontSizePx(60),n.vectorBattleFont=new FontFace("VectorBattle","url(VectorBattle.ttf)"),n.vectorBattleFont.load().then((function(e){document.fonts.add(e),n.fontReady=!0})),n.screenContentManager=e,n}return Object(n["a"])(i,[{key:"release",value:function(){}},{key:"keyInputDelay",value:function(){var e=Date.now();return!(e-this.lastKeyInputTimestamp<i.KEY_INPUT_DELAY)&&(this.lastKeyInputTimestamp=e,!0)}},{key:"clearCanvas",value:function(){this.context.clearRect(0,0,this.canvasResX,this.canvasResY)}},{key:"setLineWidth",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;this.context.lineWidth=e}},{key:"setFontSizePx",value:function(e){this.context.font="".concat(e,"px ").concat(this.fontName)}},{key:"drawText",value:function(e,t,a,n){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2;if("number"===typeof e&&(e=e.toString()),r>0&&r<3&&(e=e.split("").join(String.fromCharCode(8200+r))),this.debug){this.setLineWidth(1);var s=this.context.measureText(e),o=8;this.drawRect(t-o,a+o,s.width+2*o,-s.actualBoundingBoxAscent-2*o,i.COLOR_WHITE),this.drawLine(t+s.width/2,a-s.actualBoundingBoxAscent/2-50,t+s.width/2,a+50,i.COLOR_WHITE),this.setLineWidth()}this.context.strokeStyle=n,this.context.strokeText(e,t,a),this.context.fillStyle=n,this.context.fillText(e,t,a)}},{key:"drawLine",value:function(e,t,i,a,n){this.context.strokeStyle=n,this.context.beginPath(),this.context.moveTo(e,t),this.context.lineTo(i,a),this.context.stroke()}},{key:"drawRect",value:function(e,t,i,a,n){this.context.strokeStyle=n,this.context.strokeRect(e,t,i,a)}},{key:"displayCanvasBorder",value:function(){this.drawRect(1,1,this.canvasResX-2,this.canvasResY-2,i.COLOR_RED)}},{key:"update",value:function(){this.fontReady&&(this.draw(),this.debug&&this.displayCanvasBorder(),this.queueTextureUpdate())}},{key:"draw",value:function(){this.clearCanvas();var e="rgb(".concat(Yi(0,256),", ").concat(Yi(0,256),", ").concat(Yi(0,256),")");this.drawText("TEMPEST",Yi(256,500),Yi(500,600),e)}},{key:"queueTextureUpdate",value:function(){this.material.map.needsUpdate=!0}},{key:"alignNumberToRight",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6;return e.toString().padStart(t,this.debug?"_":" ")}}]),i}(o["t"]),Object(r["a"])(Sn,"KEY_INPUT_DELAY",200),Object(r["a"])(Sn,"COLOR_RED","rgba(255, 0, 0, 1)"),Object(r["a"])(Sn,"COLOR_BLUE","rgb(20,20,255)"),Object(r["a"])(Sn,"COLOR_GREEN","rgb(13,194,13)"),Object(r["a"])(Sn,"COLOR_WHITE","rgb(255,255,255)"),Object(r["a"])(Sn,"COLOR_YELLOW","rgb(255,255,0)"),Object(r["a"])(Sn,"COLOR_CYAN","rgb(100,255,200)"),cn=Tn,Object(s["a"])(cn,"KEY_INPUT_DELAY",[T],(ln=Object.getOwnPropertyDescriptor(cn,"KEY_INPUT_DELAY"),ln=ln?ln.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return ln}}),cn),Object(s["a"])(cn,"COLOR_RED",[T],(un=Object.getOwnPropertyDescriptor(cn,"COLOR_RED"),un=un?un.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return un}}),cn),Object(s["a"])(cn,"COLOR_BLUE",[T],(On=Object.getOwnPropertyDescriptor(cn,"COLOR_BLUE"),On=On?On.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return On}}),cn),Object(s["a"])(cn,"COLOR_GREEN",[T],(hn=Object.getOwnPropertyDescriptor(cn,"COLOR_GREEN"),hn=hn?hn.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return hn}}),cn),Object(s["a"])(cn,"COLOR_WHITE",[T],(En=Object.getOwnPropertyDescriptor(cn,"COLOR_WHITE"),En=En?En.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return En}}),cn),Object(s["a"])(cn,"COLOR_YELLOW",[T],(bn=Object.getOwnPropertyDescriptor(cn,"COLOR_YELLOW"),bn=bn?bn.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return bn}}),cn),Object(s["a"])(cn,"COLOR_CYAN",[T],(_n=Object.getOwnPropertyDescriptor(cn,"COLOR_CYAN"),_n=_n?_n.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return _n}}),cn),cn),yr=function(){function e(){Object(a["a"])(this,e),Object(r["a"])(this,"content",[]),Object(r["a"])(this,"updateFlag",!1)}return Object(n["a"])(e,[{key:"set",value:function(e,t){this.content[e]=t,this.setUpdateFlag()}},{key:"get",value:function(e){return this.content[e]}},{key:"setUpdateFlag",value:function(){this.updateFlag=!0}},{key:"unsetUpdateFlag",value:function(){this.updateFlag=!1}},{key:"isUpdateFlagSet",value:function(){return this.updateFlag}}]),e}(),Ir=(mn=wn=function(e){Object(_["a"])(i,e);var t=Object(S["a"])(i);function i(){return Object(a["a"])(this,i),t.apply(this,arguments)}return Object(n["a"])(i,[{key:"setScore",value:function(e){this.set(i.KEY_SCORE,e)}},{key:"setHighScores",value:function(e){this.set(i.KEY_HIGH_SCORES,e),this.set(i.KEY_HIGHEST_SCORE,e[0])}},{key:"setCredits",value:function(e){this.set(i.KEY_CREDITS,e)}},{key:"setLives",value:function(e){this.set(i.KEY_LIVES,e)}},{key:"setLevel",value:function(e){this.set(i.KEY_LEVEL,e)}},{key:"setSuperzapperUsed",value:function(e){this.set(i.KEY_SUPERZAPPER_USED,e)}},{key:"setSelectOffset",value:function(e){this.set(i.KEY_SELECT_OFFSET,e)}},{key:"setSelectActive",value:function(e){this.set(i.KEY_SELECT_ACTIVE,e)}},{key:"setSelectLevels",value:function(e){this.set(i.KEY_LEVELS,e)}},{key:"setLevelSelectedCallback",value:function(e){this.set(i.KEY_LEVEL_SELECTED_CALLBACK,e)}},{key:"setCloseHighScoresScreenCallback",value:function(e){this.set(i.KEY_CLOSE_HIGH_SCORES_SCREEN_CALLBACK,e)}},{key:"setPushHighScoreCallback",value:function(e){this.set(i.KEY_PUSH_HIGH_SCORE_CALLBACK,e)}}]),i}(yr),Object(r["a"])(wn,"KEY_PLAYER_ID","player_id"),Object(r["a"])(wn,"KEY_SCORE","score"),Object(r["a"])(wn,"KEY_HIGHEST_SCORE","highest_score"),Object(r["a"])(wn,"KEY_HIGH_SCORES","high_scores"),Object(r["a"])(wn,"KEY_LIVES","lives"),Object(r["a"])(wn,"KEY_LEVEL","level"),Object(r["a"])(wn,"KEY_SELECT_OFFSET","select_offset"),Object(r["a"])(wn,"KEY_SELECT_ACTIVE","select_active"),Object(r["a"])(wn,"KEY_LEVELS","levels"),Object(r["a"])(wn,"KEY_CREDITS","credits"),Object(r["a"])(wn,"KEY_SUPERZAPPER_USED","superzapper_used"),Object(r["a"])(wn,"KEY_RANK_POSITION","rank_position"),Object(r["a"])(wn,"KEY_LEVEL_SELECTED_CALLBACK","level_selected_callback"),Object(r["a"])(wn,"KEY_PUSH_HIGH_SCORE_CALLBACK","push_high_score_callback"),Object(r["a"])(wn,"KEY_CLOSE_HIGH_SCORES_SCREEN_CALLBACK","close_high_scores_screen_callback"),An=mn,Object(s["a"])(An,"KEY_PLAYER_ID",[T],(dn=Object.getOwnPropertyDescriptor(An,"KEY_PLAYER_ID"),dn=dn?dn.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return dn}}),An),Object(s["a"])(An,"KEY_SCORE",[T],(fn=Object.getOwnPropertyDescriptor(An,"KEY_SCORE"),fn=fn?fn.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return fn}}),An),Object(s["a"])(An,"KEY_HIGHEST_SCORE",[T],(pn=Object.getOwnPropertyDescriptor(An,"KEY_HIGHEST_SCORE"),pn=pn?pn.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return pn}}),An),Object(s["a"])(An,"KEY_HIGH_SCORES",[T],(vn=Object.getOwnPropertyDescriptor(An,"KEY_HIGH_SCORES"),vn=vn?vn.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return vn}}),An),Object(s["a"])(An,"KEY_LIVES",[T],(jn=Object.getOwnPropertyDescriptor(An,"KEY_LIVES"),jn=jn?jn.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return jn}}),An),Object(s["a"])(An,"KEY_LEVEL",[T],(gn=Object.getOwnPropertyDescriptor(An,"KEY_LEVEL"),gn=gn?gn.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return gn}}),An),Object(s["a"])(An,"KEY_SELECT_OFFSET",[T],(Ln=Object.getOwnPropertyDescriptor(An,"KEY_SELECT_OFFSET"),Ln=Ln?Ln.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return Ln}}),An),Object(s["a"])(An,"KEY_SELECT_ACTIVE",[T],(yn=Object.getOwnPropertyDescriptor(An,"KEY_SELECT_ACTIVE"),yn=yn?yn.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return yn}}),An),Object(s["a"])(An,"KEY_LEVELS",[T],(In=Object.getOwnPropertyDescriptor(An,"KEY_LEVELS"),In=In?In.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return In}}),An),Object(s["a"])(An,"KEY_CREDITS",[T],(Nn=Object.getOwnPropertyDescriptor(An,"KEY_CREDITS"),Nn=Nn?Nn.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return Nn}}),An),Object(s["a"])(An,"KEY_SUPERZAPPER_USED",[T],(Rn=Object.getOwnPropertyDescriptor(An,"KEY_SUPERZAPPER_USED"),Rn=Rn?Rn.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return Rn}}),An),Object(s["a"])(An,"KEY_RANK_POSITION",[T],(Pn=Object.getOwnPropertyDescriptor(An,"KEY_RANK_POSITION"),Pn=Pn?Pn.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return Pn}}),An),Object(s["a"])(An,"KEY_LEVEL_SELECTED_CALLBACK",[T],(Cn=Object.getOwnPropertyDescriptor(An,"KEY_LEVEL_SELECTED_CALLBACK"),Cn=Cn?Cn.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return Cn}}),An),Object(s["a"])(An,"KEY_PUSH_HIGH_SCORE_CALLBACK",[T],(Dn=Object.getOwnPropertyDescriptor(An,"KEY_PUSH_HIGH_SCORE_CALLBACK"),Dn=Dn?Dn.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return Dn}}),An),Object(s["a"])(An,"KEY_CLOSE_HIGH_SCORES_SCREEN_CALLBACK",[T],(Gn=Object.getOwnPropertyDescriptor(An,"KEY_CLOSE_HIGH_SCORES_SCREEN_CALLBACK"),Gn=Gn?Gn.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return Gn}}),An),An),Nr=function(e){Object(_["a"])(i,e);var t=Object(S["a"])(i);function i(e){var n,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1024,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1024;return Object(a["a"])(this,i),n=t.call(this,e,s,o,c,l),Object(r["a"])(Object(h["a"])(n),"score",0),Object(r["a"])(Object(h["a"])(n),"targetScore",0),Object(r["a"])(Object(h["a"])(n),"scoreRisingSpeed",10),Object(r["a"])(Object(h["a"])(n),"displaySuperzapperHint",!0),n.score=n.screenContentManager.get(Ir.KEY_SCORE),n}return Object(n["a"])(i,[{key:"update",value:function(){this.targetScore=this.screenContentManager.get(Ir.KEY_SCORE),this.score!==this.targetScore&&(this.score+=this.scoreRisingSpeed,this.score>this.targetScore&&(this.score=this.targetScore)),this.messageBrokerScreenTopicConsumer(),Object(E["a"])(Object(b["a"])(i.prototype),"update",this).call(this)}},{key:"messageBrokerScreenTopicConsumer",value:function(){var e=Ui.consume(Fi.TOPIC_SCREEN);null!==e&&e.isMessage(Fi.MESSAGE_PLAYER_SUPERZAPPER_USED)&&(this.displaySuperzapperHint=!1)}},{key:"draw",value:function(){this.clearCanvas(),this.setFontSizePx(60),this.drawText(this.alignNumberToRight(this.score),50,120,Lr.COLOR_BLUE);for(var e=0;e<this.screenContentManager.get(Ir.KEY_LIVES);e++)this.drawLiveIcon(50+62*e,150);this.setFontSizePx(25),this.displaySuperzapperHint&&!1===this.screenContentManager.get(Ir.KEY_SUPERZAPPER_USED)&&this.drawText("Press E to use SuperZapper",240,1e3,Lr.COLOR_BLUE),this.drawText(this.alignNumberToRight(this.screenContentManager.get(Ir.KEY_HIGHEST_SCORE).score),400,90,Lr.COLOR_BLUE),this.drawText(this.screenContentManager.get(Ir.KEY_HIGHEST_SCORE).name,580,90,Lr.COLOR_BLUE),this.drawText("LEVEL",400,140,Lr.COLOR_GREEN),this.drawText(this.alignNumberToRight(this.screenContentManager.get(Ir.KEY_LEVEL)),505,140,Lr.COLOR_GREEN)}},{key:"drawLiveIcon",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=3*i;this.context.strokeStyle=Lr.COLOR_RED,this.context.beginPath(),this.context.moveTo(e,t+3*a),this.context.lineTo(e+5*a,t+6*a),this.context.lineTo(e+5*a,t+3.5*a),this.context.lineTo(e+10*a,t+3.5*a),this.context.lineTo(e+10*a,t+6*a),this.context.lineTo(e+15*a,t+3*a),this.context.lineTo(e+7.5*a,t),this.context.lineTo(e,t+3*a),this.context.stroke()}}]),i}(Lr),Rr=[{id:1,name:"Loop",isOpen:!1,coords:[{x:0,y:5.1258},{x:-.9807,y:4.9307},{x:-1.8122,y:4.3751},{x:-2.3678,y:3.5437},{x:-2.5629,y:2.5629},{x:-2.3678,y:1.5821},{x:-1.8122,y:.7506},{x:-.9807,y:.195},{x:0,y:0},{x:.9807,y:.195},{x:1.8122,y:.7506},{x:2.3678,y:1.5821},{x:2.5629,y:2.5629},{x:2.3678,y:3.5437},{x:1.8122,y:4.3751},{x:.9807,y:4.9307}]},{id:2,name:"Box",isOpen:!1,coords:[{x:0,y:4},{x:-1,y:4},{x:-2,y:4},{x:-2,y:3},{x:-2,y:2},{x:-2,y:1},{x:-2,y:0},{x:-1,y:0},{x:0,y:0},{x:1,y:0},{x:2,y:0},{x:2,y:1},{x:2,y:2},{x:2,y:3},{x:2,y:4},{x:1,y:4}]},{id:3,name:"Cross",isOpen:!1,coords:[{x:0,y:4},{x:-1,y:4},{x:-1,y:3},{x:-2,y:3},{x:-2,y:2},{x:-2,y:1},{x:-1,y:1},{x:-1,y:0},{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:2,y:1},{x:2,y:2},{x:2,y:3},{x:1,y:3},{x:1,y:4}]},{id:4,name:"Peanut",isOpen:!1,coords:[{x:-.9063,y:2.4226},{x:-1.8911,y:2.2489},{x:-2.4646,y:1.5701},{x:-2.4646,y:.5701},{x:-1.8911,y:-.2489},{x:-.9063,y:-.4226},{x:0,y:0},{x:1,y:0},{x:1.9063,y:-.4226},{x:2.8911,y:-.2489},{x:3.4646,y:.5701},{x:3.4646,y:1.5701},{x:2.8911,y:2.2489},{x:1.9063,y:2.4226},{x:1,y:2},{x:0,y:2}]},{id:5,name:"Medal",isOpen:!1,coords:[{x:-.3442,y:3.8689},{x:-1.0513,y:3.1618},{x:-2.0173,y:2.903},{x:-2.0173,y:1.903},{x:-1.0506,y:1.6464},{x:-.342,y:.9396},{x:0,y:0},{x:1,y:0},{x:1.342,y:.9396},{x:2.0506,y:1.6464},{x:3.0173,y:1.903},{x:3.0173,y:2.903},{x:2.0513,y:3.1618},{x:1.3442,y:3.8689},{x:1.0022,y:4.8086},{x:.0022,y:4.8086}]},{id:6,name:"Triangle",isOpen:!1,coords:[{x:0,y:5},{x:-.5967,y:4.0054},{x:-1.1977,y:3.0037},{x:-1.7974,y:2.0041},{x:-2.3962,y:1.0063},{x:-3,y:0},{x:-2,y:0},{x:-1,y:0},{x:0,y:0},{x:1,y:0},{x:2,y:0},{x:3,y:0},{x:2.3962,y:1.0063},{x:1.7974,y:2.0041},{x:1.1977,y:3.0037},{x:.5967,y:4.0054}]},{id:7,name:"Clover",isOpen:!1,coords:[{x:.0028,y:-.7071},{x:.4568,y:-1.5981},{x:1.4445,y:-1.4416},{x:1.601,y:-.4539},{x:.71,y:0},{x:1.601,y:.4539},{x:1.4445,y:1.4416},{x:.4568,y:1.5981},{x:.0028,y:.7071},{x:-.4568,y:1.5981},{x:-1.4445,y:1.4416},{x:-1.601,y:.4539},{x:-.71,y:0},{x:-1.601,y:-.4539},{x:-1.4445,y:-1.4416},{x:-.4568,y:-1.5981}]},{id:8,name:"The V",isOpen:!0,zOffset:-.5,coords:[{x:-2.9599,y:6.3475},{x:-2.5372,y:5.4411},{x:-2.1143,y:4.5342},{x:-1.6913,y:3.6271},{x:-1.2683,y:2.7199},{x:-.8455,y:1.8133},{x:-.4226,y:.9063},{x:0,y:0},{x:1,y:0},{x:1.4226,y:.9063},{x:1.8455,y:1.8133},{x:2.2683,y:2.7199},{x:2.6913,y:3.6271},{x:3.1143,y:4.5342},{x:3.5372,y:5.4411},{x:3.9599,y:6.3475}]},{id:9,name:"Staircase",isOpen:!0,zOffset:-1,coords:[{x:-3,y:4},{x:-3,y:3},{x:-2,y:3},{x:-2,y:2},{x:-1,y:2},{x:-1,y:1},{x:0,y:1},{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:2,y:1},{x:2,y:2},{x:3,y:2},{x:3,y:3},{x:4,y:3},{x:4,y:4}]},{id:10,name:"Bowl",isOpen:!0,zOffset:-.5,coords:[{x:-2.4317,y:5.8348},{x:-2.4317,y:4.8348},{x:-2.4142,y:3.835},{x:-2.3793,y:2.8356},{x:-2.2057,y:1.8508},{x:-1.7057,y:.9848},{x:-.9396,y:.342},{x:0,y:0},{x:1,y:0},{x:1.9396,y:.342},{x:2.7057,y:.9848},{x:3.2057,y:1.8508},{x:3.3793,y:2.8356},{x:3.4142,y:3.835},{x:3.4317,y:4.8348},{x:3.4317,y:5.8348}]},{id:11,name:"Plane",isOpen:!0,zOffset:-1.5,coords:[{x:-7,y:0},{x:-6,y:0},{x:-5,y:0},{x:-4,y:0},{x:-3,y:0},{x:-2,y:0},{x:-1,y:0},{x:0,y:0},{x:1,y:0},{x:2,y:0},{x:3,y:0},{x:4,y:0},{x:5,y:0},{x:6,y:0},{x:7,y:0},{x:8,y:0}]},{id:12,name:"ILY",isOpen:!1,coords:[{x:-.1421,y:3.1885},{x:-.7849,y:3.9546},{x:-1.7508,y:3.6958},{x:-2.0928,y:2.7561},{x:-2.0928,y:1.7561},{x:-1.7508,y:.81},{x:-.9848,y:.1736},{x:0,y:0},{x:.9848,y:.1736},{x:1.7508,y:.81},{x:2.0928,y:1.7561},{x:2.0928,y:2.7561},{x:1.7508,y:3.6958},{x:.7849,y:3.9546},{x:.1421,y:3.1885},{x:.0029,y:2.1982}]},{id:13,name:"Star",isOpen:!1,coords:[{x:0,y:-1.3065},{x:.7932,y:-1.9153},{x:.9237,y:-.9238},{x:1.9152,y:-.7933},{x:1.3064,y:0},{x:1.9152,y:.7933},{x:.9237,y:.9238},{x:.7932,y:1.9153},{x:0,y:1.3065},{x:-.7932,y:1.9153},{x:-.9237,y:.9238},{x:-1.9152,y:.7933},{x:-1.3064,y:0},{x:-1.9152,y:-.7933},{x:-.9237,y:-.9238},{x:-.7932,y:-1.9153}]},{id:14,name:"Wave",isOpen:!0,zOffset:-1,coords:[{x:-4.4792,y:1.8039},{x:-3.9056,y:.9848},{x:-3.732,y:0},{x:-3.232,y:-.866},{x:-2.366,y:-1.366},{x:-1.366,y:-1.366},{x:-.5,y:-.866},{x:0,y:0},{x:1,y:0},{x:1.5,y:-.866},{x:2.366,y:-1.366},{x:3.366,y:-1.366},{x:4.232,y:-.866},{x:4.732,y:0},{x:4.9056,y:.9848},{x:5.4792,y:1.8039}]},{id:15,name:"Mountains",isOpen:!0,zOffset:-1,coords:[{x:-2.1405,y:3.2564},{x:-2.6405,y:4.1224},{x:-2.1405,y:3.2564},{x:-1.7985,y:2.3167},{x:-1.5396,y:1.3508},{x:-1.366,y:.366},{x:-.866,y:-.5},{x:0,y:0},{x:.9848,y:-.1736},{x:1.4696,y:.666},{x:1.6432,y:1.6508},{x:2.1432,y:2.5168},{x:3.128,y:2.3432},{x:3.47,y:3.2829},{x:3.8121,y:4.2226},{x:4.1541,y:5.1623}]},{id:16,name:"Infinity",isOpen:!1,coords:[{x:-.2738,y:1.9396},{x:-1.3079,y:2.1985},{x:-2.2738,y:1.9396},{x:-2.6159,y:1},{x:-2.2738,y:.0603},{x:-1.3079,y:-.1985},{x:-.342,y:.0603},{x:0,y:1},{x:.342,y:.0603},{x:1.3079,y:-.1985},{x:2.2738,y:.0603},{x:2.6159,y:1},{x:2.2738,y:1.9396},{x:1.3079,y:2.1985},{x:.2738,y:1.9396},{x:0,y:1}]}],Pr=Rr,Cr=(Hn=Fn=function(e){Object(_["a"])(i,e);var t=Object(S["a"])(i);function i(e){var n,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1024,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1024;return Object(a["a"])(this,i),n=t.call(this,e,s,o,c,l),Object(r["a"])(Object(h["a"])(n),"selectedLevel",1),n.registerKeys(),n}return Object(n["a"])(i,[{key:"release",value:function(){this.unregisterKeys()}},{key:"registerKeys",value:function(){var e=this;ta.register("KeyA",(function(){e.moveLeft()})),ta.register("KeyD",(function(){e.moveRight()})),ta.register("Space",(function(){e.selectLevel()}))}},{key:"unregisterKeys",value:function(){ta.unregister("KeyA"),ta.unregister("KeyD"),ta.unregister("Space")}},{key:"selectLevel",value:function(){this.keyInputDelay()&&(this.screenContentManager.get(Ir.KEY_LEVEL_SELECTED_CALLBACK)(this.selectedLevel,!0),Ui.publish(Fi.TOPIC_AUDIO,Fi.MESSAGE_MENU_SELECT))}},{key:"moveLeft",value:function(){this.keyInputDelay()&&(this.moveSelection(-1),Ui.publish(Fi.TOPIC_AUDIO,Fi.MESSAGE_MENU_CHANGE))}},{key:"moveRight",value:function(){this.keyInputDelay()&&(this.moveSelection(1),Ui.publish(Fi.TOPIC_AUDIO,Fi.MESSAGE_MENU_CHANGE))}},{key:"moveSelection",value:function(e){var t=this.screenContentManager.get(Ir.KEY_SELECT_ACTIVE),i=this.screenContentManager.get(Ir.KEY_SELECT_OFFSET),a=t+i+e;if(!(a<0)){var n=this.screenContentManager.get(Ir.KEY_LEVELS).length;a>=n||(1===e?t>=4?i++:t++:t<=0?i--:t--,this.selectedLevel=this.screenContentManager.get(Ir.KEY_LEVELS)[a].id,this.screenContentManager.set(Ir.KEY_SELECT_ACTIVE,t),this.screenContentManager.set(Ir.KEY_SELECT_OFFSET,i))}}},{key:"draw",value:function(){this.clearCanvas(),this.setFontSizePx(20),this.drawText("© ROMAN DABAL & PIOTR KLOSEK ©",282,60,Lr.COLOR_BLUE),this.setFontSizePx(30),this.drawText("rate yourself",371,480,Lr.COLOR_GREEN),this.drawText("Use A and D to change",270,530,Lr.COLOR_CYAN),this.drawText("Press fire to select",284,580,Lr.COLOR_YELLOW),this.drawText("novice",140,750,Lr.COLOR_RED),this.drawText("expert",845,750,Lr.COLOR_RED),this.setFontSizePx(25),this.drawText("level",30,800,Lr.COLOR_GREEN),this.drawText("hole",30,860,Lr.COLOR_GREEN),this.drawText("bonus",30,920,Lr.COLOR_GREEN);for(var e=this.screenContentManager.get(Ir.KEY_SELECT_OFFSET),t=this.screenContentManager.get(Ir.KEY_LEVELS),a=160,n=175,r=0;r<t.length-e&&r<5;r++){var s=t[r+e],o=(s.id-1)%16+1;this.drawText(this.alignNumberToRight(s.id),a+r*n-40,800,Lr.COLOR_GREEN);var c=Math.floor(s.id/16)%3;this.context.strokeStyle=i.SURFACE_COLORS[c],this.drawMapIcon(a+r*n+58,845,o),this.drawText(this.alignNumberToRight(s.scoreBonus),a+r*n,920,Lr.COLOR_RED)}this.setFontSizePx(75),this.drawText("TEMPEST 2021",160,300,Lr.COLOR_WHITE),this.drawRect(140+n*this.screenContentManager.get(Ir.KEY_SELECT_ACTIVE),765,n-20,165,i.COLOR_BLUE)}},{key:"drawMapIcon",value:function(e,t,i){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,n=10*a,r=Pr.find((function(e){return e.id===i}));if(void 0!==r){var s=new ua.create(r.coords);this.context.beginPath();for(var o=0;o<r.coords.length+(r.isOpen?0:1);o++){var c=e+(s.getCenter().x-r.coords[o%16].x)*n,l=t+(s.getCenter().y-r.coords[o%16].y)*n;0!==o?this.context.lineTo(c,l):this.context.moveTo(c,l)}this.context.stroke()}}}]),i}(Lr),Object(r["a"])(Fn,"SURFACE_COLORS",["rgba(0, 0, 255, 1)","rgba(255, 0, 0, 1)","rgba(0, 255, 0, 1)"]),Mn=Hn,Object(s["a"])(Mn,"SURFACE_COLORS",[T],(xn=Object.getOwnPropertyDescriptor(Mn,"SURFACE_COLORS"),xn=xn?xn.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return xn}}),Mn),Mn),Dr=function(e){Object(_["a"])(i,e);var t=Object(S["a"])(i);function i(e){var n,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1024,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1024;return Object(a["a"])(this,i),n=t.call(this,e,s,o,c,l),Object(r["a"])(Object(h["a"])(n),"playerName",["A","A","A"]),Object(r["a"])(Object(h["a"])(n),"place",8),Object(r["a"])(Object(h["a"])(n),"score",0),Object(r["a"])(Object(h["a"])(n),"highScores",void 0),Object(r["a"])(Object(h["a"])(n),"currentStep",0),n.highScores=Object(la["a"])(n.screenContentManager.get(Ir.KEY_HIGH_SCORES)),n.score=n.screenContentManager.get(Ir.KEY_SCORE),n.place=n.highScores.findIndex((function(e){return e.score<=n.score})),n.place>=0?(n.highScores.splice(n.place,0,{name:"AAA",score:n.score}),n.highScores.pop()):n.currentStep=3,n.registerKeys(),n}return Object(n["a"])(i,[{key:"release",value:function(){this.unregisterKeys()}},{key:"registerKeys",value:function(){var e=this;ta.register("KeyA",(function(){e.prevChar()})),ta.register("KeyD",(function(){e.nextChar()})),ta.register("Space",(function(){e.step()}))}},{key:"unregisterKeys",value:function(){ta.unregister("KeyA"),ta.unregister("KeyD"),ta.unregister("Space")}},{key:"nextChar",value:function(){if(!(this.currentStep>=3)&&this.keyInputDelay()){var e=this.playerName[this.currentStep].charCodeAt(0);e<90&&e++,this.playerName[this.currentStep]=String.fromCharCode(e),this.highScores[this.place].name=this.playerName.join(""),Ui.publish(Fi.TOPIC_AUDIO,Fi.MESSAGE_MENU_CHANGE)}}},{key:"prevChar",value:function(){if(!(this.currentStep>=3)&&this.keyInputDelay()){var e=this.playerName[this.currentStep].charCodeAt(0);e>65&&e--,this.playerName[this.currentStep]=String.fromCharCode(e),this.highScores[this.place].name=this.playerName.join(""),Ui.publish(Fi.TOPIC_AUDIO,Fi.MESSAGE_MENU_CHANGE)}}},{key:"step",value:function(){this.keyInputDelay()&&(this.currentStep>=3&&(this.screenContentManager.get(Ir.KEY_PUSH_HIGH_SCORE_CALLBACK)(this.score,this.playerName.join("")),this.screenContentManager.get(Ir.KEY_CLOSE_HIGH_SCORES_SCREEN_CALLBACK)()),this.currentStep++,Ui.publish(Fi.TOPIC_AUDIO,Fi.MESSAGE_MENU_SELECT))}},{key:"draw",value:function(){this.clearCanvas(),this.setFontSizePx(30),this.drawText(this.alignNumberToRight(this.score),372,90,Lr.COLOR_BLUE),this.drawText(this.playerName.join(""),548,90,Lr.COLOR_BLUE),this.drawText("game over",423,140,Lr.COLOR_BLUE);for(var e=0;e<this.highScores.length;e++)this.drawText(this.alignNumberToRight(this.highScores[e].score),550,340+50*e,Lr.COLOR_GREEN),this.drawText(this.highScores[e].name,400,340+50*e,Lr.COLOR_GREEN),this.drawText(this.alignNumberToRight(e+1),200,340+50*e,Lr.COLOR_GREEN);this.drawText("Bonus every 20000",325,1e3,Lr.COLOR_CYAN),this.drawText("Use A and D change",310,800,Lr.COLOR_CYAN),this.drawText("Press fire to confirm",274,850,Lr.COLOR_YELLOW),this.setFontSizePx(60),this.drawText("HIGH SCORES",260,260,Lr.COLOR_YELLOW)}}]),i}(Lr),Gr=[{id:1,selectable:!0,scoreBonus:0,targetScore:3e3},{id:2,selectable:!1,scoreBonus:0,targetScore:6e3},{id:3,selectable:!0,scoreBonus:6e3,targetScore:11e3},{id:4,selectable:!1,scoreBonus:0,targetScore:16e3},{id:5,selectable:!0,scoreBonus:16e3,targetScore:24e3},{id:6,selectable:!1,scoreBonus:0,targetScore:32e3},{id:7,selectable:!0,scoreBonus:32e3,targetScore:43e3},{id:8,selectable:!1,scoreBonus:0,targetScore:54e3},{id:9,selectable:!0,scoreBonus:54e3,targetScore:64e3},{id:10,selectable:!1,scoreBonus:0,targetScore:74e3},{id:11,selectable:!0,scoreBonus:74e3,targetScore:84e3},{id:12,selectable:!1,scoreBonus:0,targetScore:94e3},{id:13,selectable:!0,scoreBonus:94e3,targetScore:104e3},{id:14,selectable:!1,scoreBonus:0,targetScore:114e3},{id:15,selectable:!0,scoreBonus:114e3,targetScore:124e3},{id:16,selectable:!1,scoreBonus:0,targetScore:134e3},{id:17,selectable:!0,scoreBonus:134e3,targetScore:14e4},{id:18,selectable:!1,scoreBonus:0,targetScore:146e3},{id:19,selectable:!1,scoreBonus:0,targetScore:152e3},{id:20,selectable:!0,scoreBonus:152e3,targetScore:161e3},{id:21,selectable:!1,scoreBonus:0,targetScore:17e4},{id:22,selectable:!0,scoreBonus:17e4,targetScore:179e3},{id:23,selectable:!1,scoreBonus:0,targetScore:188e3},{id:24,selectable:!0,scoreBonus:188e3,targetScore:198e3},{id:25,selectable:!1,scoreBonus:0,targetScore:208e3},{id:26,selectable:!0,scoreBonus:208e3,targetScore:217e3},{id:27,selectable:!1,scoreBonus:0,targetScore:226e3},{id:28,selectable:!0,scoreBonus:226e3,targetScore:233300},{id:29,selectable:!1,scoreBonus:0,targetScore:240700},{id:30,selectable:!1,scoreBonus:0,targetScore:248e3},{id:31,selectable:!0,scoreBonus:248e3,targetScore:256500},{id:32,selectable:!1,scoreBonus:0,targetScore:265e3},{id:33,selectable:!0,scoreBonus:265e3,targetScore:276700},{id:34,selectable:!1,scoreBonus:0,targetScore:288300},{id:35,selectable:!1,scoreBonus:0,targetScore:3e5},{id:36,selectable:!0,scoreBonus:3e5,targetScore:31e4},{id:37,selectable:!1,scoreBonus:0,targetScore:32e4},{id:38,selectable:!1,scoreBonus:0,targetScore:33e4},{id:39,selectable:!1,scoreBonus:0,targetScore:34e4},{id:40,selectable:!0,scoreBonus:34e4,targetScore:350500},{id:41,selectable:!1,scoreBonus:0,targetScore:361e3},{id:42,selectable:!1,scoreBonus:0,targetScore:371500},{id:43,selectable:!1,scoreBonus:0,targetScore:382e3},{id:44,selectable:!0,scoreBonus:382e3,targetScore:393e3},{id:45,selectable:!1,scoreBonus:0,targetScore:404e3},{id:46,selectable:!1,scoreBonus:0,targetScore:415e3},{id:47,selectable:!0,scoreBonus:415e3,targetScore:427e3},{id:48,selectable:!1,scoreBonus:0,targetScore:439e3},{id:49,selectable:!0,scoreBonus:439e3,targetScore:456700},{id:50,selectable:!1,scoreBonus:0,targetScore:474300},{id:51,selectable:!1,scoreBonus:0,targetScore:492e3},{id:52,selectable:!0,scoreBonus:492e3,targetScore:501800},{id:53,selectable:!1,scoreBonus:0,targetScore:511500},{id:54,selectable:!1,scoreBonus:0,targetScore:521300},{id:55,selectable:!1,scoreBonus:0,targetScore:531e3},{id:56,selectable:!0,scoreBonus:531e3,targetScore:546e3},{id:57,selectable:!1,scoreBonus:0,targetScore:561e3},{id:58,selectable:!1,scoreBonus:0,targetScore:576e3},{id:59,selectable:!1,scoreBonus:0,targetScore:591e3},{id:60,selectable:!0,scoreBonus:591e3,targetScore:602e3},{id:61,selectable:!1,scoreBonus:0,targetScore:613e3},{id:62,selectable:!1,scoreBonus:0,targetScore:624e3},{id:63,selectable:!0,scoreBonus:624e3,targetScore:64e4},{id:64,selectable:!1,scoreBonus:0,targetScore:656e3},{id:65,selectable:!0,scoreBonus:656e3,targetScore:669800},{id:66,selectable:!1,scoreBonus:0,targetScore:683500},{id:67,selectable:!1,scoreBonus:0,targetScore:697300},{id:68,selectable:!1,scoreBonus:0,targetScore:711e3},{id:69,selectable:!1,scoreBonus:0,targetScore:724800},{id:70,selectable:!1,scoreBonus:0,targetScore:738500},{id:71,selectable:!1,scoreBonus:0,targetScore:752300},{id:72,selectable:!1,scoreBonus:0,targetScore:766e3},{id:73,selectable:!0,scoreBonus:766e3,targetScore:776300},{id:74,selectable:!1,scoreBonus:0,targetScore:786500},{id:75,selectable:!1,scoreBonus:0,targetScore:796800},{id:76,selectable:!1,scoreBonus:0,targetScore:807e3},{id:77,selectable:!1,scoreBonus:0,targetScore:817300},{id:78,selectable:!1,scoreBonus:0,targetScore:827500},{id:79,selectable:!1,scoreBonus:0,targetScore:837800},{id:80,selectable:!1,scoreBonus:0,targetScore:848e3},{id:81,selectable:!0,scoreBonus:848e3,targetScore:855900},{id:82,selectable:!1,scoreBonus:0,targetScore:863800},{id:83,selectable:!1,scoreBonus:0,targetScore:871700},{id:84,selectable:!1,scoreBonus:0,targetScore:879600},{id:85,selectable:!1,scoreBonus:0,targetScore:887400},{id:86,selectable:!1,scoreBonus:0,targetScore:895300},{id:87,selectable:!1,scoreBonus:0,targetScore:903200},{id:88,selectable:!1,scoreBonus:0,targetScore:911100},{id:89,selectable:!1,scoreBonus:0,targetScore:919e3},{id:90,selectable:!1,scoreBonus:0,targetScore:926900},{id:91,selectable:!1,scoreBonus:0,targetScore:934800},{id:92,selectable:!1,scoreBonus:0,targetScore:942700},{id:93,selectable:!1,scoreBonus:0,targetScore:950600},{id:94,selectable:!1,scoreBonus:0,targetScore:958400},{id:95,selectable:!1,scoreBonus:0,targetScore:966300},{id:96,selectable:!1,scoreBonus:0,targetScore:974200},{id:97,selectable:!1,scoreBonus:0,targetScore:982100},{id:98,selectable:!1,scoreBonus:0,targetScore:99e4},{id:99,selectable:!1,scoreBonus:0,targetScore:999e3}],wr=Gr,mr=(Jn=Xn=function(){function e(t){Object(a["a"])(this,e),Object(r["a"])(this,"audioListener",void 0),Object(r["a"])(this,"audio",[]),Object(r["a"])(this,"audioBuffer",void 0),this.audioListener=t,this.audio.push(new o["b"](this.audioListener))}return Object(n["a"])(e,[{key:"playSound",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=this.audio.find((function(e){return!e.isPlaying}));void 0===a&&(this.audio.push(new o["b"](this.audioListener)),a=this.audio[this.audio.length-1]);var n=new o["d"];n.load("sounds/".concat(t,".ogg"),(function(t){a.setBuffer(t),a.setVolume(i*e.SOUND_VOLUME),a.play()}))}},{key:"update",value:function(){var t=Ui.consume(Fi.TOPIC_AUDIO);if(null!==t)switch(t.message){case Fi.MESSAGE_ENEMY_DEATH:this.playSound(e.SOUND_ENEMY_DEATH);break;case Fi.MESSAGE_PLAYER_DEATH:this.playSound(e.SOUND_PLAYER_DEATH);break;case Fi.MESSAGE_PLAYER_CHANGED_LANE:this.playSound(e.SOUND_PLAYER_LANE_CHANGE);break;case Fi.MESSAGE_NEXT_LEVEL:this.playSound(e.SOUND_NEXT_LEVEL);break;case Fi.MESSAGE_PLAYER_SHOOT:this.playSound(e.SOUND_PLAYER_SHOOT,.8);break;case Fi.MESSAGE_ENEMY_SHOOT:this.playSound(e.SOUND_ENEMY_SHOOT,.3);break;case Fi.MESSAGE_MENU_CHANGE:this.playSound(e.SOUND_PLAYER_LANE_CHANGE);break;case Fi.MESSAGE_MENU_SELECT:this.playSound(e.SOUND_PLAYER_SHOOT,.8);break}}}]),e}(),Object(r["a"])(Xn,"SOUND_ENEMY_DEATH","enemy_death"),Object(r["a"])(Xn,"SOUND_NEXT_LEVEL","next_level"),Object(r["a"])(Xn,"SOUND_PLAYER_DEATH","player_death"),Object(r["a"])(Xn,"SOUND_PLAYER_LANE_CHANGE","player_lane_change"),Object(r["a"])(Xn,"SOUND_PLAYER_SHOOT","player_shoot"),Object(r["a"])(Xn,"SOUND_ENEMY_SHOOT","enemy_shoot"),Object(r["a"])(Xn,"SOUND_VOLUME",.4),kn=Jn,Object(s["a"])(kn,"SOUND_ENEMY_DEATH",[T],(Un=Object.getOwnPropertyDescriptor(kn,"SOUND_ENEMY_DEATH"),Un=Un?Un.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return Un}}),kn),Object(s["a"])(kn,"SOUND_NEXT_LEVEL",[T],(zn=Object.getOwnPropertyDescriptor(kn,"SOUND_NEXT_LEVEL"),zn=zn?zn.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return zn}}),kn),Object(s["a"])(kn,"SOUND_PLAYER_DEATH",[T],(Bn=Object.getOwnPropertyDescriptor(kn,"SOUND_PLAYER_DEATH"),Bn=Bn?Bn.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return Bn}}),kn),Object(s["a"])(kn,"SOUND_PLAYER_LANE_CHANGE",[T],(Yn=Object.getOwnPropertyDescriptor(kn,"SOUND_PLAYER_LANE_CHANGE"),Yn=Yn?Yn.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return Yn}}),kn),Object(s["a"])(kn,"SOUND_PLAYER_SHOOT",[T],(Wn=Object.getOwnPropertyDescriptor(kn,"SOUND_PLAYER_SHOOT"),Wn=Wn?Wn.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return Wn}}),kn),Object(s["a"])(kn,"SOUND_ENEMY_SHOOT",[T],(Kn=Object.getOwnPropertyDescriptor(kn,"SOUND_ENEMY_SHOOT"),Kn=Kn?Kn.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return Kn}}),kn),Object(s["a"])(kn,"SOUND_VOLUME",[T],(Vn=Object.getOwnPropertyDescriptor(kn,"SOUND_VOLUME"),Vn=Vn?Vn.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return Vn}}),kn),kn),Mr=(rr=nr=function(){function e(){Object(a["a"])(this,e),Object(r["a"])(this,"state",void 0),Object(r["a"])(this,"prevState",void 0),Object(r["a"])(this,"screenStateUpdated",!1),Object(r["a"])(this,"flags",void 0),Object(r["a"])(this,"level",1),Object(r["a"])(this,"highestLevel",99),Object(r["a"])(this,"levelData",void 0),Object(r["a"])(this,"firstLevel",!0),Object(r["a"])(this,"score",0),Object(r["a"])(this,"highScores",void 0),Object(r["a"])(this,"lives",5),Object(r["a"])(this,"credits",1),Object(r["a"])(this,"scene",void 0),Object(r["a"])(this,"camera",void 0),Object(r["a"])(this,"renderer",void 0),Object(r["a"])(this,"composer",void 0),Object(r["a"])(this,"levelObject",null),Object(r["a"])(this,"levelRenderer",null),Object(r["a"])(this,"audioListener",void 0),Object(r["a"])(this,"audioManager",void 0),Object(r["a"])(this,"screenGroup",void 0),Object(r["a"])(this,"screenObject",null),Object(r["a"])(this,"screenContentManager",void 0),this.setState(e.STATE_SELECT_SURFACE),this.setupRenderer(),this.setupLogic()}return Object(n["a"])(e,[{key:"handleState",value:function(){this.screenStateUpdated||(this.releaseScreen(),this.state.equals(e.STATE_PLAY)?(this.releaseLevel(),this.loadScreen(new Nr(this.screenContentManager)),this.loadLevel(this.level),this.screenContentManager.setLevel(this.level)):this.state.equals(e.STATE_SELECT_SURFACE)?(this.releaseLevel(),this.lives=5,this.score=0,this.populateScreenContentManager(),this.loadScreen(new Cr(this.screenContentManager))):this.state.equals(e.STATE_HIGH_SCORES)&&(this.releaseLevel(),this.loadScreen(new Dr(this.screenContentManager))),this.saveGameState()),this.screenStateUpdated=!0}},{key:"setState",value:function(e){this.prevState=this.state,this.state=e,this.screenStateUpdated=!1}},{key:"startLevel",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(null!==this.levelObject)throw new Error("Can't start level while another one is active!");this.level=t,this.firstLevel=i,this.setState(e.STATE_PLAY)}},{key:"loadLevel",value:function(t){var i=(t-1)%16+1,a=this.surfacesCollection.find((function(e){return e.id===i}));if(void 0===a)throw this.setState(e.STATE_SELECT_SURFACE),new Error("Can't find surface level with id === ".concat(i," !"));if(this.levelData=wr.find((function(e){return e.id===t})),void 0===this.levelData)throw new Error("Can't find level with id === ".concat(t," !"));var n=this.firstLevel?this.levelData.targetScore-this.levelData.scoreBonus:this.levelData.targetScore;this.levelObject=new ca(a,this.level,this.score,n,this.rewardCallback.bind(this),this.levelWonCallback.bind(this),this.shooterKilledCallback.bind(this),this.getCurrentScore.bind(this)),this.levelObject.registerKeys(),this.levelRenderer.bindLevel(this.levelObject),this.populateScreenContentManager()}},{key:"releaseLevel",value:function(){null!==this.levelObject&&(this.levelObject.release(),this.levelObject=null,this.levelRenderer.releaseLevel())}},{key:"loadScreen",value:function(e){null!==this.screenObject&&this.screenObject.release(),this.screenObject=e,this.screenGroup.add(this.screenObject)}},{key:"releaseScreen",value:function(){this.screenGroup.remove(this.screenObject),this.screenObject=null}},{key:"setupLogic",value:function(){this.screenContentManager=new Ir,this.loadGameState(),this.populateScreenContentManager(),this.surfacesCollection=Oa.fromDataset(Pr)}},{key:"loadGameState",value:function(){console.log("STATE LOADED"),this.highScores=new Array(8).fill({name:"EZY",score:4096});var t=localStorage.getItem(e.HIGH_SCORES_STORAGE_KEY);null!==t&&(t=JSON.parse(t),8===t.length&&(this.highScores=t)),this.highestLevel=1;var i=localStorage.getItem(e.HIGHEST_LEVEL);null!==i&&(this.highestLevel=parseInt(i))}},{key:"saveGameState",value:function(){console.log("STATE SAVED"),localStorage.setItem(e.HIGH_SCORES_STORAGE_KEY,JSON.stringify(this.highScores)),localStorage.setItem(e.HIGHEST_LEVEL,this.highestLevel.toString())}},{key:"populateScreenContentManager",value:function(){var t=this;this.screenContentManager.setLives(this.lives),this.screenContentManager.setLevel(this.level),this.screenContentManager.setScore(this.score),this.screenContentManager.setCredits(this.credits),this.screenContentManager.setHighScores(this.highScores),this.screenContentManager.setSuperzapperUsed(!1),this.screenContentManager.setSelectActive(0),this.screenContentManager.setSelectOffset(0),this.screenContentManager.setSelectLevels(wr.filter((function(e){return e.selectable&&e.id<=t.highestLevel}))),this.screenContentManager.setLevelSelectedCallback(this.startLevel.bind(this)),this.screenContentManager.setPushHighScoreCallback(this.pushScoreToHighScores.bind(this)),this.screenContentManager.setCloseHighScoresScreenCallback((function(){t.setState(e.STATE_SELECT_SURFACE)}))}},{key:"setupRenderer",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.scene=new o["E"],this.camera=new o["y"](75,window.innerWidth/window.innerHeight,.1,1e3),this.camera.position.set(0,0,-6),this.camera.lookAt(0,0,10),this.audioListener=new o["c"],this.camera.add(this.audioListener),this.audioManager=new mr(this.audioListener),this.renderer=new o["L"]({antialias:!0}),this.renderer.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(this.renderer.domElement),this.composer=new c["a"](this.renderer),this.composer.addPass(new l["a"](this.scene,this.camera)),e&&(this.composer.addPass(new u["a"]({x:256,y:256},2.2,1.3,0)),this.composer.addPass(new O["a"](window.innerWidth,window.innerHeight))),this.levelRenderer=new gr(this.camera),this.scene.add(this.levelRenderer),this.screenGroup=new o["m"],this.screenGroup.rotation.y=Math.PI,this.scene.add(this.screenGroup)}},{key:"update",value:function(){requestAnimationFrame(this.update.bind(this)),this.handleState(),ta.dispatchActions(),null!==this.screenObject&&this.screenObject.update(),null!==this.levelObject&&null!==this.levelRenderer&&(this.levelObject.update(),this.levelRenderer.update()),this.audioManager.update(),this.composer.render()}},{key:"rewardCallback",value:function(t){this.score+=t,this.lives<5&&Math.floor(this.score/e.BONUS_EVERY)!==Math.floor((this.score-t)/e.BONUS_EVERY)&&(this.lives++,this.screenContentManager.set(Ir.KEY_LIVES,this.lives)),this.screenContentManager.setScore(this.score)}},{key:"levelWonCallback",value:function(){this.firstLevel&&this.levelData.selectable&&(this.score+=this.levelData.scoreBonus,this.screenContentManager.setScore(this.score),this.levelData.scoreBonus>=e.BONUS_EVERY&&this.lives<5&&(this.lives++,this.screenContentManager.set(Ir.KEY_LIVES,this.lives))),this.firstLevel=!1,this.releaseLevel(),this.startLevel(this.level+1)}},{key:"shooterKilledCallback",value:function(){return this.lives--,this.screenContentManager.setLives(this.lives),0!==this.lives||(this.level>this.highestLevel&&(this.highestLevel=this.level),this.setState(e.STATE_HIGH_SCORES),!1)}},{key:"pushScoreToHighScores",value:function(e,t){var i=this.highScores.findIndex((function(t){return t.score<=e}));i<0||(this.highScores.splice(i,0,{name:t,score:e}),this.highScores.pop())}},{key:"getCurrentScore",value:function(){return this.score}}]),e}(),Object(r["a"])(nr,"BONUS_EVERY",2e4),Object(r["a"])(nr,"HIGH_SCORES_STORAGE_KEY","high_scores"),Object(r["a"])(nr,"HIGHEST_LEVEL","highest_level"),Object(r["a"])(nr,"STATE_SELECT_SURFACE",new wi(0,0,"select_surface")),Object(r["a"])(nr,"STATE_PLAY",new wi(0,0,"play")),Object(r["a"])(nr,"STATE_HIGH_SCORES",new wi(0,0,"high_scores")),Object(r["a"])(nr,"FLAG_LOAD_NEXT_LEVEL",1),Zn=rr,Object(s["a"])(Zn,"BONUS_EVERY",[T],(qn=Object.getOwnPropertyDescriptor(Zn,"BONUS_EVERY"),qn=qn?qn.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return qn}}),Zn),Object(s["a"])(Zn,"HIGH_SCORES_STORAGE_KEY",[T],(Qn=Object.getOwnPropertyDescriptor(Zn,"HIGH_SCORES_STORAGE_KEY"),Qn=Qn?Qn.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return Qn}}),Zn),Object(s["a"])(Zn,"HIGHEST_LEVEL",[T],($n=Object.getOwnPropertyDescriptor(Zn,"HIGHEST_LEVEL"),$n=$n?$n.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return $n}}),Zn),Object(s["a"])(Zn,"STATE_SELECT_SURFACE",[T],(er=Object.getOwnPropertyDescriptor(Zn,"STATE_SELECT_SURFACE"),er=er?er.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return er}}),Zn),Object(s["a"])(Zn,"STATE_PLAY",[T],(tr=Object.getOwnPropertyDescriptor(Zn,"STATE_PLAY"),tr=tr?tr.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return tr}}),Zn),Object(s["a"])(Zn,"STATE_HIGH_SCORES",[T],(ir=Object.getOwnPropertyDescriptor(Zn,"STATE_HIGH_SCORES"),ir=ir?ir.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return ir}}),Zn),Object(s["a"])(Zn,"FLAG_LOAD_NEXT_LEVEL",[T],(ar=Object.getOwnPropertyDescriptor(Zn,"FLAG_LOAD_NEXT_LEVEL"),ar=ar?ar.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return ar}}),Zn),Zn),xr=new Mr;xr.update()}});
//# sourceMappingURL=app.7e530fce.js.map